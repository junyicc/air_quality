// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.13/esri/copyright.txt for details.
//>>built
require({cache:{"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b,n,a,c,h,l){f=f(null,{declaredClass:"esri.toolbars._Box",constructor:function(a,b,h,c,l,d,g){this._graphic=
a;this._map=b;this._toolbar=h;this._scale=c;this._rotate=l;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=d;a=h._options;this._markerSymbol=a.boxHandleSymbol;this._lineSymbol=a.boxLineSymbol;this._moveStartHandler=q.hitch(this,this._moveStartHandler);this._firstMoveHandler=q.hitch(this,this._firstMoveHandler);this._moveStopHandler=q.hitch(this,this._moveStopHandler);this._moveHandler=q.hitch(this,this._moveHandler);this._isTextPoint=g;this._init()},
destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){e.forEach(this._getAllGraphics(),function(a){a.hide()})},resume:function(){e.forEach(this._getAllGraphics(),function(a){a.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&e.forEach(this._connects,t.disconnect);var a=this._toolbar._scratchGL;this._anchors&&e.forEach(this._anchors,function(b){a.remove(b.graphic);
(b=b.moveable)&&b.destroy()});this._box&&a.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var a=this._map,h=this._toolbar._scratchGL,c=this._getBoxCoords(),d=new n(a.spatialReference),g=q.clone(e.filter(c,function(a,b){return 8!==b&&0===b%2}));g[0]&&g.push([g[0][0],g[0][1]]);d.addPath(g);this._rotate&&d.addPath([c[1],c[8]]);this._box?this._box.setGeometry(d):(this._box=new l(d,this._lineSymbol),h.add(this._box));this._anchors?e.forEach(this._anchors,
function(h,l){this._scale||(l=8);var d=new b(c[l],a.spatialReference);h.graphic.setGeometry(d);var d=h.moveable,g=h.graphic.getDojoShape();g&&(d?g!==d.shape&&(d.destroy(),h.moveable=this._getMoveable(h.graphic,l)):h.moveable=this._getMoveable(h.graphic,l))},this):(this._anchors=[],this._connects=[],e.forEach(c,function(c,d){if(this._scale||!(8>d)){c=new b(c,a.spatialReference);var g=new l(c,this._markerSymbol);this._isTextPoint&&1===d%2&&g.hide();h.add(g);this._anchors.push({graphic:g,moveable:this._getMoveable(g,
d)})}},this))}else this._cleanUp()},_getBoxCoords:function(a){var b=this._map,h,c=[],l,d,g;if(this._isTextPoint){h=this._graphic.getNode().getBoundingClientRect();var k=b.__container.getBoundingClientRect();h=[{x:h.left-k.left,y:h.top-k.top},{x:h.right-k.left,y:h.top-k.top},{x:h.right-k.left,y:h.bottom-k.top},{x:h.left-k.left,y:h.bottom-k.top}]}else h=this._getTransformedBoundingBox(this._graphic);e.forEach(h,function(h,k,e){l=h;(d=e[k+1])||(d=e[0]);g={x:(l.x+d.x)/2,y:(l.y+d.y)/2};a||(l=b.toMap(l),
g=b.toMap(g));c.push([l.x,l.y]);c.push([g.x,g.y])});this._rotate&&(h=q.clone(c[1]),h=a?{x:h[0],y:h[1]}:b.toScreen({x:h[0],y:h[1],spatialReference:b.spatialReference}),h.y-=this._toolbar._options.rotateHandleOffset,a||(h=b.toMap(h)),c.push([h.x,h.y]));return c},_getTransformedBoundingBox:function(a){var h=this._map,c=a.geometry.getExtent(),l=a.geometry.spatialReference;a=new b(c.xmin,c.ymax,l);c=new b(c.xmax,c.ymin,l);a=h.toScreen(a);c=h.toScreen(c);return[{x:a.x,y:a.y},{x:c.x,y:a.y},{x:c.x,y:c.y},
{x:a.x,y:c.y}]},_getAllGraphics:function(){var a=[this._box];this._anchors&&e.forEach(this._anchors,function(h){a.push(h.graphic)});return a=e.filter(a,k.isDefined)},_getMoveable:function(a,h){var b=a.getDojoShape();if(b){var c=new m(b);c._index=h;this._connects.push(t.connect(c,"onMoveStart",this._moveStartHandler));this._connects.push(t.connect(c,"onFirstMove",this._firstMoveHandler));this._connects.push(t.connect(c,"onMoveStop",this._moveStopHandler));c.onMove=this._moveHandler;(b=b.getEventSource())&&
s.set(b,"cursor",this._toolbar._cursors["box"+h]);return c}},_moveStartHandler:function(a){this._toolbar["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(a){var h=a.host._index,b=this._wrapOffset=a.host.shape._wrapOffsets[0]||0,c=this._graphic.getLayer()._div.getTransform(),l;a=e.map(this._getBoxCoords(!0),function(a){return{x:a[0]+b,y:a[1]}});l=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:a[1].x,y:a[3].y};this._centerCoord=
g.multiplyPoint(g.invert(c),l);if(8===h)l=g.multiplyPoint(g.invert(c),a[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,l)),this._startLine=[this._centerCoord,l],this._moveLine=q.clone(this._startLine);else if(l=g.multiplyPoint(g.invert(c),a[h]),c=g.multiplyPoint(g.invert(c),a[(h+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,l)),this._firstMoverToAnchor=Math.sqrt((l.x-this._centerCoord.x)*(l.x-this._centerCoord.x)+(l.y-this._centerCoord.y)*
(l.y-this._centerCoord.y)),this._startBox=c,this._startBox.width=a[4].x-a[0].x,this._startBox.height=a[4].y-a[0].y,this._moveBox=q.clone(this._startBox),this._xfactor=l.x>c.x?1:-1,this._yfactor=l.y>c.y?1:-1,1===h||5===h)this._xfactor=0;else if(3===h||7===h)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===h?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(a,h){var b=a.host._index,c=this._defaultEventArgs,l,d,k,e;c.angle=0;c.scaleX=1;
c.scaleY=1;if(8===b)l=this._startLine,d=this._moveLine,k=d[1],k.x+=h.dx,k.y+=h.dy,k=this._getAngle(l,d),this._isTextPoint&&(k+=this._graphic.symbol.angle),d=g.rotategAt(k,l[0]),this._graphic.getDojoShape().setTransform(d),c.transform=d,c.angle=k,c.around=l[0];else{l=this._startBox;d=this._moveBox;d.width+=h.dx*this._xfactor;d.height+=h.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(l=d.x+this._xfactor*d.width,d=d.y+this._yfactor*d.height,l=Math.sqrt((l-this._centerCoord.x)*(l-this._centerCoord.x)+
(d-this._centerCoord.y)*(d-this._centerCoord.y)),this._scaleRatio=k=e=l/this._firstMoverToAnchor,l=this._centerCoord):(k=d.width/l.width,e=d.height/l.height,l={x:l.x,y:l.y});if(isNaN(k)||Infinity===k||-Infinity===k)k=1;if(isNaN(e)||Infinity===e||-Infinity===e)e=1;d=g.scaleAt(k,e,l);if(this._isTextPoint){var n=g.rotategAt(this._graphic.symbol.angle,l);this._graphic.getDojoShape().setTransform([n,d])}else this._graphic.getDojoShape().setTransform(d);c.transform=d;c.scaleX=k;c.scaleY=e;c.around=l}this._toolbar["on"+
(8===b?this._rotateEvent:this._scaleEvent)](this._graphic,c)},_moveStopHandler:function(a){var b=this._graphic,l=this._toolbar,d=l._geo?c.geographicToWebMercator(b.geometry):b.geometry,k=d.spatialReference,g=b.getDojoShape(),e=g.getTransform(),n=b.getLayer()._div.getTransform();this._isTextPoint?(b=this._graphic.symbol,8===a.host._index?b.angle+=this._getAngle(this._startLine,this._moveLine):b.font.setSize(Math.round(100*b.font.size*this._scaleRatio)/100),this._graphic.setSymbol(b)):(d=d.toJson(),
this._updateSegments(d.paths||d.rings,e,n,k),g.setTransform(null),d=h.fromJson(d),b.setGeometry(l._geo?c.webMercatorToGeographic(d,!0):d));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;l._endOperation("BOX");this._defaultEventArgs.transform=e;l["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(a,h,b,c){var l=this._map,d=this._wrapOffset||0;e.forEach(a,function(a){e.forEach(a,
function(a){this._updatePoint(a,c,d,g,l,b,h)},this)},this)},_updatePoint:function(a,h,b,c,l,d,k){h=l.toScreen({x:a[0],y:a[1],spatialReference:h},!0);h.x+=b;h=c.multiplyPoint([d,k,c.invert(d)],h);h.x-=b;b=l.toMap(h);a[0]=b.x;a[1]=b.y},_getAngle:function(a,h){var b=180*Math.atan2(a[0].y-a[1].y,a[0].x-a[1].x)/Math.PI;return 180*Math.atan2(h[0].y-h[1].y,h[0].x-h[1].x)/Math.PI-b},_deNormalizePoint:function(a,h){var b=this._map._getFrameWidth();if(-1===b)return a;for(var c={x:a.x,y:a.y};Math.abs(c.x-h.x)>=
b;)c.x=c.x<h.x?c.x+b:c.x-b;var l=Math.abs(c.x-h.x);Math.abs(c.x-h.x+b)<l?c.x+=b:Math.abs(c.x-h.x-b)<l&&(c.x-=b);return c}});v("extend-esri")&&q.setObject("toolbars._Box",f,d);return f})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,
showAttribution:null});e("extend-esri")&&q.setObject("tasks.PrintTemplate",f,t);return f})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(f,q,e){function t(d){var k=Math.cos(d);d=Math.sin(d);var b={x:k+4/3*(1-k),y:d-4/3*k*(1-k)/d};return{s:{x:k,y:-d},c1:{x:b.x,y:-b.y},c2:b,e:{x:k,y:d}}}var u=2*Math.PI,v=Math.PI/4,s=Math.PI/8,m=v+s,g=t(s);return f.arc={unitArcAsBezier:t,curvePI4:g,arcAsBezier:function(d,k,b,n,a,c,h,l){a=Boolean(a);c=Boolean(c);var r=e._degToRad(n);
n=k*k;var z=b*b,f=e.multiplyPoint(e.rotate(-r),{x:(d.x-h)/2,y:(d.y-l)/2}),q=f.x*f.x,x=f.y*f.y;n=Math.sqrt((n*z-n*x-z*q)/(n*x+z*q));isNaN(n)&&(n=0);n={x:n*k*f.y/b,y:-n*b*f.x/k};a==c&&(n={x:-n.x,y:-n.y});n=e.multiplyPoint([e.translate((d.x+h)/2,(d.y+l)/2),e.rotate(r)],n);k=e.normalize([e.translate(n.x,n.y),e.rotate(r),e.scale(k,b)]);n=e.invert(k);d=e.multiplyPoint(n,d);l=e.multiplyPoint(n,h,l);h=Math.atan2(d.y,d.x);l=Math.atan2(l.y,l.x);n=h-l;c&&(n=-n);0>n?n+=u:n>u&&(n-=u);b=s;l=g;b=c?b:-b;d=[];for(a=
n;0<a;a-=v)a<m&&(b=a/2,l=t(b),b=c?b:-b,a=0),f=e.normalize([k,e.rotate(h+b)]),c?(n=e.multiplyPoint(f,l.c1),r=e.multiplyPoint(f,l.c2),f=e.multiplyPoint(f,l.e)):(n=e.multiplyPoint(f,l.c2),r=e.multiplyPoint(f,l.c1),f=e.multiplyPoint(f,l.s)),d.push([n.x,n.y,r.x,r.y,f.x,f.y]),h+=2*b;return d}}})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(f,q,e,t,u,v,s){f=
f(s,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(e,g){g&&(g.imageParameters&&g.imageParameters.extent)&&(this.initialExtent=this.fullExtent=g.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=q.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(f,g,d,k){var b=f.spatialReference.wkid;k(this._url.path+"?"+u.objectToQuery(q.mixin(this._params,{f:"image",bbox:e.toJson(f.toJson()),bboxSR:b,imageSR:b,
size:g+","+d})))}});t("extend-esri")&&q.setObject("tasks._GPResultImageLayer",f,v);return f})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(f,q,e){var t={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"},u={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},
v={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},s={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},m={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},g={LengthUnit:t,OutputLine:u,UTurn:v,OutputPolygon:s,TravelDirection:m};q("extend-esri")&&(f.setObject("tasks._NALengthUnit",
t,e),f.setObject("tasks.NAOutputLine",u,e),f.setObject("tasks.NAUTurn",v,e),f.setObject("tasks.NAOutputPolygon",s,e),f.setObject("tasks.NATravelDirection",m,e));return g})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b,n,a,c,h){k("dijit-legacy-requires")&&h(0,function(){f(["dijit/MenuItem",
"dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return e("dijit.Menu",c,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):q.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return n.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||
a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=t.byId(a,this.ownerDocument);var h;if("iframe"==a.tagName.toLowerCase()){var c=a;h=this._iframeContentWindow(c);h=b.body(h.document)}else h=a==b.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var k={node:a,iframe:c};u.set(a,"_dijitMenu"+this.id,
this._bindings.push(k));var e=g.hitch(this,function(a){var h=this.selector,b=h?function(a){return d.selector(h,a)}:function(a){return a},l=this;return[d(a,b(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<this._lastKeyDown+500||l._scheduleOpen(this,c,{x:a.pageX,y:a.pageY},a.target)}),d(a,b("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==m.F10||this.leftClickToOpen&&a.keyCode==m.SPACE)a.stopPropagation(),a.preventDefault(),
l._scheduleOpen(this,c,null,a.target),this._lastKeyDown=(new Date).getTime()})]});k.connects=h?e(h):[];c&&(k.onloadHandler=g.hitch(this,function(){var a=this._iframeContentWindow(c),a=b.body(a.document);k.connects=e(a)}),c.addEventListener?c.addEventListener("load",k.onloadHandler,!1):c.attachEvent("onload",k.onloadHandler))},unBindDomNode:function(a){var h;try{h=t.byId(a,this.ownerDocument)}catch(b){return}a="_dijitMenu"+this.id;if(h&&u.has(h,a)){for(var c=u.get(h,a)-1,d=this._bindings[c],k;k=d.connects.pop();)k.remove();
(k=d.iframe)&&(k.removeEventListener?k.removeEventListener("load",d.onloadHandler,!1):k.detachEvent("onload",d.onloadHandler));u.remove(h,a);delete this._bindings[c]}},_scheduleOpen:function(a,h,b,c){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:c,delegatedTarget:a,iframe:h,coords:b})},1))},_openMyself:function(h){function b(){m.refocus&&u&&u.focus();a.close(m)}var c=h.target,d=h.iframe,g=h.coords,e=!g;this.currentTarget=h.delegatedTarget;
if(g){if(d){h=v.position(d,!0);var c=this._iframeContentWindow(d),c=v.docScroll(c.document),n=s.getComputedStyle(d),E=s.toPixelValue,f=(k("ie")&&k("quirks")?0:E(d,n.paddingLeft))+(k("ie")&&k("quirks")?E(d,n.borderLeftWidth):0),d=(k("ie")&&k("quirks")?0:E(d,n.paddingTop))+(k("ie")&&k("quirks")?E(d,n.borderTopWidth):0);g.x+=h.x+f-c.x;g.y+=h.y+d-c.y}}else g=v.position(c,!0),g.x+=10,g.y+=10;var m=this,d=this._focusManager.get("prevNode");h=this._focusManager.get("curNode");var u=!h||t.isDescendant(h,
this.domNode)?d:h;a.open({popup:this,x:g.x,y:g.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();e||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);a.close(this)}},destroy:function(){q.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ./Task ../geometry/Polygon ../renderers/SimpleRenderer ../geometry/scaleUtils ./Geoprocessor ./PrintTemplate dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(f,q,e,t,u,v,s,m,g,d,k,b,n,a,c,h,l,r,z,w,F){f=f(b,{declaredClass:"esri.tasks.PrintTask",constructor:function(a,b){this.url=a;this.printGp=new h(this.url);this._handler=q.hitch(this,this._handler);b&&b.async&&(this.async=b.async);this._colorEvaluator=F("$..color")},_handler:function(a,h,b,c,d){try{var l;this.async?"esriJobSucceeded"===a.jobStatus&&this.printGp.getResultData(a.jobId,"Output_File",q.hitch(this,function(a){l=a.value;this._successHandler([l],"onComplete",b,d)})):(l=a[0].value,
this._successHandler([l],"onComplete",b,d))}catch(k){this._errorHandler(k,c,d)}},execute:function(a,h,b){var c=this._handler,k=this._errorHandler,g=a.template||new l,r=g.exportOptions,n;r&&(n={outputSize:[r.width,r.height],dpi:r.dpi});this._outScale=g.outScale;this._preserveScale=!1!==g.preserveScale;var r=g.layoutOptions,B,f=[];if(r){this.legendAll=!1;r.legendLayers?e.forEach(r.legendLayers,function(a){var h={};h.id=a.layerId;a.subLayerIds&&(h.subLayerIds=a.subLayerIds);f.push(h)}):this.legendAll=
!0;var s,v;if("Miles"===r.scalebarUnit||"Kilometers"===r.scalebarUnit)s="esriKilometers",v="esriMiles";else if("Meters"===r.scalebarUnit||"Feet"===r.scalebarUnit)s="esriMeters",v="esriFeet";B={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};B={titleText:r.titleText,authorText:r.authorText,copyrightText:r.copyrightText,customTextElements:r.customTextElements,scaleBarOptions:{metricUnit:s,metricLabel:B[s],nonMetricUnit:v,nonMetricLabel:B[v]},legendOptions:{operationalLayers:f}}}s=this._getPrintDefinition(a.map);
a.outSpatialReference&&(s.mapOptions.spatialReference=a.outSpatialReference.toJson());a.template&&m.isDefined(a.template.showAttribution)&&(s.mapOptions.showAttribution=a.template.showAttribution);q.mixin(s,{exportOptions:n,layoutOptions:B});this.allLayerslegend&&q.mixin(s.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});g={Web_Map_as_JSON:t.toJson(m.fixJson(s)),Format:g.format,Layout_Template:g.layout};a.extraParameters&&(g=q.mixin(g,a.extraParameters));var K=new u(d._dfdCanceller);
a=function(a,d){c(a,d,h,b,K)};n=function(a){k(a,b,K)};K._pendingDfd=this.async?this.printGp.submitJob(g,a,null,n):this.printGp.execute(g,a,n);return K},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},
featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(a){if(!(8>=v("ie"))&&
a.path){this._canvasHolder||(this._canvasHolder=r.create("div"),this._canSurface=w.createSurface(this._canvasHolder,200,200));var h=this._canSurface.createObject(w.Path,a.path).setFill(a.color).setStroke(a.outline);"pendingRender"in this._canSurface&&this._canSurface._render(!0);var b=this._canSurface.rawNode.getContext("2d"),c=Math.ceil(h.getBoundingBox().width+h.getBoundingBox().x),d=Math.ceil(h.getBoundingBox().height+h.getBoundingBox().y),l=b.getImageData(h.getBoundingBox().x,h.getBoundingBox().y,
c,d);b.canvas.width=c;b.canvas.height=d;b.putImageData(l,0,0);b=b.canvas.toDataURL("image/png");return{type:"esriPMS",imageData:b.substr(22,b.length),angle:-a.angle,contentType:"image/png",height:a.size?a.size:d-h.getBoundingBox().y,width:a.size?a.size:c-h.getBoundingBox().x,xoffset:a.xoffset,yoffset:a.yoffset}}},_convertSvgRenderer:function(a){"simple"===a.type&&a.symbol&&a.symbol.path?a.symbol=this._convertSvgSymbol(a.symbol):"uniqueValue"===a.type?(a.defaultSymbol&&a.defaultSymbol.path&&(a.defaultSymbol=
this._convertSvgSymbol(a.defaultSymbol)),a.uniqueValueInfos&&e.forEach(a.uniqueValueInfos,function(a){a.symbol.path&&(a.symbol=this._convertSvgSymbol(a.symbol))},this)):"classBreaks"===a.type&&(a.defaultSymbol&&a.defaultSymbol.path&&(a.defaultSymbol=this._convertSvgSymbol(a.defaultSymbol)),a.classBreakInfos&&e.forEach(a.classBreakInfos,function(a){a.symbol.path&&(a.symbol=this._convertSvgSymbol(a.symbol))},this))},_createFeatureCollection:function(a,h,b){var c=this._createPolygonLayer(),d=this._createPolylineLayer(),
l=this._createPointLayer(),g=this._createMultipointLayer(),k=this._createPointLayer();k.layerDefinition.name="textLayer";delete k.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass)c.layerDefinition.name=d.layerDefinition.name=l.layerDefinition.name=g.layerDefinition.name=q.getObject("arcgisProps.title",!1,a)||a.name||a.id;if(a.renderer&&!q.isFunction(a.renderer.attributeField)){var r=a.renderer.toJson();if("temporal"===r.type){var r=
{latestObservationRenderer:r.latestObservationRenderer,trackLinesRenderer:r.trackRenderer,observationAger:r.observationAger,renderer:r.observationRenderer},f={};a._trackIdField&&(f.trackIdField=a._trackIdField);a._startTimeField&&(f.startTimeField=a._startTimeField);a._endTimeField&&(f.endTimeField=a._endTimeField);c.layerDefinition.drawingInfo=r;c.layerDefinition.timeInfo=f;d.layerDefinition.drawingInfo=r;d.layerDefinition.timeInfo=f;l.layerDefinition.drawingInfo=r;l.layerDefinition.timeInfo=f;g.layerDefinition.drawingInfo=
r;g.layerDefinition.timeInfo=f}else c.layerDefinition.drawingInfo.renderer=r,d.layerDefinition.drawingInfo.renderer=r,l.layerDefinition.drawingInfo.renderer=r,g.layerDefinition.drawingInfo.renderer=r}else delete c.layerDefinition.drawingInfo,delete d.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete g.layerDefinition.drawingInfo;r=a.fields;!r&&(a.renderer&&!q.isFunction(a.renderer.attributeField))&&("esri.renderer.ClassBreaksRenderer"===a.renderer.declaredClass?(r=[{name:a.renderer.attributeField,
type:"esriFieldTypeDouble"}],a.renderer.normalizationField&&r.push({name:a.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===a.renderer.declaredClass&&(r=[{name:a.renderer.attributeField,type:"esriFieldTypeString"}],a.renderer.attributeField2&&r.push({name:a.renderer.attributeField2,type:"esriFieldTypeString"}),a.renderer.attributeField3&&r.push({name:a.renderer.attributeField3,type:"esriFieldTypeString"})));r&&(c.layerDefinition.fields=r,d.layerDefinition.fields=
r,l.layerDefinition.fields=r,g.layerDefinition.fields=r);var r=a.graphics.length,s;for(s=0;s<r;s++){var m=a.graphics[s];if(!1!==m.visible&&m.geometry&&(f=m.toJson(),!f.symbol||!(f.symbol.outline&&"esriCLS"===f.symbol.outline.type))){f.symbol&&(f.symbol.outline&&f.symbol.outline.color&&f.symbol.outline.color[3])&&(f.symbol.outline.color[3]=255);if(a.renderer&&!f.symbol&&(q.isFunction(a.renderer.attributeField)||a.renderer.hasVisualVariables()||"esri.renderer.DotDensityRenderer"===a.renderer.declaredClass||
b)){b=b||a.renderer;var K=b.getSymbol(m);if(!K)continue;f.symbol=K.toJson();b.hasVisualVariables()&&this._applyVisualVariables(f.symbol,{renderer:b,graphic:m,symbol:K,mapResolution:h&&h.getResolutionInMeters()})}f.symbol&&(f.symbol.path?f.symbol=this._convertSvgSymbol(f.symbol):f.symbol.text&&delete f.attributes);switch(m.geometry.type){case "polygon":c.featureSet.features.push(f);break;case "polyline":d.featureSet.features.push(f);break;case "point":f.symbol&&f.symbol.text?k.featureSet.features.push(f):
l.featureSet.features.push(f);break;case "multipoint":g.featureSet.features.push(f);break;case "extent":f.geometry=n.fromExtent(m.geometry).toJson(),c.featureSet.features.push(f)}}}h=[];0<c.featureSet.features.length&&h.push(c);0<d.featureSet.features.length&&h.push(d);0<g.featureSet.features.length&&h.push(g);0<l.featureSet.features.length&&h.push(l);0<k.featureSet.features.length&&h.push(k);e.forEach(h,function(a){a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(a.layerDefinition.drawingInfo.renderer)},
this);return{id:a.id,opacity:a.opacity,minScale:a.minScale||0,maxScale:a.maxScale||0,featureCollection:{layers:h}}},_getPrintDefinition:function(a){var h={operationalLayers:this._createOperationalLayers(a)},b=a.extent,d=a.spatialReference;a.spatialReference._isWrappable()&&(b=b._normalize(!0),d=b.spatialReference);b={mapOptions:{showAttribution:a.showAttribution,extent:b.toJson(),spatialReference:d.toJson()}};this._preserveScale&&q.mixin(b.mapOptions,{scale:this._outScale||c.getScale(a)});a.timeExtent&&
q.mixin(b.mapOptions,{time:[a.timeExtent.startTime.getTime(),a.timeExtent.endTime.getTime()]});a={};q.mixin(a,b,h);return a},_createOperationalLayers:function(h){var b,c,d,l,k=[],r=[];this.allLayerslegend=this.legendAll?[]:null;var n=e.map(h.layerIds,h.getLayer,h);h._mapImageLyr&&n.push(h._mapImageLyr);for(b=0;b<n.length;b++)if(c=n[b],c.loaded&&c.visible&&-1===e.indexOf(k,c.id))switch(d=c.declaredClass,l={id:c.id,title:q.getObject("arcgisProps.title",!1,c)||c.id,opacity:c.opacity,minScale:c.minScale||
0,maxScale:c.maxScale||0},l=q.mixin(l,this._getUrlAndToken(c)),d){case "esri.layers.ArcGISDynamicMapServiceLayer":var f=[];d=!!c._params.layers;if(c._params.dynamicLayers)d=t.fromJson(c._params.dynamicLayers),e.forEach(d,function(a){f.push({id:a.id,name:a.name,layerDefinition:a});delete a.id;delete a.name;delete a.maxScale;delete a.minScale});else if(c.supportsDynamicLayers){if(d||c.layerDefinitions||c.layerTimeOptions){var s=c.createDynamicLayerInfosFromLayerInfos(),m=null;d&&(m=c.visibleLayers);
var m=g._getVisibleLayers(s,m),v=g._getLayersForScale(this._outScale||h.getScale(),s);e.forEach(s,function(a){if(!a.subLayerIds){var h=a.id;-1<e.indexOf(m,h)&&-1<e.indexOf(v,h)&&(a={source:a.source.toJson()},c.layerDefinitions&&c.layerDefinitions[h]&&(a.definitionExpression=c.layerDefinitions[h]),c.layerTimeOptions&&c.layerTimeOptions[h]&&(a.layerTimeOptions=c.layerTimeOptions[h].toJson()),f.push({id:h,layerDefinition:a}))}});0===f.length&&(l.visibleLayers=[-1])}}else e.forEach(c.layerInfos,function(a){var h=
{id:a.id,layerDefinition:{}};c.layerDefinitions&&c.layerDefinitions[a.id]&&(h.layerDefinition.definitionExpression=c.layerDefinitions[a.id]);c.layerTimeOptions&&c.layerTimeOptions[a.id]&&(h.layerDefinition.layerTimeOptions=c.layerTimeOptions[a.id].toJson());(h.layerDefinition.definitionExpression||h.layerDefinition.layerTimeOptions)&&f.push(h)}),d&&(l.visibleLayers=c.visibleLayers);f.length&&(l.layers=f);r.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:c.id,subLayerIds:c.visibleLayers});
break;case "esri.layers.ArcGISImageServiceLayer":l=q.mixin(l,{url:c.url,bandIds:c.bandIds,compressionQuality:c.compressionQuality,format:c.format,interpolation:c.interpolation});c.mosaicRule&&q.mixin(l,{mosaicRule:c.mosaicRule.toJson()});c.renderingRule&&q.mixin(l,{renderingRule:c.renderingRule.toJson()});r.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:c.id});break;case "esri.layers.WMSLayer":l=q.mixin(l,{url:c.url,title:c.title,type:"wms",version:c.version,transparentBackground:c.imageTransparency,
visibleLayers:c.visibleLayers});r.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:c.id,subLayerIds:c.visibleLayers});break;case "esri.virtualearth.VETiledLayer":d=c.mapStyle;"aerialWithLabels"===d&&(d="Hybrid");l=q.mixin(l,{visibility:c.visible,type:"BingMaps"+d,culture:c.culture,key:c.bingMapsKey});r.push(l);break;case "esri.layers.OpenStreetMapLayer":l=q.mixin(l,{type:"OpenStreetMap",url:c.tileServers[0]});r.push(l);break;case "esri.layers.WMTSLayer":l=q.mixin(l,{url:c.url,type:"wmts",
layer:c._identifier,style:c._style,format:c.format,tileMatrixSet:c._tileMatrixSetId});r.push(l);break;case "esri.layers.MapImageLayer":d=c.getImages();e.forEach(d,function(a,h){a.href&&(l={id:c.id+"_image"+h,type:"image",title:c.id,minScale:c.minScale||0,maxScale:c.maxScale||0,opacity:c.opacity*a.opacity,extent:a.extent.toJson()},"data:image/png;base64,"===a.href.substr(0,22)?l.imageData=a.href.substr(22):l.url=a.href,r.push(l))});break;case "esri.layers.WebTiledLayer":d=c.url.replace(/\$\{/g,"{");
l=q.mixin(l,{type:"WebTiledLayer",urlTemplate:d,credits:c.copyright});c.subDomains&&0<c.subDomains.length&&(l.subDomains=c.subDomains);r.push(l);break;default:if(c.getTileUrl||c.getImageUrl)l=q.mixin(l,{url:c.url}),r.push(l)}for(b=0;b<h.graphicsLayerIds.length;b++)if(c=h.getLayer(h.graphicsLayerIds[b]),c.loaded&&c.visible&&-1===e.indexOf(k,c.id))switch(d=c.declaredClass,d){case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.CSVLayer":case "esri.layers.StreamLayer":if(c.renderer&&
"esri.renderer.HeatmapRenderer"===c.renderer.declaredClass)continue;n=null;c.url&&c.renderer&&("esri.renderer.ScaleDependentRenderer"===c.renderer.declaredClass?"scale"===c.renderer.rangeType?n=c.renderer.getRendererInfoByScale(h.getScale())&&c.renderer.getRendererInfoByScale(h.getScale()).renderer:"zoom"===c.renderer.rangeType&&(n=c.renderer.getRendererInfoByZoom(h.getZoom())&&c.renderer.getRendererInfoByZoom(h.getZoom()).renderer):n=c.renderer);if(n&&("esri.renderer.SimpleRenderer"===n.declaredClass||
"esri.renderer.TemporalRenderer"===n.declaredClass||q.isString(n.attributeField)&&c._getField(n.attributeField,!0))&&!n.hasVisualVariables()&&"esri.renderer.DotDensityRenderer"!==n.declaredClass&&"esri.layers.CSVLayer"!==c.declaredClass&&"esri.layers.StreamLayer"!==c.declaredClass)if(l={id:c.id,title:q.getObject("arcgisProps.title",!1,c)||c.id,opacity:c.opacity,minScale:c.minScale||0,maxScale:c.maxScale||0,layerDefinition:{drawingInfo:{renderer:n.toJson()}}},l=q.mixin(l,this._getUrlAndToken(c)),"esri.renderer.TemporalRenderer"===
n.declaredClass&&(d=l.layerDefinition.drawingInfo,d.latestObservationRenderer=d.renderer.latestObservationRenderer,d.trackLinesRenderer=d.renderer.trackRenderer,d.observationAger=d.renderer.observationAger,d.renderer=d.renderer.observationRenderer,c._trackIdField&&(l.layerDefinition.timeInfo={trackIdField:c._trackIdField})),this._convertSvgRenderer(l.layerDefinition.drawingInfo.renderer),1>c.opacity||"esri.renderer.TemporalRenderer"===n.declaredClass||this._updateLayerOpacity(l))if(c._params.source&&
(n=c._params.source.toJson(),q.mixin(l.layerDefinition,{source:n})),c.getDefinitionExpression()&&q.mixin(l.layerDefinition,{definitionExpression:c.getDefinitionExpression()}),2!==c.mode)0<c.getSelectedFeatures().length&&(n=e.map(c.getSelectedFeatures(),function(a){return a.attributes[c.objectIdField]}),0<n.length&&c.getSelectionSymbol()&&q.mixin(l,{selectionObjectIds:n,selectionSymbol:c.getSelectionSymbol().toJson()}));else{n=e.map(c.getSelectedFeatures(),function(a){return a.attributes[c.objectIdField]});
if(0===n.length||!c._params.drawMode)break;q.mixin(l.layerDefinition,{objectIds:n});n=null;c.getSelectionSymbol()&&(n=new a(c.getSelectionSymbol()));q.mixin(l.layerDefinition.drawingInfo,{renderer:n&&n.toJson()})}else l=this._createFeatureCollection(c);else l=n&&(n.hasVisualVariables()||"esri.renderer.DotDensityRenderer"===n.declaredClass)?this._createFeatureCollection(c,h,n):this._createFeatureCollection(c);r.push(l);this.allLayerslegend&&this.allLayerslegend.push({id:c.id});break;case "esri.layers.GraphicsLayer":l=
this._createFeatureCollection(c),r.push(l),this.allLayerslegend&&this.allLayerslegend.push({id:c.id})}h.graphics&&0<h.graphics.graphics.length&&(l=this._createFeatureCollection(h.graphics),r.push(l));h._labels&&(l=this._createFeatureCollection(h._labels),r.push(l));return r},_getUrlAndToken:function(a){return{token:a._getToken(),url:a._url?a._url.path:null}},_updateLayerOpacity:function(a){var c=this._colorEvaluator(a),c=e.filter(c,function(a){return q.isArray(a)&&4===a.length}),h=!0;if(c.length){var b=
c[0][3],d;for(d=1;d<c.length;d++)if(b!==c[d][3]){h=!1;break}if(h){a.opacity=b/255;for(d=0;d<c.length;d++)c[d][3]=255}}return h},_applyVisualVariables:function(a,c){var h=c.renderer,b=c.graphic,d=c.symbol,l=c.mapResolution,g=d.type;if(!("textsymbol"===g||"shieldlabelsymbol"===g)){var r=h.getVisualVariablesForType("sizeInfo"),n=h.getVisualVariablesForType("colorInfo"),e=h.getVisualVariablesForType("opacityInfo"),r=r&&r[0],n=n&&n[0],e=e&&e[0];r&&(d=h.getSize(b,{sizeInfo:r,shape:"simplemarkersymbol"===
g?d.style:null,resolution:l}),null!=d&&("simplemarkersymbol"===g?a.size=z.px2pt(d):"picturemarkersymbol"===g?(a.width=z.px2pt(d),a.height=z.px2pt(d)):"simplelinesymbol"===g?a.width=z.px2pt(d):a.outline&&(a.outline.width=z.px2pt(d))));if(n&&(d=h.getColor(b,{colorInfo:n}))&&("simplemarkersymbol"===g||"simplelinesymbol"===g||"simplefillsymbol"===g))a.color=k.toJsonColor(d);e&&(h=h.getOpacity(b,{opacityInfo:e}),null!=h&&a.color&&(a.color[3]=Math.round(255*h)))}}});v("extend-esri")&&q.setObject("tasks.PrintTask",
f,s);return f})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b,n,a,c){return q("dijit._MenuBase",[b,c,a,n],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&
a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){u.toggle(this.domNode,"dijitMenuActive",a);u.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var c=k.byNode(a);return a.parentNode==this.containerNode&&c&&c.focus},postCreate:function(){var a=this,c="string"==typeof this.childSelector?this.childSelector:v.hitch(this,"childSelector");this.own(m(this.containerNode,
m.selector(c,s.enter),function(){a.onItemHover(k.byNode(this))}),m(this.containerNode,m.selector(c,s.leave),function(){a.onItemUnhover(k.byNode(this))}),m(this.containerNode,m.selector(c,d),function(c){a.onItemClick(k.byNode(this),c);c.stopPropagation()}),m(this.containerNode,m.selector(c,"focusin"),function(){a._onItemFocus(k.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,c,b,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,c)},_keyboardSearchCompare:function(a,
c){return a.shortcutKey?c==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&
(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=
this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=
this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,c){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var b=/^key/.test(c._origType||c.type)||0==c.clientX&&0==c.clientY;this._openItemPopup(a,b)}else this.onExecute(),a._onClick?a._onClick(c):a.onClick(c)},_openItemPopup:function(a,c){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());
this._stopPopupTimer();var b=a.popup;b.parentMenu=this;this.own(this._mouseoverHandle=m.once(b.domNode,"mouseover",v.hitch(this,"_onPopupHover")));var d=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){c&&d.focusChild(a);d._cleanUp()},onExecute:v.hitch(this,"_cleanUp",!0),onClose:function(){d._mouseoverHandle&&(d._mouseoverHandle.remove(),delete d._mouseoverHandle)}},c);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",
!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(t.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);
this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b,n){function a(a,c,b,h,d,l,g,k,r,n){var e,f,B=c.length,m=0;n?(f=n.l/d,m=n.i):f=c[0]/d;for(;l<
g;)l+f>g&&(e={l:(l+f-g)*d,i:m},f=g-l),m%2||(a.beginPath(),a.arc(b,h,d,l,l+f,k),r&&a.stroke()),l+=f,++m,f=c[m%B]/d;return e}function c(a,c,b,h){var d=0,l=0,g,k=0;h?(g=h.l,k=h.i):g=c[0];for(;1>l;)l=n.tAtLength(a,g),1==l&&(d=n.computeLength(a),d={l:g-d,i:k}),a=n.splitBezierAtT(a,l),k%2||b.push(a[0]),a=a[1],++k,g=c[k%c.length];return d}function h(a,b,h,d){var l=[b.last.x,b.last.y].concat(h),g=!(a instanceof Array);h=4===h.length?"quadraticCurveTo":"bezierCurveTo";var k=[];b=c(l,b.canvasDash,k,d);for(d=
0;d<k.length;++d)l=k[d],g?(a.moveTo(l[0],l[1]),a[h].apply(a,l.slice(2))):(a.push("moveTo",[l[0],l[1]]),a.push(h,l.slice(2)));return b}function l(a,c,b,h,d,l,g){var k=0,r=0,e=0,f=n.distance(b,h,d,l),B=0;c=c.canvasDash;var m=b,s=h,v,I=!(a instanceof Array);g?(e=g.l,B=g.i):e+=c[0];for(;0.01<Math.abs(1-r);)e>f&&(k={l:e-f,i:B},e=f),r=e/f,g=b+(d-b)*r,v=h+(l-h)*r,B++%2||(I?(a.moveTo(m,s),a.lineTo(g,v)):(a.push("moveTo",[m,s]),a.push("lineTo",[g,v]))),m=g,s=v,e+=c[B%c.length];return k}var r=f.canvas={},z=
null,w=k.multiplyPoint,F=Math.PI,x=2*F,A=F/2;b=q.extend;if(u.global.CanvasRenderingContext2D){u=u.doc.createElement("canvas").getContext("2d");var E="function"==typeof u.setLineDash,y="function"==typeof u.fillText}var H={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};r.Shape=t("dojox.gfx.canvas.Shape",m.Shape,{_render:function(a){a.save();this._renderTransform(a);
this._renderClip(a);this._renderShape(a);this._renderFill(a,!0);this._renderStroke(a,!0);a.restore()},_renderClip:function(a){this.canvasClip&&(this.canvasClip.render(a),a.clip())},_renderTransform:function(a){if("canvasTransform"in this){var c=this.canvasTransform;a.translate(c.dx,c.dy);a.rotate(c.angle2);a.scale(c.sx,c.sy);a.rotate(c.angle1)}},_renderShape:function(a){},_renderFill:function(a,c){if("canvasFill"in this){var b=this.fillStyle;if("canvasFillImage"in this){var h=b.width,d=b.height,l=
this.canvasFillImage.width,g=this.canvasFillImage.height,k=Math.min(h==l?1:h/l,d==g?1:d/g),r=(h-k*l)/2,n=(d-k*g)/2;z.width=h;z.height=d;var e=z.getContext("2d");e.clearRect(0,0,h,d);e.drawImage(this.canvasFillImage,0,0,l,g,r,n,k*l,k*g);this.canvasFill=a.createPattern(z,"repeat");delete this.canvasFillImage}a.fillStyle=this.canvasFill;c&&("pattern"===b.type&&(0!==b.x||0!==b.y)&&a.translate(b.x,b.y),a.fill())}else a.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(a,c){var b=this.strokeStyle;b?(a.strokeStyle=
b.color.toString(),a.lineWidth=b.width,a.lineCap=b.cap,"number"==typeof b.join?(a.lineJoin="miter",a.miterLimit=b.join):a.lineJoin=b.join,this.canvasDash?E?(a.setLineDash(this.canvasDash),c&&a.stroke()):this._renderDashedStroke(a,c):c&&a.stroke()):c||(a.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(a,c){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(a){this.inherited(arguments);var c=a?"width"in
a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!c)return this;this.canvasClip=a?G(c,a):null;this.parent&&this.parent._makeDirty();return this}});var G=function(a,c){switch(a){case "ellipse":return{canvasEllipse:I({shape:c}),render:function(a){return r.Ellipse.prototype._renderShape.call(this,a)}};case "rect":return{shape:q.delegate(c,{r:0}),render:function(a){return r.Rect.prototype._renderShape.call(this,a)}};case "path":return{canvasPath:D(c),render:function(a){this.canvasPath._renderShape(a)}};
case "polyline":return{canvasPolyline:c.points,render:function(a){return r.Polyline.prototype._renderShape.call(this,a)}}}return null},D=function(a){var c=new dojox.gfx.canvas.Path;c.canvasPath=[];c._setPath(a.d);return c},C=function(a,c,b){var h=a.prototype[c];a.prototype[c]=b?function(){this.parent&&this.parent._makeDirty();h.apply(this,arguments);b.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return h.apply(this,arguments)}};C(r.Shape,"setTransform",function(){this.matrix?
this.canvasTransform=f.decompose(this.matrix):delete this.canvasTransform});C(r.Shape,"setFill",function(){var a=this.fillStyle,c;if(a){if("object"==typeof a&&"type"in a){var b=this.surface.rawNode.getContext("2d");switch(a.type){case "linear":case "radial":c="linear"==a.type?b.createLinearGradient(a.x1,a.y1,a.x2,a.y2):b.createRadialGradient(a.cx,a.cy,0,a.cx,a.cy,a.r);e.forEach(a.colors,function(a){c.addColorStop(a.offset,f.normalizeColor(a.color).toString())});break;case "pattern":z||(z=document.createElement("canvas")),
b=new Image,this.surface.downloadImage(b,a.src),this.canvasFillImage=b}}else c=a.toString();this.canvasFill=c}else delete this.canvasFill});C(r.Shape,"setStroke",function(){var a=this.strokeStyle;if(a){var c=this.strokeStyle.style.toLowerCase();c in H&&(c=H[c]);if(c instanceof Array){this.canvasDash=c=c.slice();var b;for(b=0;b<c.length;++b)c[b]*=a.width;if("butt"!=a.cap){for(b=0;b<c.length;b+=2)c[b]-=a.width,1>c[b]&&(c[b]=1);for(b=1;b<c.length;b+=2)c[b]+=a.width}}else delete this.canvasDash}else delete this.canvasDash;
this._needsDash=!E&&!!this.canvasDash});C(r.Shape,"setShape");r.Group=t("dojox.gfx.canvas.Group",r.Shape,{constructor:function(){m.Container._init.call(this)},_render:function(a){a.save();this._renderTransform(a);this._renderClip(a);for(var c=0;c<this.children.length;++c)this.children[c]._render(a);a.restore()},destroy:function(){m.Container.clear.call(this,!0);r.Shape.prototype.destroy.apply(this,arguments)}});r.Rect=t("dojox.gfx.canvas.Rect",[r.Shape,m.Rect],{_renderShape:function(a){var c=this.shape,
b=Math.min(c.r,c.height/2,c.width/2),h=c.x,d=h+c.width,l=c.y,c=l+c.height,g=h+b,k=d-b,r=l+b,n=c-b;a.beginPath();a.moveTo(g,l);b?(a.arc(k,r,b,-A,0,!1),a.arc(k,n,b,0,A,!1),a.arc(g,n,b,A,F,!1),a.arc(g,r,b,F,F+A,!1)):(a.lineTo(k,l),a.lineTo(d,n),a.lineTo(g,c),a.lineTo(h,r));a.closePath()},_renderDashedStroke:function(c,b){var h=this.shape,d=Math.min(h.r,h.height/2,h.width/2),g=h.x,k=g+h.width,r=h.y,n=r+h.height,e=g+d,f=k-d,B=r+d,m=n-d;d?(c.beginPath(),h=l(c,this,e,r,f,r),b&&c.stroke(),h=a(c,this.canvasDash,
f,B,d,-A,0,!1,b,h),c.beginPath(),h=l(c,this,k,B,k,m,h),b&&c.stroke(),h=a(c,this.canvasDash,f,m,d,0,A,!1,b,h),c.beginPath(),h=l(c,this,f,n,e,n,h),b&&c.stroke(),h=a(c,this.canvasDash,e,m,d,A,F,!1,b,h),c.beginPath(),h=l(c,this,g,m,g,B,h),b&&c.stroke(),a(c,this.canvasDash,e,B,d,F,F+A,!1,b,h)):(c.beginPath(),h=l(c,this,e,r,f,r),h=l(c,this,f,r,k,m,h),h=l(c,this,k,m,e,n,h),l(c,this,e,n,g,B,h),b&&c.stroke())}});var B=[];(function(){var a=d.curvePI4;B.push(a.s,a.c1,a.c2,a.e);for(var c=45;360>c;c+=45){var b=
k.rotateg(c);B.push(w(b,a.c1),w(b,a.c2),w(b,a.e))}})();var I=function(a){var b,h,d,l=[],g=a.shape,r=k.normalize([k.translate(g.cx,g.cy),k.scale(g.rx,g.ry)]);b=w(r,B[0]);l.push([b.x,b.y]);for(g=1;g<B.length;g+=3)h=w(r,B[g]),d=w(r,B[g+1]),b=w(r,B[g+2]),l.push([h.x,h.y,d.x,d.y,b.x,b.y]);if(a._needsDash){b=[];h=l[0];for(g=1;g<l.length;++g)d=[],c(h.concat(l[g]),a.canvasDash,d),h=[l[g][4],l[g][5]],b.push(d);a._dashedPoints=b}return l};r.Ellipse=t("dojox.gfx.canvas.Ellipse",[r.Shape,m.Ellipse],{setShape:function(){this.inherited(arguments);
this.canvasEllipse=I(this);return this},setStroke:function(){this.inherited(arguments);E||(this.canvasEllipse=I(this));return this},_renderShape:function(a){var c=this.canvasEllipse,b;a.beginPath();a.moveTo.apply(a,c[0]);for(b=1;b<c.length;++b)a.bezierCurveTo.apply(a,c[b]);a.closePath()},_renderDashedStroke:function(a,c){var b=this._dashedPoints;a.beginPath();for(var h=0;h<b.length;++h)for(var d=b[h],l=0;l<d.length;++l){var g=d[l];a.moveTo(g[0],g[1]);a.bezierCurveTo(g[2],g[3],g[4],g[5],g[6],g[7])}c&&
a.stroke()}});r.Circle=t("dojox.gfx.canvas.Circle",[r.Shape,m.Circle],{_renderShape:function(a){var c=this.shape;a.beginPath();a.arc(c.cx,c.cy,c.r,0,x,1)},_renderDashedStroke:function(a,c){var b=this.shape,h=0,d,l=this.canvasDash.length;for(i=0;h<x;)d=this.canvasDash[i%l]/b.r,i%2||(a.beginPath(),a.arc(b.cx,b.cy,b.r,h,h+d,0),c&&a.stroke()),h+=d,++i}});r.Line=t("dojox.gfx.canvas.Line",[r.Shape,m.Line],{_renderShape:function(a){var c=this.shape;a.beginPath();a.moveTo(c.x1,c.y1);a.lineTo(c.x2,c.y2)},
_renderDashedStroke:function(a,c){var b=this.shape;a.beginPath();l(a,this,b.x1,b.y1,b.x2,b.y2);c&&a.stroke()}});r.Polyline=t("dojox.gfx.canvas.Polyline",[r.Shape,m.Polyline],{setShape:function(){this.inherited(arguments);var a=this.shape.points,c=a[0],b,h;this.bbox=null;this._normalizePoints();if(a.length)if("number"==typeof c)c=a;else{c=[];for(h=0;h<a.length;++h)b=a[h],c.push(b.x,b.y)}else c=[];this.canvasPolyline=c;return this},_renderShape:function(a){var c=this.canvasPolyline;if(c.length){a.beginPath();
a.moveTo(c[0],c[1]);for(var b=2;b<c.length;b+=2)a.lineTo(c[b],c[b+1])}},_renderDashedStroke:function(a,c){var b=this.canvasPolyline,h=0;a.beginPath();for(var d=0;d<b.length;d+=2)h=l(a,this,b[d],b[d+1],b[d+2],b[d+3],h);c&&a.stroke()}});r.Image=t("dojox.gfx.canvas.Image",[r.Shape,m.Image],{setShape:function(){this.inherited(arguments);var a=new Image;this.surface.downloadImage(a,this.shape.src);this.canvasImage=a;return this},_renderShape:function(a){var c=this.shape;a.drawImage(this.canvasImage,c.x,
c.y,c.width,c.height)}});r.Text=t("dojox.gfx.canvas.Text",[r.Shape,m.Text],{_setFont:function(){this.fontStyle?this.canvasFont=f.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var a=this.shape,c=0,b;a.text&&(b=this.surface.rawNode.getContext("2d"),b.save(),this._renderTransform(b),this._renderFill(b,!1),this._renderStroke(b,!1),this.canvasFont&&(b.font=this.canvasFont),c=b.measureText(a.text).width,b.restore());return c},_render:function(a){a.save();this._renderTransform(a);
this._renderFill(a,!1);this._renderStroke(a,!1);this._renderShape(a);a.restore()},_renderShape:function(a){var c,b=this.shape;b.text&&(c="middle"===b.align?"center":b.align,a.textAlign=c,this.canvasFont&&(a.font=this.canvasFont),this.canvasFill&&a.fillText(b.text,b.x,b.y),this.strokeStyle&&(a.beginPath(),a.strokeText(b.text,b.x,b.y),a.closePath()))}});C(r.Text,"setFont");y||r.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var M={M:"_moveToA",
m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};r.Path=t("dojox.gfx.canvas.Path",[r.Shape,g.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);
E||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(a){var c=q.clone(this.last);this[M[a.action]](this.canvasPath,a.action,a.args,this._needsDash?this._dashedPath:null);this.last=c;this.inherited(arguments)},_renderShape:function(a){var c=this.canvasPath;a.beginPath();for(var b=0;b<c.length;b+=2)a[c[b]].apply(a,c[b+1])},_renderDashedStroke:E?function(){}:function(a,c){var b=this._dashedPath;
a.beginPath();for(var h=0;h<b.length;h+=2)a[b[h]].apply(a,b[h+1]);c&&a.stroke()},_moveToA:function(a,c,b,h){a.push("moveTo",[b[0],b[1]]);h&&h.push("moveTo",[b[0],b[1]]);for(c=2;c<b.length;c+=2)a.push("lineTo",[b[c],b[c+1]]),h&&(this._dashResidue=l(h,this,b[c-2],b[c-1],b[c],b[c+1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl={}},_moveToR:function(a,c,b,h){c="x"in this.last?[this.last.x+=b[0],this.last.y+=b[1]]:[this.last.x=b[0],this.last.y=b[1]];a.push("moveTo",
c);h&&h.push("moveTo",c);for(c=2;c<b.length;c+=2)a.push("lineTo",[this.last.x+=b[c],this.last.y+=b[c+1]]),h&&(this._dashResidue=l(h,this,h[h.length-1][0],h[h.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(a,c,b,h){for(c=0;c<b.length;c+=2)h&&(this._dashResidue=l(h,this,this.last.x,this.last.y,b[c],b[c+1],this._dashResidue)),a.push("lineTo",[b[c],b[c+1]]);this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl={}},_lineToR:function(a,c,b,
h){for(c=0;c<b.length;c+=2)a.push("lineTo",[this.last.x+=b[c],this.last.y+=b[c+1]]),h&&(this._dashResidue=l(h,this,h[h.length-1][0],h[h.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(a,c,b,h){for(c=0;c<b.length;++c)a.push("lineTo",[b[c],this.last.y]),h&&(this._dashResidue=l(h,this,h[h.length-1][0],h[h.length-1][1],b[c],this.last.y,this._dashResidue));this.last.x=b[b.length-1];this.lastControl={}},_hLineToR:function(a,c,b,h){for(c=0;c<b.length;++c)a.push("lineTo",
[this.last.x+=b[c],this.last.y]),h&&(this._dashResidue=l(h,this,h[h.length-1][0],h[h.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(a,c,b,h){for(c=0;c<b.length;++c)a.push("lineTo",[this.last.x,b[c]]),h&&(this._dashResidue=l(h,this,h[h.length-1][0],h[h.length-1][1],this.last.x,b[c],this._dashResidue));this.last.y=b[b.length-1];this.lastControl={}},_vLineToR:function(a,c,b,h){for(c=0;c<b.length;++c)a.push("lineTo",[this.last.x,this.last.y+=b[c]]),h&&
(this._dashResidue=l(h,this,h[h.length-1][0],h[h.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(a,c,b,d){for(c=0;c<b.length;c+=6)a.push("bezierCurveTo",b.slice(c,c+6)),d&&(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl.x=b[b.length-4];this.lastControl.y=b[b.length-3];this.lastControl.type="C"},_curveToR:function(a,c,b,d){for(c=0;c<b.length;c+=6)a.push("bezierCurveTo",
[this.last.x+b[c],this.last.y+b[c+1],this.lastControl.x=this.last.x+b[c+2],this.lastControl.y=this.last.y+b[c+3],this.last.x+b[c+4],this.last.y+b[c+5]]),d&&(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue)),this.last.x+=b[c+4],this.last.y+=b[c+5];this.lastControl.type="C"},_smoothCurveToA:function(a,c,b,d){for(c=0;c<b.length;c+=4){var l="C"==this.lastControl.type;a.push("bezierCurveTo",[l?2*this.last.x-this.lastControl.x:this.last.x,l?2*this.last.y-this.lastControl.y:this.last.y,b[c],b[c+
1],b[c+2],b[c+3]]);d&&(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue));this.lastControl.x=b[c];this.lastControl.y=b[c+1];this.lastControl.type="C"}this.last.x=b[b.length-2];this.last.y=b[b.length-1]},_smoothCurveToR:function(a,c,b,d){for(c=0;c<b.length;c+=4){var l="C"==this.lastControl.type;a.push("bezierCurveTo",[l?2*this.last.x-this.lastControl.x:this.last.x,l?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+b[c],this.last.y+b[c+1],this.last.x+b[c+2],this.last.y+b[c+3]]);d&&
(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue));this.lastControl.x=this.last.x+b[c];this.lastControl.y=this.last.y+b[c+1];this.lastControl.type="C";this.last.x+=b[c+2];this.last.y+=b[c+3]}},_qCurveToA:function(a,c,b,d){for(c=0;c<b.length;c+=4)a.push("quadraticCurveTo",b.slice(c,c+4));d&&(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue));this.last.x=b[b.length-2];this.last.y=b[b.length-1];this.lastControl.x=b[b.length-4];this.lastControl.y=b[b.length-3];this.lastControl.type=
"Q"},_qCurveToR:function(a,c,b,d){for(c=0;c<b.length;c+=4)a.push("quadraticCurveTo",[this.lastControl.x=this.last.x+b[c],this.lastControl.y=this.last.y+b[c+1],this.last.x+b[c+2],this.last.y+b[c+3]]),d&&(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue)),this.last.x+=b[c+2],this.last.y+=b[c+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(a,c,b,d){for(c=0;c<b.length;c+=2){var l="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=l?2*this.last.x-this.lastControl.x:
this.last.x,this.lastControl.y=l?2*this.last.y-this.lastControl.y:this.last.y,b[c],b[c+1]]);d&&(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=b[b.length-2];this.last.y=b[b.length-1]},_qSmoothCurveToR:function(a,c,b,d){for(c=0;c<b.length;c+=2){var l="Q"==this.lastControl.type;a.push("quadraticCurveTo",[this.lastControl.x=l?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=l?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+b[c],
this.last.y+b[c+1]]);d&&(this._dashResidue=h(d,this,a[a.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=b[c];this.last.y+=b[c+1]}},_arcTo:function(a,c,b,l){c="a"==c;for(var g=0;g<b.length;g+=7){var k=b[g+5],r=b[g+6];c&&(k+=this.last.x,r+=this.last.y);var n=d.arcAsBezier(this.last,b[g],b[g+1],b[g+2],b[g+3]?1:0,b[g+4]?1:0,k,r);e.forEach(n,function(c){a.push("bezierCurveTo",c)});l&&(this._dashResidue=h(l,this,p,this._dashResidue));this.last.x=k;this.last.y=r}this.lastControl={}},
_closePath:function(a,c,b,h){a.push("closePath",[]);h&&(this._dashResidue=l(h,this,this.last.x,this.last.y,h[1][0],h[1][1],this._dashResidue));this.lastControl={}}});e.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(a){C(r.Path,a)});r.TextPath=t("dojox.gfx.canvas.TextPath",[r.Shape,g.TextPath],{_renderShape:function(a){},_setText:function(){},_setFont:function(){}});r.Surface=t("dojox.gfx.canvas.Surface",m.Surface,{constructor:function(){m.Container._init.call(this);
this.pendingImageCount=0;this.makeDirty()},destroy:function(){m.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(a,c){this.width=f.normalizedLength(a);this.height=f.normalizedLength(c);if(!this.rawNode)return this;var b=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,b=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,b=!0);b&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:
null},_render:function(a){if(this.rawNode&&(a||!this.pendingImageCount))a=this.rawNode.getContext("2d"),a.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(a),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender)},render:function(a){a.save();for(var c=0;c<this.children.length;++c)this.children[c]._render(a);a.restore()},makeDirty:function(){!this.pendingImagesCount&&(!("pendingRender"in this)&&!this._batch)&&(this.pendingRender=setTimeout(q.hitch(this,
this._render),0))},downloadImage:function(a,c){var b=q.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);a.onload=b;a.onerror=b;a.onabort=b;a.src=c},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});r.createSurface=function(a,c,b){if(!c&&!b){var h=
v.position(a);c=c||h.w;b=b||h.h}"number"==typeof c&&(c+="px");"number"==typeof b&&(b+="px");h=new r.Surface;a=s.byId(a);var d=a.ownerDocument.createElement("canvas");d.width=f.normalizedLength(c);d.height=f.normalizedLength(b);a.appendChild(d);h.rawNode=d;h._parent=a;return h.surface=h};var J=m.Container;t={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},
add:function(a){this._makeDirty();return J.add.apply(this,arguments)},remove:function(a,c){this._makeDirty();return J.remove.apply(this,arguments)},clear:function(){this._makeDirty();return J.clear.apply(this,arguments)},getBoundingBox:J.getBoundingBox,_moveChildToFront:function(a){this._makeDirty();return J._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(a){this._makeDirty();return J._moveChildToBack.apply(this,arguments)}};g={createObject:function(a,c){var b=new a;b.surface=this.surface;
b.setShape(c);this.add(b);return b}};b(r.Group,t);b(r.Group,m.Creator);b(r.Group,g);b(r.Surface,t);b(r.Surface,m.Creator);b(r.Surface,g);r.fixTarget=function(a,c){return!0};return r})},"dojox/main":function(){define(["dojo/_base/kernel"],function(f){return f.dojox})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(f,q,e,t,u,v,s,m,g,
d){f=f(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(d,b,g){this._graphic=d;this._map=b;this._toolbar=g;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(d){this._editBox?(e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=e.connect(d.getLayer(),"onDblClick",this,function(b){this._map.navigationManager.setImmediateClick(!1);
b.graphic==d&&(t.stop(b),e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(d))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(e.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(d,b){if(!this._editBox){var n;d.symbol.text||(d.symbol.text="Tempt text",d.setSymbol(d.symbol),n="");var a=this._createInputTextStyle(d,
this._map);""!==n&&(n=b||d.symbol.text);this._editBox=v.create("input",{type:"text",value:n});m.set(this._editBox,a);s.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=e.connect(this._editBox,"onkeyup",q.hitch(this,function(a){(a.keyCode==g.ENTER||a.keyCode===g.TAB)&&this._disable()}));this._editBoxBlurHandler=e.connect(this._editBox,"onblur",q.hitch(this,function(a){this._disable()}));d.symbol.text="";d.setSymbol(d.symbol);
d.hide();var c=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",q.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){m.set(c,{left:this._editBoxLeft+a.delta.x+"px",top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(m.get(c,"left"));this._editBoxTop=parseFloat(m.get(c,"top"))});this.onEditStart(d,this._editBox);this._toolbar.onTextEditStart(d,
this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(e.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&
(e.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(d,b){var g=d.getDojoShape().getTransformedBoundingBox(),a=Math.abs(g[0].x-g[1].x)/Math.cos(d.symbol.angle/180*Math.PI),c=d.symbol.font;return{"font-family":c.family,"font-size":c.size+"px","font-style":c.style,"font-variant":c.variant,"font-weight":c.weight,left:g[0].x+"px",top:g[0].y+"px",width:a+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var d=this._graphic.symbol;
d.text=this._editBox.value;this._graphic.setSymbol(d)}else this._graphic.getLayer().remove(this._graphic)}});u("extend-esri")&&q.setObject("toolbars.TextEditor",f,d);return f})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(e){q.mixin(this,e)}});e("extend-esri")&&q.setObject("tasks.ParameterValue",f,t);return f})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(f,q,e,t,u,v,s,m,g,d,k,b,n,a,c,h,l,r,z,w,F,x,A){f=f(b,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=q.hitch(this,this._jobUpdateHandler);this._getJobStatus=q.hitch(this,this._getJobStatus);this._getResultDataHandler=
q.hitch(this,this._getResultDataHandler);this._getResultImageHandler=q.hitch(this,this._getResultImageHandler);this._executeHandler=q.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,c,b){for(var h in a){var d=a[h];q.isArray(d)?a[h]=u.toJson(e.map(d,function(a){return this._gpEncode({item:a},!0).item},this)):d instanceof Date&&(a[h]=d.getTime())}return this._encode(a,c,b)},_decode:function(a){var c=a.dataType,
b=new w(a);if(-1!==e.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],c))return b;if("GPLinearUnit"===c)b.value=new h(b.value);else if("GPFeatureRecordSetLayer"===c||"GPRecordSet"===c)b.value=new n(b.value);else if("GPDataFile"===c)b.value=new l(b.value);else if("GPDate"===c)a=b.value,q.isString(a)?b.value=new z({date:a}):b.value=new Date(a);else if("GPRasterData"===c||"GPRasterDataLayer"===c)a=a.value.mapImage,b.value=a?new A(a):new r(b.value);else if(-1!==c.indexOf("GPMultiValue:")){var d=c.split(":")[1];
a=b.value;b.value=e.map(a,function(a){return this._decode({paramName:"_name",dataType:d,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+b.dataType),b=null;return b},submitJob:function(a,c,b,h,d){var l=this._getOutSR(),r=d.assembly;a=this._gpEncode(q.mixin({},this._url.query,{f:"json","env:outSR":l?l.wkid||u.toJson(l.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||u.toJson(this.processSpatialReference.toJson()):
null},a),null,r&&r[0]);var k=this._jobUpdateHandler,e=this._errorHandler;return g({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,h){k(a,h,!1,c,b,d.dfd)},error:function(a){e(a,h,d.dfd)}})},_jobUpdateHandler:function(c,b,h,d,l,g){var r=c.jobId;b=new a(c);this._successHandler([b],"onStatusUpdate",l,h&&g);if(!h)switch(clearTimeout(this._updateTimers[r]),this._updateTimers[r]=null,g&&g.progress(b),c.jobStatus){case a.STATUS_SUBMITTED:case a.STATUS_EXECUTING:case a.STATUS_WAITING:case a.STATUS_NEW:var k=
this._getJobStatus;this._updateTimers[r]=setTimeout(function(){k(r,h,d,l,g)},this.updateDelay);break;default:this._successHandler([b],"onJobComplete",d,g)}},_getJobStatus:function(a,c,b,h,d){var l=this._jobUpdateHandler;g({url:this._url.path+"/jobs/"+a,content:q.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,g){l(a,g,c,b,h,d)},error:this._errorHandler})},_getResultDataHandler:function(a,c,b,h,d){try{var l=this._decode(a);this._successHandler([l],"onGetResultDataComplete",
b,d)}catch(g){this._errorHandler(g,h,d)}},getResultData:function(a,c,b,h){var l=this._getResultDataHandler,r=this._errorHandler,k=new t(d._dfdCanceller);k._pendingDfd=g({url:this._url.path+"/jobs/"+a+"/results/"+c,content:q.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,c){l(a,c,b,h,k)},error:function(a){r(a,h,k)}});return k},checkJobStatus:function(a,c,b){var h=this._jobUpdateHandler,l=this._errorHandler,r=new t(d._dfdCanceller);r._pendingDfd=
g({url:this._url.path+"/jobs/"+a,content:q.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,b){h(a,b,!0,null,c,r)},error:function(a){l(a,b,r)}});return r},cancelJob:function(a,c,b){var h=this._errorHandler,l=new t(d._dfdCanceller);l._pendingDfd=g({url:this._url.path+"/jobs/"+a+"/cancel",content:q.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:q.hitch(this,function(a,b){this._successHandler([a],"onJobCancel",c,l)}),error:function(a){h(a,b,l)}});
return l},execute:function(a,c,b,h){var d=this._getOutSR(),l=h.assembly;a=this._gpEncode(q.mixin({},this._url.query,{f:"json","env:outSR":d?d.wkid||u.toJson(d.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||u.toJson(this.processSpatialReference.toJson()):null},a),null,l&&l[0]);var r=this._executeHandler,k=this._errorHandler;return g({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,d){r(a,d,c,b,h.dfd)},error:function(a){k(a,
b,h.dfd)}})},_executeHandler:function(a,b,h,d,l){try{var g=a.results,r,k,e=a.messages;r=0;for(k=g.length;r<k;r++)g[r]=this._decode(g[r]);r=0;for(k=e.length;r<k;r++)e[r]=new c(e[r]);this._successHandler([g,e],"onExecuteComplete",h,l)}catch(n){this._errorHandler(n,d,l)}},_getResultImageHandler:function(a,c,b,h,d){try{var l=this._decode(a);this._successHandler([l],"onGetResultImageComplete",b,d)}catch(g){this._errorHandler(g,h,d)}},getResultImage:function(a,c,b,h,l){var r=this._getResultImageHandler,
k=this._errorHandler;b=this._gpEncode(q.mixin({},this._url.query,{f:"json"},b.toJson()));var e=new t(d._dfdCanceller);e._pendingDfd=g({url:this._url.path+"/jobs/"+a+"/results/"+c,content:b,callbackParamName:"callback",load:function(a,c){r(a,c,h,l,e)},error:function(a){k(a,l,e)}});return e},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,c,b,h){if(null==c){var d=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
d)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+c;this._url.query&&(a+="?"+s.objectToQuery(this._url.query));c=null==c?new x(a,{imageParameters:b}):new F(a,{imageParameters:b},!0);this.onGetResultImageLayerComplete(c);h&&h(c);return c},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});k._createWrappers(f);
v("extend-esri")&&q.setObject("tasks.Geoprocessor",f,m);return f})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b){var n=f(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,c,b){this.graphic=a;this.map=c;this.toolbar=b;a=b._options;
this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;c=a.ghostLineSymbol;this._lineStroke={style:c.style,width:c.width,color:c.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),this._addControllers()):(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=
!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=e.connect(g,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=e.connect(g,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var a=this._getGraphicsLayer();this._mouseOverHandle=
e.connect(a,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=e.connect(a,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new v({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),a=this._ctxDelete=new s({label:b.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=e.connect(a,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(a),this._ctxMenu.startup())},_removeControllers:function(){e.disconnect(this._firstMoveHandle);
e.disconnect(this._moveStopHandle);e.disconnect(this._mouseOverHandle);e.disconnect(this._mouseOutHandle);e.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=null},_add:function(a,c,b){var d,r,k=this.graphic,e=[];for(d=0;d<a.length;d++){var n=a[d],f=[];for(r=0;r<n.length;r++)f.push(new g(n[r],c,k,d,r,n.length,this,b));
e.push(f)}return e},_remove:function(a){a&&t.forEach(a,function(a){t.forEach(a,function(a){a.destroy()})})},_refresh:function(a){a&&t.forEach(a,function(a){t.forEach(a,function(a){a.refresh()})})},_isNew:function(a){return-1===t.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&
this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var c=this._findMover(a);c&&(this.toolbar.onVertexMouseOver(this.graphic,c._getInfo()),c._placeholder||(this._selectedMover=c,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",
this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var c,b=[];c=this._mpVertexMovers;t.forEach(this._vertexMovers,function(a){b=b.concat(a)});c&&t.forEach(c,function(a){b=b.concat(a)});for(c=0;c<b.length;c++){var d=b[c];if(d.graphic===a)return d}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},
_moveStopHandler:function(a,c){var b=this._isNew(a);!c||!c.dx&&!c.dy?!b&&this._canAdd&&this._showRelatedMidpoints(a):(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,b),this._canAdd&&(b?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES"))},_showRelatedMidpoints:function(a){var c=this._getAdjacentMidpoints(a.ptIndex,a.segLength),b=this._mpVertexMovers[a.segIndex];for(a=0;a<
c.length;a++){var d=b[c[a]];d.graphic.show();d.refresh()}},_hideRelatedMidpoints:function(a){var c=this._getAdjacentMidpoints(a.ptIndex,a.segLength),b=this._mpVertexMovers[a.segIndex];for(a=0;a<c.length;a++)b[c[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var c,b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),l=this._mpVertexMovers[a.segIndex];for(c=0;c<b.length;c++){var g=this._getAdjacentVertices(b[c],a.segLength),k=a.relatedGraphic.geometry.getPoint(a.segIndex,g[0]),g=a.relatedGraphic.geometry.getPoint(a.segIndex,
g[1]),k=new d({x:(k.x+g.x)/2,y:(k.y+g.y)/2,spatialReference:k.spatialReference.toJson()});l[b[c]].graphic.setGeometry(k)}},_addMidpoints:function(a){var c=a.segIndex,b=a.ptIndex,l=a.segLength,k=b+1,e,n=l+1;this._mpVertexMovers[c].splice(b,1);var f=this._vertexMovers[c];for(e=0;e<k;e++)f[e].segLength+=1;for(e=k;e<f.length;e++)f[e].ptIndex+=1,f[e].segLength+=1;a.ptIndex=k;a.segLength=f.length+1;f.splice(k,0,a);a.graphic.setSymbol(this._symbol1);f=this._mpVertexMovers[c];for(e=0;e<b;e++)f[e].segLength+=
1;for(e=b;e<l-1;e++)f[e].ptIndex+=1,f[e].segLength+=1;k=this._getAdjacentVertices(b,n);c=this._getAdjacentVertices(b+1,n);l=a.relatedGraphic.geometry.getPoint(a.segIndex,k[0]);e=a.relatedGraphic.geometry.getPoint(a.segIndex,k[1]);k=new d({x:(l.x+e.x)/2,y:(l.y+e.y)/2,spatialReference:l.spatialReference.toJson()});l=a.relatedGraphic.geometry.getPoint(a.segIndex,c[0]);e=a.relatedGraphic.geometry.getPoint(a.segIndex,c[1]);c=new d({x:(l.x+e.x)/2,y:(l.y+e.y)/2,spatialReference:l.spatialReference.toJson()});
l=new g(k,this._symbol2,this.graphic,a.segIndex,b,n,this,!0);a=new g(c,this._symbol2,this.graphic,a.segIndex,b+1,n,this,!0);f.splice(b,0,l,a)},_deleteVertex:function(a){var c,b=a.ptIndex,d=this._vertexMovers[a.segIndex];for(c=0;c<b;c++)d[c].segLength-=1;for(c=b+1;c<d.length;c++){var g=d[c];g.ptIndex-=1;g.segLength-=1}d.splice(b,1);c=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,c)}});q.mixin(n,{create:function(a,c,b){switch(a.geometry.type){case "multipoint":return new n.MultipointVertexEditor(a,
c,b);case "polyline":return new n.PolylineVertexEditor(a,c,b);case "polygon":return new n.PolygonVertexEditor(a,c,b)}}});n.MultipointVertexEditor=f(n,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=e.connect(g,"onMoveStart",this,this._moveStartHandler);e.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);e.disconnect(this._moveStartHandle)},_getSegments:function(a){var c=a.points,b=[],l=a.spatialReference;
for(a=0;a<c.length;a++){var g=c[a];b.push(new d({x:g[0],y:g[1],spatialReference:l.toJson()}))}return[b]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,c,b,d,g){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var c=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(c,a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var c=
a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(c,a._getInfo())},_findMover:function(a){var c=[].concat(this._vertexMovers[0]),b=a.target;for(a=0;a<c.length;a++){var d=c[a];if(d.graphic.getDojoShape().getNode()===b)return d}},_moveStartHandler:function(a){var c=a.ptIndex,b=a.segLength-1,d=a.relatedGraphic.geometry.points;a=d.splice(c,1);d.push(a[0]);d=this._vertexMovers[0];for(a=b;a>c;a--)d[a].ptIndex-=1;a=d.splice(c,1);d.push(a[0]);a[0].ptIndex=b},_moveStopHandler:function(a){this._updateRelatedGraphic(a,
a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,c,b,d,g,k,e,n){a=c.geometry;n?a.removePoint(g):a.setPoint(g,b);c.setGeometry(a)},_deleteMidpoints:function(a){}});n.PolylineVertexEditor=f(n,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,_getSegments:function(a){var c,b,d=a.paths,g=[];for(c=0;c<d.length;c++){var k=d[c],e=[];for(b=0;b<k.length;b++)e.push(a.getPoint(c,b));g.push(e)}return g},
_getMidpointSegments:function(a){var c,b,g=a.paths,k=[],e=a.spatialReference;for(c=0;c<g.length;c++){var n=g[c],f=[];for(b=0;b<n.length-1;b++){var m=a.getPoint(c,b),s=a.getPoint(c,b+1),m=new d({x:(m.x+s.x)/2,y:(m.y+s.y)/2,spatialReference:e.toJson()});f.push(m)}k.push(f)}return k},_getControlPoints:function(a,c,b,d,g){var k=this.map,e,n;this._isNew(a)?(a=d,d+=1,0<=a&&(e=k.toScreen(c.getPoint(b,a))),d<=g&&(n=k.toScreen(c.getPoint(b,d)))):(a=d-1,d+=1,0<=a&&(e=k.toScreen(c.getPoint(b,a))),d<g&&(n=k.toScreen(c.getPoint(b,
d))));return[e,n]},_getAdjacentMidpoints:function(a,c){var b=[],d=a-1;0<=d&&b.push(d);a<c-1&&b.push(a);return b},_getAdjacentVertices:function(a,c){return[a,a+1]},_deleteMidpoints:function(a){var c=this._mpVertexMovers[a.segIndex],b=c.length-1,l=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),k,e=l[0];for(k=0;k<e;k++)c[k].segLength-=1;for(k=e+1;k<c.length;k++){var n=c[k];n.ptIndex-=1;n.segLength-=1}if(1===l.length)c.splice(e,1)[0].destroy();else{n=this._getAdjacentVertices(e,b);k=a.relatedGraphic.geometry.getPoint(a.segIndex,
n[0]);n=a.relatedGraphic.geometry.getPoint(a.segIndex,n[1]);k=new d({x:(k.x+n.x)/2,y:(k.y+n.y)/2,spatialReference:k.spatialReference.toJson()});a=new g(k,this._symbol2,this.graphic,a.segIndex,e,b,this,!0);c=c.splice(e,l.length,a);for(k=0;k<c.length;k++)c[k].destroy()}},_updateRelatedGraphic:function(a,c,b,d,g,e,n,f){a=c.geometry;n?a.insertPoint(d,g+1,k.fromJson(b.toJson())):f?a.removePoint(d,g):a.setPoint(d,g,k.fromJson(b.toJson()));c.setGeometry(a)}});n.PolygonVertexEditor=f(n,{declaredClass:"esri.toolbars._PolygonVertexEditor",
minLength:3,_getSegments:function(a){var c,b,d=a.rings,g=[];for(c=0;c<d.length;c++){var k=d[c],e=[];for(b=0;b<k.length-1;b++)e.push(a.getPoint(c,b));g.push(e)}return g},_getMidpointSegments:function(a){var c,b,g=a.rings,k=[],e=a.spatialReference;for(c=0;c<g.length;c++){var n=g[c],f=[];for(b=0;b<n.length-1;b++){var m=a.getPoint(c,b),s=a.getPoint(c,b+1),m=new d({x:(m.x+s.x)/2,y:(m.y+s.y)/2,spatialReference:e.toJson()});f.push(m)}k.push(f)}return k},_getControlPoints:function(a,c,b,d,g){var k=this.map;
this._isNew(a)?a=d:(a=d-1,a=0>a?(g+a)%g:a);d=(d+1)%g;g=k.toScreen(c.getPoint(b,a));c=k.toScreen(c.getPoint(b,d));return[g,c]},_getAdjacentMidpoints:function(a,c){var b=a-1;return[0>b?(c+b)%c:b,a]},_getAdjacentVertices:function(a,b){return[a,(a+1)%b]},_deleteMidpoints:function(a){var b=a.ptIndex,h=this._mpVertexMovers[a.segIndex],k=h.length-1,e=this._getAdjacentMidpoints(b,a.segLength).sort(),n,f;f=e[0];var m=e[e.length-1];if(0===b){n=this._getAdjacentVertices(k-1,k);b=a.relatedGraphic.geometry.getPoint(a.segIndex,
n[0]);n=a.relatedGraphic.geometry.getPoint(a.segIndex,n[1]);b=new d({x:(b.x+n.x)/2,y:(b.y+n.y)/2,spatialReference:b.spatialReference.toJson()});a=new g(b,this._symbol2,this.graphic,a.segIndex,k-1,k,this,!0);h.splice(m,1,a)[0].destroy();h.splice(f,1)[0].destroy();for(e=0;e<h.length-1;e++)f=h[e],f.ptIndex-=1,f.segLength-=1}else{n=this._getAdjacentVertices(f,k);b=a.relatedGraphic.geometry.getPoint(a.segIndex,n[0]);n=a.relatedGraphic.geometry.getPoint(a.segIndex,n[1]);b=new d({x:(b.x+n.x)/2,y:(b.y+n.y)/
2,spatialReference:b.spatialReference.toJson()});a=new g(b,this._symbol2,this.graphic,a.segIndex,f,k,this,!0);m=h.splice(f,e.length,a);for(e=0;e<m.length;e++)m[e].destroy();for(e=0;e<f;e++)h[e].segLength-=1;for(e=f+1;e<h.length;e++)f=h[e],f.ptIndex-=1,f.segLength-=1}},_updateRelatedGraphic:function(a,b,d,g,e,n,f,m){a=b.geometry;f?a.insertPoint(g,e+1,k.fromJson(d.toJson())):m?(a.removePoint(g,e),0===e&&a.setPoint(g,n-1,k.fromJson(a.getPoint(g,0).toJson()))):(a.setPoint(g,e,k.fromJson(d.toJson())),
0===e&&a.setPoint(g,n,k.fromJson(d.toJson())));b.setGeometry(a)}});u("extend-esri")&&(q.setObject("toolbars._GraphicVertexEditor",n,m),q.setObject("toolbars._MultipointVertexEditor",n.MultipointVertexEditor,m),q.setObject("toolbars._PolylineVertexEditor",n.PolylineVertexEditor,m),q.setObject("toolbars._PolygonVertexEditor",n.PolygonVertexEditor,m));return n})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.LinearUnit",
constructor:function(e){e&&q.mixin(this,e)},distance:0,units:null,toJson:function(){var e={};this.distance&&(e.distance=this.distance);this.units&&(e.units=this.units);return e}});e("extend-esri")&&q.setObject("tasks.LinearUnit",f,t);return f})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage".split(" "),function(f,q,e,t,u,v,s,m,g,d,k){f=f(g,{declaredClass:"esri.tasks.RouteTask",
_eventMap:{"solve-complete":["result"]},constructor:function(b){this._url.path+="/solve";this._handler=q.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(b,g,a,c,h){try{var l=[],f=[],m=b.routes?b.routes.features:[],s=b.stops?b.stops.features:[],t=b.barriers?b.barriers.features:[],q=b.polygonBarriers?b.polygonBarriers.features:[],u=b.polylineBarriers?
b.polylineBarriers.features:[],E=b.messages,y=e.forEach,H=e.indexOf,G=!0,D,C,B=b.routes&&b.routes.spatialReference||b.stops&&b.stops.spatialReference||b.barriers&&b.barriers.spatialReference||b.polygonBarriers&&b.polygonBarriers.spatialReference||b.polylineBarriers&&b.polylineBarriers.spatialReference;y(b.directions||[],function(a){l.push(D=a.routeName);f[D]={directions:a}});y(m,function(a){if(-1===H(l,D=a.attributes.Name))l.push(D),f[D]={};f[D].route=a});y(s,function(a){C=a.attributes;if(-1===H(l,
D=C.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME"))l.push(D),f[D]={};"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==D&&(G=!1);void 0===f[D].stops&&(f[D].stops=[]);f[D].stops.push(a)});0<s.length&&!0===G&&(f[l[0]].stops=f["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete f["esri.tasks.RouteTask.NULL_ROUTE_NAME"],l.splice(e.indexOf(l,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var I=[];y(l,function(a,b){f[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;f[a].spatialReference=B;I.push(new d(f[a]))});
b=function(a){y(a,function(b,c){b.geometry&&(b.geometry.spatialReference=B);a[c]=new v(b)});return a};y(E,function(a,b){E[b]=new k(a)});var M={routeResults:I,barriers:b(t),polygonBarriers:b(q),polylineBarriers:b(u),messages:E};this._successHandler([M],"onSolveComplete",a,h)}catch(J){this._errorHandler(J,c,h)}},solve:function(b,d,a,c){var h=b.stops;if(h&&"esri.tasks.FeatureSet"===h.declaredClass){var g=[],k=!1,f;e.forEach(h.features,function(a){f=a.attributes;if((!f||!f.RouteName)&&!k)k=!0;else if(-1===
e.indexOf(g,f?f.RouteName:""))g.push(f?f.RouteName:"")});if(1<g.length&&k)throw k=Error("'RouteName' not specified for at least 1 stop in stops FeatureSet."),this.onError(k),a&&a(k),k;}h=c.assembly;b=this._encode(q.mixin({},this._url.query,{f:"json"},b.toJson(h&&h[0])));var m=this._handler,v=this._errorHandler;return s({url:this._url.path,content:b,callbackParamName:"callback",load:function(b,h){m(b,h,d,a,c.dfd)},error:function(b){v(b,a,c.dfd)}})},onSolveComplete:function(){}});m._createWrappers(f);
t("extend-esri")&&q.setObject("tasks.RouteTask",f,u);return f})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(f,q,e,t,u,v,s,m){return q("dijit._KeyNavMixin",m,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);e.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var g=this._keyNavCodes={};g[t.HOME]=u.hitch(this,"focusFirstChild");
g[t.END]=u.hitch(this,"focusLastChild");g[this.isLeftToRight()?t.LEFT_ARROW:t.RIGHT_ARROW]=u.hitch(this,"_onLeftArrow");g[this.isLeftToRight()?t.RIGHT_ARROW:t.LEFT_ARROW]=u.hitch(this,"_onRightArrow");g[t.UP_ARROW]=u.hitch(this,"_onUpArrow");g[t.DOWN_ARROW]=u.hitch(this,"_onDownArrow")}var d=this,g="string"==typeof this.childSelector?this.childSelector:u.hitch(this,"childSelector");this.own(v(this.domNode,"keypress",u.hitch(this,"_onContainerKeypress")),v(this.domNode,"keydown",u.hitch(this,"_onContainerKeydown")),
v(this.domNode,"focus",u.hitch(this,"_onContainerFocus")),v(this.containerNode,v.selector(g,"focusin"),function(g){d._onChildFocus(s.getEnclosingWidget(this),g)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(g,d){g&&(this.focusedChild&&g!==this.focusedChild&&this._onChildBlur(this.focusedChild),g.set("tabIndex",this.tabIndex),g.focus(d?"end":"start"))},_onContainerFocus:function(g){g.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){e.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(g){e.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(g){g&&g!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),g.set("tabIndex",this.tabIndex),this.lastFocused=g,this._set("focusedChild",g))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(g,d,k,b){g&&this.focusChild(g)},_keyboardSearchCompare:function(g,d){var k=g.domNode,k=(g.label||(k.focusNode?
k.focusNode.label:"")||k.innerText||k.textContent||"").replace(/^\s+/,"").substr(0,d.length).toLowerCase();return d.length&&k==d?-1:0},_isFormElement:function(g){return"INPUT"===g.tagName||"TEXTAREA"===g.tagName||"SELECT"===g.tagName||"BUTTON"===g.tagName},_onContainerKeydown:function(g){if(!this._isFormElement(document.activeElement)){var d=this._keyNavCodes[g.keyCode];d?(d(g,this.focusedChild),g.stopPropagation(),g.preventDefault(),this._searchString=""):g.keyCode==t.SPACE&&(this._searchTimer&&
!g.ctrlKey&&!g.altKey&&!g.metaKey)&&(g.stopImmediatePropagation(),g.preventDefault(),this._keyboardSearch(g," "))}},_onContainerKeypress:function(g){if(!this._isFormElement(document.activeElement)&&!(g.charCode<=t.SPACE||g.ctrlKey||g.altKey||g.metaKey))g.preventDefault(),g.stopPropagation(),this._keyboardSearch(g,String.fromCharCode(g.charCode).toLowerCase())},_keyboardSearch:function(g,d){var k=null,b,e=0;u.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=d;
var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;b=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var c=this.focusedChild||null;if(1==a||!c)if(c=this._getNextFocusableChild(c,1),!c)return;a=c;do{var h=this._keyboardSearchCompare(c,b);h&&0==e++&&(k=c);if(-1==h){e=-1;break}c=this._getNextFocusableChild(c,1)}while(c!=a)})();this.onKeyboardSearch(k,g,b,e)},_onChildBlur:function(){},
_getNextFocusableChild:function(g,d){var k=g;do{if(g)g=this._getNext(g,d);else if(g=this[0<d?"_getFirst":"_getLast"](),!g)break;if(null!=g&&g!=k&&g.isFocusable())return g}while(g!=k);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(g,d){if(g)for(g=g.domNode;g;)if((g=g[0>d?"previousSibling":"nextSibling"])&&"getAttribute"in g){var k=s.byNode(g);if(k)return k}return null}})})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dijit/a11yclick dijit/_TemplatedMixin dijit/focus ../kernel ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(f,q,e,t,u,v,s,m,g,d,k,b,n,a,c,h,l,r,z,w,F,x,A,E,y,H,G,D,C){q=q("esri.dijit.Geocoder",[A,l],{templateString:a,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(a,b){this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",
GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",
clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",
activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new x(f.toUrl(".")+"/images/sdk_gps_location.png",28,28),graphicsLayer:null};var c=e.mixin({},this.options,a);this.set("autoComplete",c.autoComplete);this.set("arcgisGeocoder",c.arcgisGeocoder);this.set("value",c.value);this.set("theme",c.theme);this.set("activeGeocoderIndex",c.activeGeocoderIndex);
this.set("maxLocations",c.maxLocations);this.set("minCharacters",c.minCharacters);this.set("searchDelay",c.searchDelay);this.set("geocoderMenu",c.geocoderMenu);this.set("autoNavigate",c.autoNavigate);this.set("showResults",c.showResults);this.set("map",c.map);this.set("activeGeocoder",c.activeGeocoder);this.set("geocoders",c.geocoders);this.set("zoomScale",c.zoomScale);this.set("highlightLocation",c.highlightLocation);this.set("symbol",c.symbol);this.set("graphicsLayer",c.graphicsLayer);this.set("results",
[]);this._i18n=n;this._deferreds=[];this._defaultSR=new w(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);this.domNode=b},startup:function(){if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();
else k.once(this.get("map"),"load",e.hitch(this,function(){this._init()}));else this._init();else console.log("Geocoder:: domNode is undefined."),this.destroy();else console.log("Geocoder:: No geocoders defined."),this.destroy()},postCreate:function(){this.inherited(arguments);this.own(k(this.submitNode,h,e.hitch(this,this._findThenSelect)));this.own(k(this.geocoderMenuArrowNode,h,e.hitch(this,this._toggleGeolocatorMenu)));this.own(k(this.inputNode,h,e.hitch(this,this._inputClick)));this.own(k(this.clearNode,
h,e.hitch(this,this.clear)));this.own(k(this.geocoderMenuCloseNode,h,e.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();g.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var a=this.get("highlightGraphic"),b=this.get("graphicsLayer");a&&(b?b.remove(a):this.get("map").graphics.remove(a),this.set("highlightGraphic",null));v.set(this.inputNode,
"value","");this.set("value","");this.set("results",[]);s.remove(this.containerNode,this._css.hasValueClass);v.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){m.set(this.domNode,"display","block")},hide:function(){m.set(this.domNode,"display","none")},find:function(a){var b=new t;if(a)if("string"===typeof a)this._findQuery(a).then(function(a){b.resolve(a)});else if("object"===typeof a&&a.hasOwnProperty("geometry")){var c;switch(a.geometry.type){case "extent":c=
a.geometry.getCenter();break;case "multipoint":c=a.geometry.getExtent().getCenter();break;case "point":c=a.geometry;break;case "polygon":c=a.geometry.getExtent().getCenter();break;case "polyline":c=a.geometry.getExtent().getCenter()}c&&this._reverseGeocodePoint(c,a.geometry).then(function(c){c.results[0]&&(a.hasOwnProperty("attributes")&&c.results[0].feature.setAttributes(e.mixin(c.results[0].feature.attributes,a.attributes)),a.hasOwnProperty("infoTemplate")&&c.results[0].feature.setInfoTemplate(a.infoTemplate),
a.hasOwnProperty("symbol")&&c.results[0].feature.setSymbol(a.symbol));b.resolve(c)},function(a){b.reject(a)})}else"object"===typeof a&&"point"===a.type?this._reverseGeocodePoint(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}):a instanceof Array&&2===a.length?(c=new E(a,new w({wkid:4326})),this._reverseGeocodePoint(c).then(function(a){b.resolve(a)},function(a){b.reject(a)})):b.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(a){b.resolve(a)});
return b.promise},focus:function(){r.focus(this.inputNode)},blur:function(){r.curNode&&r.curNode.blur();this.inputNode.blur();this._hideMenus();var a=this.get("map");a&&a.enableKeyboardNavigation()},select:function(a){this.onSelect(a);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&(a&&a.hasOwnProperty("extent")&&this.get("map"))&&this.get("map").setExtent(a.extent);if(a.feature){var b=this.get("highlightGraphic"),c=this.get("graphicsLayer"),d=this.get("symbol")||a.feature.symbol;
b?(b.setGeometry(a.feature.geometry),b.setAttributes(a.feature.attributes),b.setInfoTemplate(a.feature.infoTemplate),b.setSymbol(d)):(b=a.feature,this.get("highlightLocation")&&(b.setSymbol(d),c?c.add(b):this.get("map").graphics.add(b)));this.set("highlightGraphic",b)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_autoComplete:function(){var a=this.get("activeGeocoder"),
b=this.reHostedFS.test(a.url);("query"!==a.type||b)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(e.hitch(this,function(a){this.onAutoComplete(a);this.get("showResults")&&this._showResults(a)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1},_findQuery:function(a){var b=new t;this._query({delay:0,search:a}).then(e.hitch(this,function(a){this.onFindResults(a);
b.resolve(a)}),e.hitch(this,function(a){this.onFindResults(a);b.reject(a)}));return b.promise},_reverseGeocodePoint:function(a,b){var c=new t;if(a&&this.get("activeGeocoder")){var d=b||a,h=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);this._task.locationToAddress(a,h,e.hitch(this,function(a){a={results:[this._hydrateResult(a)],geometry:d};this.onFindResults(a);c.resolve(a)}),
e.hitch(this,function(a){c.reject(a)}))}else c.reject("Geocoder:: no point or active geocoder defined");return c.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||
(this._arcgisGeocoder.url=("file:"===location.protocol?"http:":location.protocol)+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=n.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",
this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new D(this.get("activeGeocoder").url):new H(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var a=[];this.get("arcgisGeocoder")&&(a=a.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(a=a.concat(this.get("geocoders")));this._geocoders=a},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();
this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);v.set(this.inputNode,"placeholder",this._placeholder);v.set(this.submitNode,"title",this._placeholder)},_updateValue:function(a,b,c){this._ignoreUpdateValue||(v.set(this.inputNode,"value",c),this._checkStatus())},_updateTheme:function(a,b,c){s.remove(this.domNode,
b);s.add(this.domNode,c)},_setActiveGeocoderIndex:function(a,b,c){this.set("activeGeocoderIndex",c);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();a={attr:this.get("activeGeocoder"),oldVal:b,newVal:c};this.onGeocoderSelect(a)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(a){a||(a={delay:0});a.search||(a.search=this.get("value"));var b=new t;this._deferreds.push(b);a.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(e.hitch(this,
function(){this._performTask(b,a)}),a.delay)):this._performTask(b,a);return b.promise},_performTask:function(a,b){if(b.search){this._hideGeolocatorMenu();this._showLoading();var c="";this.get("activeGeocoder").prefix&&(c+=this.get("activeGeocoder").prefix);c+=b.search;this.get("activeGeocoder").suffix&&(c+=this.get("activeGeocoder").suffix);var d=this.get("activeGeocoder").outFields;d&&(d instanceof Array||(d=[d]));var h=this.get("maxLocations")||6,g=this.get("activeGeocoder").searchExtent,k=this._defaultSR;
this.get("map")&&(k=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var l=new G;l.outSpatialReference=k;l.returnGeometry=!0;l.num=h;g&&(l.geometry=g);h=this.get("activeGeocoder").exactMatch;g=this.get("activeGeocoder").field;k="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(c)&&(k="N");l.where=h?g+" \x3d "+k+"'"+c+"'":"UPPER("+g+") LIKE "+k+"'%"+c.toUpperCase()+"%'";d&&(l.outFields=d);this._task.execute(l,e.hitch(this,function(c){this._receivedResults(c.features,
a,b)}),e.hitch(this,function(c){this._receivedResults([],a,b)}))}else{l={};this.get("activeGeocoder").categories&&(l.categories=this.get("activeGeocoder").categories);this._task.outSpatialReference=k;if(this.get("map")&&(this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale"))&&(k=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||
k&&k<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale)))l.location=this.get("map").extent.getCenter(),l.distance=this.get("activeGeocoder").localSearchOptions.distance;this.get("activeGeocoder").suggest&&b.autoComplete?(l.text=c,g&&(l.searchExtent=g),this._task.suggestLocations(l).then(e.hitch(this,function(c){this._receivedResults(c,a,b)}),e.hitch(this,function(c){this._receivedResults(c,a,b)}))):(l.address={},l.maxLocations=h,g&&(l.searchExtent=g),this.get("activeGeocoder").sourceCountry&&
(l.countryCode=this.get("activeGeocoder").sourceCountry),b.magicKey&&(l.magicKey=b.magicKey),this.get("activeGeocoder").singleLineFieldName?l.address[this.get("activeGeocoder").singleLineFieldName]=c:l.address["Single Line Input"]=c,d&&(l.outFields=d),this._task.addressToLocations(l,e.hitch(this,function(c){this._receivedResults(c,a,b)}),e.hitch(this,function(c){this._receivedResults(c,a,b)})))}}else this._hideLoading(),a.reject("Geocoder:: no search to perform");(c=this.get("map"))&&c.enableKeyboardNavigation()},
_showResults:function(){this._hideGeolocatorMenu();var a="";if(this.get("results")&&this.get("results").length&&this.resultsNode){for(var b=this.get("value"),c=RegExp("("+b+")","gi"),a=a+'\x3cul role\x3d"presentation"\x3e',b=0;b<this.get("results").length&&5>b;++b){var d=this.get("results")[b].text||this.get("results")[b].name,h=this._css.resultsItemClass+" ",h=0===b%2?h+this._css.resultsItemOddClass:h+this._css.resultsItemEvenClass;0===b?h+=" "+this._css.resultsItemFirstClass:b===this.get("results").length-
1&&(h+=" "+this._css.resultsItemLastClass);a+='\x3cli title\x3d"'+d+'" data-text\x3d"'+d+'" data-item\x3d"true" data-index\x3d"'+b+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+h+'"\x3e'+d.replace(c,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}a+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=a);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=a),this._hideResultsMenu()},_receivedResults:function(a,
b){this._hideLoading();var c=this._hydrateResults(a);this.set("results",c);c={results:c,value:this.get("value")};b.resolve(c)},_showLoading:function(){s.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){s.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){s.add(this.containerNode,this._css.activeMenuClass);s.add(this.domNode,this._css.GeocoderMenuOpenClass);m.set(this.geocoderMenuNode,"display","block");v.set(this.geocoderMenuInsertNode,"aria-hidden",
"false");v.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){s.remove(this.containerNode,this._css.activeMenuClass);s.remove(this.domNode,this._css.GeocoderMenuOpenClass);m.set(this.geocoderMenuNode,"display","none");v.set(this.geocoderMenuInsertNode,"aria-hidden","true");v.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===m.get(this.geocoderMenuNode,"display")?this._hideGeolocatorMenu():
this._showGeolocatorMenu()},_showResultsMenu:function(){s.add(this.containerNode,this._css.GeocoderActiveClass);s.add(this.domNode,this._css.GeocoderResultsOpenClass);m.set(this.resultsNode,"display","block");v.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){m.set(this.resultsNode,"display","none");s.remove(this.containerNode,this._css.GeocoderActiveClass);s.remove(this.domNode,this._css.GeocoderResultsOpenClass);v.set(this.resultsNode,"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();
this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var a,b="",c;a='\x3cul role\x3d"presentation"\x3e';for(c=0;c<this._geocoders.length;c++){b=this._css.resultsItemClass+" ";b=0===c%2?b+this._css.resultsItemOddClass:b+this._css.resultsItemEvenClass;c===this.get("activeGeocoderIndex")&&(b+=" "+this._css.geocoderSelectedClass);0===c?b+=" "+this._css.resultsItemFirstClass:c===this._geocoders.length-1&&(b+=" "+this._css.resultsItemLastClass);
var d=this._geocoders[c].name||n.widgets.Geocoder.main.untitledGeocoder;a+='\x3cli data-index\x3d"'+c+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+b+'"\x3e';a+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';a+=d;a+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';a+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=a+"\x3c/ul\x3e";this._geocoderMenuEvent();m.set(this.geocoderMenuNode,"display","none");m.set(this.geocoderMenuArrowNode,
"display","block");s.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",m.set(this.geocoderMenuNode,"display","none"),m.set(this.geocoderMenuArrowNode,"display","none"),s.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(s.add(this.containerNode,this._css.hasValueClass),v.set(this.clearNode,"title",n.widgets.Geocoder.main.clearButtonTitle)):this.clear()},_autoCompleteEvent:function(){var a=b('[data-item\x3d"true"]',
this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=k(a,"click, keydown",e.hitch(this,function(b){this._clearQueryTimeout();var c=parseInt(v.get(b.currentTarget,"data-index"),10),h=v.get(b.currentTarget,"data-text");"click"===b.type||"keydown"===b.type&&b.keyCode===d.ENTER?(v.set(this.inputNode,"value",h),this.set("value",h),this.get("results")&&this.get("results")[c]&&(b=this.get("results")[c],b.name?this.select(b):this._query({delay:0,search:b.text,magicKey:b.magicKey||null}).then(e.hitch(this,
function(a){this.select(a.results[0])})))):"keydown"===b.type&&(b.keyCode===d.BACKSPACE||b.keyCode===d.DELETE)?(u.stop(b),this.inputNode.focus(),b=this.inputNode.value.slice(0,-1),v.set(this.inputNode,"value",b),this.set("value",b)):"keydown"===b.type&&b.keyCode===d.UP_ARROW?(u.stop(b),b=c-1,0>b?this.inputNode.focus():a[b].focus()):"keydown"===b.type&&b.keyCode===d.DOWN_ARROW?(u.stop(b),b=c+1,b>=a.length?this.inputNode.focus():a[b].focus()):b.keyCode===d.ESCAPE&&this._hideMenus()}))},_geocoderMenuEvent:function(){var a=
b('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=k(a,"click, keydown",e.hitch(this,function(b){var c=parseInt(v.get(b.currentTarget,"data-index"),10);"click"===b.type||"keydown"===b.type&&b.keyCode===d.ENTER?(this._setActiveGeocoderIndex(null,null,c),this._hideGeolocatorMenu()):"keydown"===b.type&&b.keyCode===d.UP_ARROW?(u.stop(b),b=c-1,0>b?this.geocoderMenuArrowNode.focus():a[b].focus()):"keydown"===b.type&&b.keyCode===d.DOWN_ARROW?(u.stop(b),
b=c+1,b>=a.length?this.geocoderMenuArrowNode.focus():a[b].focus()):b.keyCode===d.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var a;if(this._events&&this._events.length)for(a=0;a<this._events.length;a++)this._events[a].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();var a=k(document,"click",e.hitch(this,function(a){this._hideResultsMenu(a)}));this._events.push(a);a=k(this.inputNode,
"keyup",e.hitch(this,function(a){this._inputKeyUp(a)}));this._events.push(a);a=k(this.inputNode,"keydown",e.hitch(this,function(a){this._inputKeyDown(a)}));this._events.push(a);a=k(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(a);this.get("map")&&(a=k(this.get("map"),"mouse-down",e.hitch(this,function(){this.blur()})),this._events.push(a));this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(e.hitch(this,function(a){a.results&&
a.results.length&&(this.select(a.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(a){if(a){this._clearQueryTimeout();var b=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",b);this._ignoreUpdateValue=!1;var c=0;b&&(c=b.length);if(a.ctrlKey||a.metaKey||a.altKey||a.keyCode===d.copyKey||a.keyCode===d.ALT||a.keyCode===d.CTRL||a.keyCode===d.META||a.keyCode===d.SHIFT||a.keyCode===d.UP_ARROW||a.keyCode===d.DOWN_ARROW||a.keyCode===d.LEFT_ARROW||a.keyCode===d.RIGHT_ARROW)return a;
a&&a.keyCode===d.ENTER?(this._cancelDeferreds(),this._findThenSelect()):a&&a.keyCode===d.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===d.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&c>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var a=0;a<this._deferreds.length;a++)this._deferreds[a].cancel("Geocoder:: stop query");this._deferreds=[]}},_inputKeyDown:function(a){var c=
b('[data-item\x3d"true"]',this.resultsNode);a&&a.keyCode===d.TAB?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===d.UP_ARROW?(u.stop(a),(a=c.length)&&c[a-1].focus()):a&&a.keyCode===d.DOWN_ARROW&&(u.stop(a),c[0]&&c[0].focus())},_geocoderMenuButtonKeyDown:function(a){var c=b('[data-item\x3d"true"]',this.geocoderMenuInsertNode);a&&a.keyCode===d.UP_ARROW?(u.stop(a),this._showGeolocatorMenu(),(a=c.length)&&c[a-1].focus()):a&&a.keyCode===d.DOWN_ARROW&&(u.stop(a),this._showGeolocatorMenu(),c[0]&&
c[0].focus())},_inputClick:function(){this._hideGeolocatorMenu();var a=this.get("map");a&&a.disableKeyboardNavigation()},_hydrateResult:function(a){var b={},c=this._defaultSR,d;this.get("map")&&(c=this.get("map").spatialReference);if(a.hasOwnProperty("text")&&a.hasOwnProperty("magicKey"))return a;if(a.hasOwnProperty("feature"))b.feature=new F(a.feature),(d=b.feature.geometry)&&d.setSpatialReference(c);else if(a.hasOwnProperty("geometry")){var h=a.symbol||null;d=a.attributes||{};b.feature=new F(a.geometry,
h,d,a.infoTemplate||null);(d=b.feature.geometry)&&d.setSpatialReference(c)}else a.hasOwnProperty("location")?(h=new E(a.location.x,a.location.y,c),d={},a.hasOwnProperty("attributes")&&(d=a.attributes),a.hasOwnProperty("score")&&(d.score=a.score),b.feature=new F(h,null,d,null)):b.feature=null;if(a.hasOwnProperty("extent"))b.extent=new y(a.extent),b.extent.setSpatialReference(new w(c));else if(b.feature&&b.feature.geometry)switch(b.feature.geometry.type){case "extent":b.extent=b.feature.geometry;break;
case "multipoint":b.extent=b.feature.geometry.getExtent();break;case "polygon":b.extent=b.feature.geometry.getExtent();break;case "polyline":b.extent=b.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?b.extent=C.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(b.feature.geometry):b.extent=this.get("map").extent.centerAt(b.feature.geometry):b.extent=new y({xmin:b.feature.geometry.x-0.25,ymin:b.feature.geometry.y-0.25,
xmax:b.feature.geometry.x+0.25,ymax:b.feature.geometry.y+0.25,spatialReference:{wkid:4326}})}else b.extent=null;a.hasOwnProperty("name")?b.name=a.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&a.hasOwnProperty("attributes")&&a.attributes.hasOwnProperty(this.activeGeocoder.field)?b.name=a.attributes[this.activeGeocoder.field]:a.hasOwnProperty("Match_addr")&&"string"===typeof a.Match_addr?b.name=a.Match_addr:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Match_addr")?
b.name=a.address.Match_addr:a.hasOwnProperty("address")&&"string"===typeof a.address?b.name=a.address:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Address")?b.name=a.address.Address:b.name=b.feature&&b.feature.geometry?b.feature.geometry.x+","+b.feature.geometry.y:"";return b},_hydrateResults:function(a){var b=[],c=0;if(a&&a.length)for(c;c<a.length;c++){var d=this._hydrateResult(a[c]);b.push(d)}return b}});c("extend-esri")&&e.setObject("dijit.Geocoder",q,z);
return q})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(f,q,e,t,u){f=f(null,{declaredClass:"esri.tasks.Date",constructor:function(f){f&&(f.format&&(this.format=f.format),this.date=e.parse(f.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:e.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});t("extend-esri")&&
q.setObject("tasks.Date",f,u);return f})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b){var n=q("dojo.dnd.Selector",b,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(g(this.node,d.press,t.hitch(this,
"onMouseDown")),g(this.node,d.release,t.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new m,b=k._empty,d;for(d in this.selection)d in b||a.push(u.byId(d));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(u.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=k._empty,b;for(b in this.selection)if(!(b in a)){var d=
u.byId(b);this.delItem(b);v.destroy(d)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||e.global;var d=this.selection,g=k._empty,n;for(n in d)n in g||a.call(b,this.getItem(n),n,this)},sync:function(){n.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=k._empty,d;for(d in this.selection)d in b||this.getItem(d)||a.push(d);f.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,
b,d,g){var k=this._normalizedCreator;this._normalizedCreator=function(b,c){var d=k.call(this,b,c);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,"Selected"),this._removeItemClass(d.node,"Anchor"));return d};n.superclass.insertNodes.call(this,b,d,g);this._normalizedCreator=
k;return this},destroy:function(){n.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!k.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,s.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){k.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,g;d<b.length&&!(g=b[d],g==this.anchor||g==this.current);++d);for(++d;d<b.length;++d){g=b[d];if(g==this.anchor||g==this.current)break;this._addItemClass(g,"Selected");this.selection[g.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?k.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):k.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=g(this.node,d.move,t.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=k._empty,b;for(b in this.selection)if(!(b in a)){var d=u.byId(b);d&&this._removeItemClass(d,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return n})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],
function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(e){q.mixin(this,e)}});q.mixin(f,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});e("extend-esri")&&
q.setObject("tasks.GPMessage",f,t);return f})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(f,q,e,t,u){f=f([u],{declaredClass:"esri.toolbars._Toolbar",constructor:function(e){this.map=e},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(e,
f,m,g){var d=this.map;e&&(this._mapNavState={isDoubleClickZoom:d.isDoubleClickZoom,isClickRecenter:d.isClickRecenter,isPan:d.isPan,isRubberBandZoom:d.isRubberBandZoom,isKeyboardNavigation:d.isKeyboardNavigation,isScrollWheelZoom:d.isScrollWheelZoom},d.disableDoubleClickZoom(),d.disableClickRecenter(),d.disablePan(),d.disableRubberBandZoom(),d.disableKeyboardNavigation());f&&d.hideZoomSlider();m&&d.hidePanArrows();g&&d.graphics.disableMouseEvents()},_activateMapTools:function(e,f,m,g){var d=this.map,
k=this._mapNavState;e&&k&&(k.isDoubleClickZoom&&d.enableDoubleClickZoom(),k.isClickRecenter&&d.enableClickRecenter(),k.isPan&&d.enablePan(),k.isRubberBandZoom&&d.enableRubberBandZoom(),k.isKeyboardNavigation&&d.enableKeyboardNavigation(),k.isScrollWheelZoom&&d.enableScrollWheelZoom());f&&d.showZoomSlider();m&&d.showPanArrows();g&&d.graphics.enableMouseEvents()}});e("extend-esri")&&q.setObject("toolbars._Toolbar",f,t);return f})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),
function(f,q,e,t,u,v,s,m,g,d,k,b,n){var a=f(null,{declaredClass:"esri.toolbars._GraphicMover",constructor:function(a,b,d,g){this.graphic=a;this.map=b;this.toolbar=d;this.tempPt=g;this._enableGraphicMover();this._moved=!1},refresh:function(a){var b=this.graphic.getDojoShape();if(b&&(a||!b._hostGraphic))this._disableGraphicMover(),this._enableGraphicMover()},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var b=this.graphic,d=b.getDojoShape();
d&&(d._hostGraphic=b,this._moveable=new s(d,{mover:a.Mover}),this._moveStartHandle=e.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=e.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=e.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=e.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(b=d.getEventSource())&&v.set(b,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var a=
this._moveable;if(a){e.disconnect(this._moveStartHandle);e.disconnect(this._firstMoveHandle);e.disconnect(this._movingHandle);e.disconnect(this._moveStopHandle);var b=a.shape;b&&(b._hostGraphic=null,(b=b.getEventSource())&&v.set(b,"cursor",null));a.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,b=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&b.snappingManager&&b.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},
_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},_movingHandler:function(a){a=a.shape.getTransform();this.tempPt&&this.tempPt.getDojoShape().setTransform(a);this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(a){var d=this.graphic,e=this.toolbar,f=this.map,m=e._geo?k.geographicToWebMercator(d.geometry):d.geometry,s=m.type,v=d.getDojoShape(),q=v.getTransform();if(t.toJson(q)!==t.toJson(this._startTx)){this._moved=!0;
switch(s){case "point":var s=[q,g.invert(this._startTx)],u;f.snappingManager&&(u=f.snappingManager._snappingPoint);m=u||f.toMap(g.multiplyPoint(s,f.toScreen(m,!0)));f.snappingManager&&f.snappingManager._killOffSnapping();break;case "polyline":m=this._updatePolyGeometry(m,m.paths,q);break;case "polygon":m=this._updatePolyGeometry(m,m.rings,q)}v.setTransform(null);d.setGeometry(e._geo?k.webMercatorToGeographic(m,!0):m);this.tempPt&&this.tempPt.setGeometry(new n(d.geometry.toJson()))}else this._moved=
!1;e._endOperation("MOVE");e.onGraphicMoveStop(d,q);this._moved||(a=a.__e,f=this.map.position,a=new b(a.pageX-f.x,a.pageY-f.y),e.onGraphicClick(d,{screenPoint:a,mapPoint:this.map.toMap(a)}))},_updatePolyGeometry:function(a,b,d){var g=this.map,k=a.getPoint(0,0),g=g.toMap(g.toScreen(k).offset(d.dx,d.dy));d=g.x-k.x;for(var k=g.y-k.y,e,n,f,g=0;g<b.length;g++){n=b[g];for(e=0;e<n.length;e++)f=a.getPoint(g,e),a.setPoint(g,e,f.offset(d,k))}return a}});a.Mover=f(m,{declaredClass:"esri.toolbars._Mover",constructor:function(a,
b,d){this.__e=b}});u("extend-esri")&&(q.setObject("toolbars._GraphicMover",a,d),q.setObject("toolbars._Mover",a.Mover,d));return a})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.DataFile",constructor:function(e){e&&q.mixin(this,e)},url:null,itemID:null,toJson:function(){var e={};this.url&&(e.url=this.url);this.itemID&&(e.itemID=this.itemID);return e}});e("extend-esri")&&q.setObject("tasks.DataFile",
f,t);return f})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(f,q,e,t,u,v,s,m,g,d){return q("dijit._KeyNavContainer",[g,d,m],{connectKeyNavHandlers:function(d,b){var g=this._keyNavCodes={},a=v.hitch(this,"focusPrev"),c=v.hitch(this,"focusNext");f.forEach(d,function(b){g[b]=a});f.forEach(b,function(a){g[a]=c});g[u.HOME]=v.hitch(this,
"focusFirstChild");g[u.END]=v.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){t.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);f.forEach(this.getChildren(),v.hitch(this,"_startupChild"))},addChild:function(d,b){this.inherited(arguments);this._startupChild(d)},_startupChild:function(d){d.set("tabIndex","-1")},_getFirst:function(){var d=this.getChildren();return d.length?d[0]:null},_getLast:function(){var d=this.getChildren();
return d.length?d[d.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(d){return(d=s.byNode(d))&&d.getParent()==this}})})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(f,q,e,t,u,v,s,m,g,d,k,b,n,a,c,h,l,r,z,w,F){var x=q(n,{declaredClass:"esri.toolbars.Edit",constructor:function(a,b){this._map=a;this._tool=0;if(this._map.loaded)this._scratchGL=a.graphics;else var c=t.connect(this._map,"onLoad",this,function(){t.disconnect(c);c=null;this._scratchGL=this._map.graphics});var d=s("esri-touch")||s("esri-pointer");this._defaultOptions=e.mixin({vertexSymbol:new r(r.STYLE_CIRCLE,d?20:12,new z(z.STYLE_SOLID,new v([0,0,0,0.5]),1),new v([128,128,128])),ghostVertexSymbol:new r(r.STYLE_CIRCLE,
d?18:10,new z(z.STYLE_SOLID,new v([0,0,0,0.5]),1),new v([255,255,255,0.75])),ghostLineSymbol:new z(z.STYLE_DOT,new v([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:d?24:16,boxLineSymbol:new z(z.STYLE_DASH,new v([64,64,64]),1),boxHandleSymbol:new r(r.STYLE_SQUARE,d?16:9,new z(z.STYLE_SOLID,new v([0,0,0,0.5]),1),new v([255,255,255,0.75])),textAnchorSymbol:new r(r.STYLE_CIRCLE,10,null,new v([255,0,0]))},b||{})},activate:function(a,b,c){this.deactivate();this._graphic=
b;this._options=e.mixin(e.mixin({},this._defaultOptions),c||{});var d=x.MOVE;c=x.EDIT_VERTICES;var h=x.SCALE,g=x.ROTATE,k=x.EDIT_TEXT,l=!1,n=!1,f=!1,m=this._map,r=m.spatialReference,s=b.geometry.spatialReference;this._geo=!(!r||!s||r.equals(s)||!(r.isWebMercator()&&4326===s.wkid));this._isTextPoint=this._prepareTextSymbolEditing(b,a);(a&d)===d&&(l=this._enableMove(b));d=(a&h)===h;g=(a&g)===g;if(d||g)f=this._enableBoxEditing(b,d,g);(a&c)===c&&(n=this._enableVertexEditing(b));(a&k)===k&&this._enableTextEditing(b);
if(!l&&!n&&!f)throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=a)this._mapPanEndHandle=t.connect(m,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=t.connect(m,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,b);m.snappingManager&&(l||n)&&m.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var a=this._tool,b=this._graphic;
if(a){var c=!!this._modified;this._clear();t.disconnect(this._mapPanEndHandle);t.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(a,b,{isModified:c});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(a,b){},onDeactivate:function(a,
b,c){},onGraphicMoveStart:function(a){},onGraphicFirstMove:function(a){this._modified=!0},onGraphicMove:function(a,b){},onGraphicMoveStop:function(a,b){},onGraphicClick:function(a,b){},onVertexMoveStart:function(a,b){},onVertexFirstMove:function(a,b){this._modified=!0},onVertexMove:function(a,b,c){},onVertexMoveStop:function(a,b,c){},onVertexAdd:function(a,b){this._modified=!0},onVertexClick:function(a,b){},onVertexMouseOver:function(a,b){},onVertexMouseOut:function(a,b){},onVertexDelete:function(a,
b){this._modified=!0},onTextEditStart:function(a,b){},onTextEditEnd:function(a){},onScaleStart:function(a){},onScaleFirstMove:function(a){this._modified=!0},onScale:function(a,b){},onScaleStop:function(a,b){},onRotateStart:function(a){},onRotateFirstMove:function(a){this._modified=!0},onRotate:function(a,b){},onRotateStop:function(a,b){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(a,b){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var c=a.getLayer(),d=c.renderer,c=a.symbol||c._getSymbol(a);!c&&(d.hasVisualVariables()&&d.addBreak&&d.infos&&1===d.infos.length)&&(c=d.infos[0].symbol||d.defaultSymbol);if(c&&"textsymbol"===c.type){if((b&
x.SCALE)===x.SCALE||(b&x.ROTATE)===x.ROTATE||(b&x.EDIT_TEXT)===x.EDIT_TEXT){a.setSymbol(new w(c.toJson()));var h=this;if(this._textSymbolEditor)this._textSymbolEditor.createForm(a),this._textSymbolEditor.show();else if(this._options&&this._options.textSymbolEditor)this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){h._boxEditor&&h._boxEditor.refresh()});else{var e;e=this._options.textSymbolEditorHolder?m.create("div",null,this._options.textSymbolEditorHolder):
m.create("div",null,this._map.root);f(["../dijit/SymbolEditor"],function(b){h._textSymbolEditor=new b({graphic:a},e);b=h._textSymbolEditor.domNode.parentNode.id;g.set(h._textSymbolEditor.domNode,{position:"map_root"===b?"absolute":"relative",left:"map_root"===b?h._map.width/2-100+"px":"5px",top:"20px","z-index":50});h._textSymbolEditor.startup();h._textSymbolEditor.createForm(a);h._textSymbolEditor.show();h._textSymbolEditor.on("symbol-change",function(){h._boxEditor&&h._boxEditor.refresh()})})}}if((b&
x.MOVE)===x.MOVE||(b&x.ROTATE)===x.ROTATE||(b&x.SCALE)===x.SCALE)this._textAnchor=new F(a.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(a){var b=this._map;switch(a.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new c(a,b,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(a){var b=this._map;switch(a.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=
h.create(a,b,this),!0}return!1},_enableBoxEditing:function(b,c,d){var h=this._map,g=b.geometry.type;return"polyline"===g||"polygon"===g||this._isTextPoint?(this._boxEditor=new a(b,h,this,c,d,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(a){return this._isTextPoint?(this._textEditor=new l(a,this._map,this),t.connect(this._textEditor,"onEditStart",e.hitch(this,function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);
this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var a=this._graphicMover;a&&(a.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var a=this._vertexEditor;a&&(a.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var a=this._boxEditor;a&&(a.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&(this._textEditor.destroy(),this._textEditor=null)},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},
_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},_mapExtentChangeHandler:function(a,b,c){c&&this._refreshMoveables()},_refreshMoveables:function(a){var b=u.filter([this._graphicMover,this._vertexEditor,this._boxEditor],
k.isDefined);u.forEach(b,function(b){b.refresh(a)})},_beginOperation:function(a){u.forEach(this._getAffectedTools(a),function(a){a.suspend()})},_endOperation:function(a){u.forEach(this._getAffectedTools(a),function(a){a.resume()})},_getAffectedTools:function(a){var b=[];switch(a){case "MOVE":b=[this._vertexEditor,this._boxEditor];break;case "VERTICES":b=[this._boxEditor];break;case "BOX":b=[this._vertexEditor]}return b=u.filter(b,k.isDefined)}});e.mixin(x,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,
EDIT_TEXT:16});s("extend-esri")&&e.setObject("toolbars.Edit",x,d);return x})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(f,q,e,t,u,v){return e("dojox.gfx.Mover",null,{constructor:function(e,m,g){this.shape=e;this.lastX=m.clientX;this.lastY=m.clientY;e=this.host=g;m=document;g=t(m,u.move,f.hitch(this,"onFirstMove"));this.events=[t(m,u.move,f.hitch(this,"onMouseMove")),t(m,u.release,f.hitch(this,"destroy")),
t(m,"dragstart",f.hitch(v,"stop")),t(m,"selectstart",f.hitch(v,"stop")),g];if(e&&e.onMoveStart)e.onMoveStart(this)},onMouseMove:function(e){var f=e.clientX,g=e.clientY;this.host.onMove(this,{dx:f-this.lastX,dy:g-this.lastY});this.lastX=f;this.lastY=g;v.stop(e)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){q.forEach(this.events,function(e){e.remove()});var e=this.host;if(e&&e.onMoveStop)e.onMoveStop(this);this.events=this.shape=null}})})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Extent ../geometry/Polyline ./FeatureSet".split(" "),
function(f,q,e,t,u,v,s,m){f=f(m,{declaredClass:"esri.tasks.DirectionsFeatureSet",constructor:function(g,d){this.routeId=g.routeId;this.routeName=g.routeName;q.mixin(this,g.summary);this.extent=new v(this.envelope);var k=this._fromCompressedGeometry,b=this.features,n=this.extent.spatialReference,a=[];e.forEach(d,function(c,d){b[d].setGeometry(a[d]=k(c,n))});this.strings=g.strings;this.mergedGeometry=this._mergePolylinesToSinglePath(a,n);this.geometryType="esriGeometryPolyline";delete this.envelope},
_fromCompressedGeometry:function(g,d){var e=0,b=0,n=[],a,c,h,l;h=g.match(/((\+|\-)[^\+\-]+)/g);l=parseInt(h[0],32);for(var f=1;f<h.length;f+=2)e=a=parseInt(h[f],32)+e,b=c=parseInt(h[f+1],32)+b,n.push([a/l,c/l]);e=new s({paths:[n]});e.setSpatialReference(d);return e},_mergePolylinesToSinglePath:function(g,d){var k=[];e.forEach(g,function(a){e.forEach(a.paths,function(a){k=k.concat(a)})});var b=[],n=[0,0];e.forEach(k,function(a){if(a[0]!==n[0]||a[1]!==n[1])b.push(a),n=a});return(new s({paths:[b]})).setSpatialReference(d)}});
t("extend-esri")&&q.setObject("tasks.DirectionsFeatureSet",f,u);return f})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(f,q,e,t,u){u=e("dojox.gfx.path.Path",u.Shape,{constructor:function(e){this.shape=q.clone(f.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=e;this.segmented=!1},setAbsoluteMode:function(e){this._confirmSegmented();this.absolute="string"==typeof e?"absolute"==e:e;return this},
getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var e=this.bbox,f=this._getRealMatrix();this.bbox=null;for(var m=0,g=this.segments.length;m<g;++m)this._updateWithSegment(this.segments[m],f);f=this.bbox;this.bbox=
e;return this.tbbox=f?[{x:f.l,y:f.t},{x:f.r,y:f.t},{x:f.r,y:f.b},{x:f.l,y:f.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(e,f,m){m&&(f=t.multiplyPoint(m,e,f),e=f.x,f=f.y);this.bbox&&"l"in this.bbox?(this.bbox.l>e&&(this.bbox.l=e),this.bbox.r<e&&(this.bbox.r=e),this.bbox.t>f&&(this.bbox.t=f),this.bbox.b<f&&(this.bbox.b=f)):this.bbox={l:e,b:f,r:e,t:f}},
_updateWithSegment:function(e,s){var m=e.args,g=m.length,d;switch(e.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(d=0;d<g;d+=2)this._updateBBox(m[d],m[d+1],s);this.last.x=m[g-2];this.last.y=m[g-1];this.absolute=!0;break;case "H":for(d=0;d<g;++d)this._updateBBox(m[d],this.last.y,s);this.last.x=m[g-1];this.absolute=!0;break;case "V":for(d=0;d<g;++d)this._updateBBox(this.last.x,m[d],s);this.last.y=m[g-1];this.absolute=!0;break;case "m":d=0;"x"in this.last||(this._updateBBox(this.last.x=
m[0],this.last.y=m[1],s),d=2);for(;d<g;d+=2)this._updateBBox(this.last.x+=m[d],this.last.y+=m[d+1],s);this.absolute=!1;break;case "l":case "t":for(d=0;d<g;d+=2)this._updateBBox(this.last.x+=m[d],this.last.y+=m[d+1],s);this.absolute=!1;break;case "h":for(d=0;d<g;++d)this._updateBBox(this.last.x+=m[d],this.last.y,s);this.absolute=!1;break;case "v":for(d=0;d<g;++d)this._updateBBox(this.last.x,this.last.y+=m[d],s);this.absolute=!1;break;case "c":for(d=0;d<g;d+=6)this._updateBBox(this.last.x+m[d],this.last.y+
m[d+1],s),this._updateBBox(this.last.x+m[d+2],this.last.y+m[d+3],s),this._updateBBox(this.last.x+=m[d+4],this.last.y+=m[d+5],s);this.absolute=!1;break;case "s":case "q":for(d=0;d<g;d+=4)this._updateBBox(this.last.x+m[d],this.last.y+m[d+1],s),this._updateBBox(this.last.x+=m[d+2],this.last.y+=m[d+3],s);this.absolute=!1;break;case "A":for(d=0;d<g;d+=7)this._updateBBox(m[d+5],m[d+6],s);this.last.x=m[g-2];this.last.y=m[g-1];this.absolute=!0;break;case "a":for(d=0;d<g;d+=7)this._updateBBox(this.last.x+=
m[d+5],this.last.y+=m[d+6],s);this.absolute=!1}var k=[e.action];for(d=0;d<g;++d)k.push(f.formatNumber(m[d],!0));if("string"==typeof this.shape.path)this.shape.path+=k.join("");else{d=0;for(g=k.length;d<g;++d)this.shape.path.push(k[d])}},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(e,f){this.tbbox=null;var m=this._validSegments[e.toLowerCase()];"number"==typeof m&&(m?f.length>=m&&(m={action:e,args:f.slice(0,f.length-f.length%m)},this.segments.push(m),this._updateWithSegment(m)):
(m={action:e,args:[]},this.segments.push(m),this._updateWithSegment(m)))},_collectArgs:function(e,f){for(var m=0;m<f.length;++m){var g=f[m];"boolean"==typeof g?e.push(g?1:0):"number"==typeof g?e.push(g):g instanceof Array?this._collectArgs(e,g):"x"in g&&"y"in g&&e.push(g.x,g.y)}},moveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"M":"m",e);return this},lineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);
this._pushSegment(this.absolute?"L":"l",e);return this},hLineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"H":"h",e);return this},vLineTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"V":"v",e);return this},curveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"C":"c",e);return this},smoothCurveTo:function(){this._confirmSegmented();
var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"S":"s",e);return this},qCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"Q":"q",e);return this},qSmoothCurveTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"T":"t",e);return this},arcTo:function(){this._confirmSegmented();var e=[];this._collectArgs(e,arguments);this._pushSegment(this.absolute?"A":
"a",e);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var e=this.shape.path;this.shape.path=[];this._setPath(e);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(e){e=q.isArray(e)?e:e.match(f.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(e){for(var s="",m=[],g=e.length,d=0;d<g;++d){var k=e[d],b=parseFloat(k);isNaN(b)?(s&&this._pushSegment(s,
m),m=[],s=k):m.push(b)}this._pushSegment(s,m)}},setShape:function(e){this.inherited(arguments,["string"==typeof e?{path:e}:e]);this.segmented=!1;this.segments=[];f.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});e=e("dojox.gfx.path.TextPath",u,{constructor:function(e){"text"in this||(this.text=q.clone(f.defaultTextPath));"fontStyle"in this||(this.fontStyle=q.clone(f.defaultFont))},getText:function(){return this.text},setText:function(e){this.text=f.makeParameters(this.text,
"string"==typeof e?{text:e}:e);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(e){this.fontStyle="string"==typeof e?f.splitFontString(e):f.makeParameters(f.defaultFont,e);this._setFont();return this}});return f.path={Path:u,TextPath:e}})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],function(f,q,e){q.getObject("json",!0,e);e.json._slice=function(e,f,q,s){var m=e.length,g=[];q=q||m;f=0>f?Math.max(0,f+
m):Math.min(m,f);for(q=0>q?Math.max(0,q+m):Math.min(m,q);f<q;f+=s)g.push(e[f]);return g};e.json._find=function(e,f){function q(e){f&&(!0===f&&!(e instanceof Array)?s.push(e):e[f]&&s.push(e[f]));for(var d in e){var k=e[d];f?k&&"object"==typeof k&&q(k):s.push(k)}}var s=[];if(f instanceof Array){if(1==f.length)return e[f[0]];for(var m=0;m<f.length;m++)s.push(e[f[m]])}else q(e);return s};e.json._distinctFilter=function(e,f){for(var q=[],s={},m=0,g=e.length;m<g;++m){var d=e[m];f(d,m,e)&&("object"==typeof d&&
d?d.__included||(d.__included=!0,q.push(d)):s[d+typeof d]||(s[d+typeof d]=!0,q.push(d)))}m=0;for(g=q.length;m<g;++m)q[m]&&delete q[m].__included;return q};return e.json.query=function(e,f){function q(b){d=b+"("+d}function s(b,a,c,d,e,k,f,m){return g[m].match(/[\*\?]/)||"~"==f?"/^"+g[m].substring(1,g[m].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+("~"==f?"$/i":"$/")+".test("+a+")":b}var m=0,g=[];e=e.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,
function(b){m+="["==b?1:"]"==b?-1:0;return"]"==b&&0<m?"`]":'"'==b.charAt(0)||"'"==b.charAt(0)?"`"+(g.push(b)-1):b});var d="";e.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});e=e.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(b){return"."==b.charAt(0)?b:"@"==b?"$obj":(b.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+b}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(b,a,c){return(a=
b.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(c="",b.match(/^\./)&&(q("dojox.json._find"),c=",true)"),q(a[1].match(/\=/)?"dojo.map":a[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter"),c+",function($obj){return "+a[2]+"})"):(a=b.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+a[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(a,b,c){return"var av\x3d "+c.replace(/\$obj/,"a")+",bv\x3d "+c.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==b?1:-1)+
";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==b?-1:1)+";}\n"})+"return 0;})":(a=b.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(q("dojox.json._slice"),","+(a[1]||0)+","+(a[2]||0)+","+(a[3]||1)+")"):b.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(q("dojox.json._find"),("."==b.charAt(1)?",'"+c+"'":b.match(/,/)?","+b:"")+")"):b}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,s).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(b,
a,c,d,e,g,k,f){return s(b,d,e,g,k,f,c,a)});e=d+("$"==e.charAt(0)?"":"$")+e.replace(/`([0-9]+|\])/g,function(b,a){return"]"==a?"]":g[a]});for(var k=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+e+"}"),b=0;b<arguments.length-1;b++)arguments[b]=arguments[b+1];return f?k.apply(this,arguments):k}})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(e){q.mixin(this,
e)}});q.mixin(f,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});e("extend-esri")&&q.setObject("tasks.NAMessage",f,t);return f})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/has dojo/sniff dojo/dom-style dojox/gfx/Moveable ../kernel ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(f,q,e,t,u,v,s,m,g,d,k){f=
f(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(b,d,a,c,h,e,g,k){this.point=b;this.symbol=d;this.relatedGraphic=a;this.segIndex=c;this.ptIndex=h;this.segLength=e;this.editor=g;this.map=g.map;this._scratchGL=g.toolbar._scratchGL;this._placeholder=k||!1;this._type=a.geometry.type;this._init();this._enable()},refresh:function(b){if(b||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=
this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var b=new g(this.point.toJson()),b=new d(b,this.symbol);switch(this._type){case "multipoint":b._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(b)}this.graphic=b},_enable:function(){var b=this.graphic.getDojoShape();b&&(b._hasMover=!0,this._moveable=this._getMoveable(b),(b=b.getEventSource())&&
v.set(b,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var b=this._moveable;if(b){e.disconnect(this._startHandle);e.disconnect(this._firstHandle);e.disconnect(this._movingHandle);e.disconnect(this._stopHandle);var d=b.shape;d&&(d=d.getEventSource())&&v.set(d,"cursor",null);b.destroy();this._moveable=null}},_needRefresh:function(){var b=this.graphic.getDojoShape(),d=!1;if(b)switch(this._type){case "multipoint":var a=this.relatedGraphic.getDojoShape();
a&&(a=a.children[this.ptIndex],b!==a&&(this.graphic._shape=a,d=!0));break;case "polyline":case "polygon":d=!b._hasMover}return d},_getMoveable:function(b){b=new s(b,u("mac")&&u("ff")&&!t("esri-touch")&&{leftButtonOnly:!0});this._startHandle=e.connect(b,"onMoveStart",this,this._moveStartHandler);this._firstHandle=e.connect(b,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=e.connect(b,"onMoving",this,this._movingHandler);this._stopHandle=e.connect(b,"onMoveStop",this,this._moveStopHandler);
return b},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(b){var d=this.map;d.snappingManager&&d.snappingManager._setUpSnapping();b.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(b){var d=b.shape,a=this._getControlEdges(),
c=this._scratchGL._div,h,e=[],g=b.host.shape._wrapOffsets[0]||0;for(h=0;h<a.length;h++){var k=a[h];k.x1+=g;k.x2+=g;e.push([c.createLine({x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2}).setStroke(this.editor._lineStroke),k.x1,k.y1,k.x2,k.y2])}d._lines=e;b.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(b){var d=b.shape;b=d.getTransform();for(var a=d._lines,d=0;d<a.length;d++){var c=a[d];c[0].setShape({x1:c[1]+
b.dx,y1:c[2]+b.dy,x2:c[3],y2:c[4]})}this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),b)},_moveStopHandler:function(b){b=b.shape;var d=this.editor.toolbar,a=b.getTransform(),c=this.map,h=this.graphic,e=d._geo?k.geographicToWebMercator(h.geometry):h.geometry,g,f=b._lines;if(f){for(g=0;g<f.length;g++)f[g][0].removeShape();b._lines=null}g=!1;var f=!0,m=this._getInfo();a&&(a.dx||a.dy)?this._placeholder&&(this._placeholder=!1,g=!0):f=!1;var s;c.snappingManager&&(s=c.snappingManager._snappingPoint);
s=s||c.toMap(c.toScreen(e).offset(a.dx,a.dy));c.snappingManager&&c.snappingManager._killOffSnapping();b.setTransform(null);h.setGeometry(d._geo?k.webMercatorToGeographic(s,!0):s);this.constructor.onMoveStop(this,a);d.onVertexMoveStop(this.relatedGraphic,m,a);if(!f)d.onVertexClick(this.relatedGraphic,m);if(g)d.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var b=this.map,d=this.relatedGraphic.geometry,a=this.segIndex,c=this.ptIndex,h=this.segLength,e=this._scratchGL._div.getTransform(),
g=e.dx,e=e.dy,k=b.toScreen(this.graphic.geometry),b=k.x-g,k=k.y-e,f=[],d=this.editor._getControlPoints(this,d,a,c,h);d[0]&&f.push({x1:b,y1:k,x2:d[0].x-g,y2:d[0].y-e});d[1]&&f.push({x1:b,y1:k,x2:d[1].x-g,y2:d[1].y-e});return f}});t("extend-esri")&&q.setObject("toolbars.VertexMover",f,m);q.mixin(f,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return f})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),
function(f,q,e,t,u,v,s,m){f=f(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,
polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,startTime:null,startTimeIsUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(g){var d={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnStops:this.returnStops,returnBarriers:this.returnBarriers,
returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&e.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||e.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?
this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,
outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:m.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,travelMode:this.travelMode},k=this.stops;"esri.tasks.FeatureSet"===k.declaredClass&&0<k.features.length?d.stops=e.toJson({type:"features",features:s._encodeGraphics(k.features,g&&g["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===
k.declaredClass?d.stops=k:"esri.tasks.DataFile"===k.declaredClass&&(d.stops=e.toJson({type:"features",url:k.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":d.directionsOutputType="esriDOTComplete";break;case "complete-no-events":d.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":d.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":d.directionsOutputType=
"esriDOTStandard";break;case "summary-only":d.directionsOutputType="esriDOTSummaryOnly";break;default:d.directionsOutputType=this.directionsOutputType}k=function(b,d){return!b?null:"esri.tasks.FeatureSet"===b.declaredClass?0<b.features.length?e.toJson({type:"features",features:s._encodeGraphics(b.features,g&&g[d])}):null:"esri.tasks.DataLayer"===b.declaredClass?b:"esri.tasks.DataFile"===b.declaredClass?e.toJson({type:"features",url:b.url}):e.toJson(b)};this.barriers&&(d.barriers=k(this.barriers,"barriers.features"));
this.polygonBarriers&&(d.polygonBarriers=k(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(d.polylineBarriers=k(this.polylineBarriers,"polylineBarriers.features"));return v.filter(d,function(b){if(null!==b)return!0})}});t("extend-esri")&&q.setObject("tasks.RouteParameters",f,u);return f})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(f,q,e){function t(e,d){return Math.abs(e-d)<=1E-6*(Math.abs(e)+Math.abs(d))}function u(e,d,k,b){if(isFinite(e)){if(!isFinite(k))return e}else return k;
d=Math.abs(d);b=Math.abs(b);return(d*e+b*k)/(d+b)}function v(g){g=e.normalize(g);var d=-g.xx-g.yy,k=g.xx*g.yy-g.xy*g.yx,b=Math.sqrt(d*d-4*k),d=-(d+(0>d?-b:b))/2,k=k/d,b=g.xy/(d-g.xx),f=1,a=g.xy/(k-g.xx),c=1;t(d,k)&&(b=1,a=f=0,c=1);isFinite(b)||(b=1,f=(d-g.xx)/g.xy,isFinite(f)||(b=(d-g.yy)/g.yx,f=1,isFinite(b)||(b=1,f=g.yx/(d-g.yy))));isFinite(a)||(a=1,c=(k-g.xx)/g.xy,isFinite(c)||(a=(k-g.yy)/g.yx,c=1,isFinite(a)||(a=1,c=g.yx/(k-g.yy))));g=Math.sqrt(b*b+f*f);var h=Math.sqrt(a*a+c*c);if(!isFinite(b/=
g))b=0;if(!isFinite(f/=g))f=0;if(!isFinite(a/=h))a=0;if(!isFinite(c/=h))c=0;return{value1:d,value2:k,vector1:{x:b,y:f},vector2:{x:a,y:c}}}function s(e,d){var k=0>e.xx*e.yy||0<e.xy*e.yx?-1:1,b=d.angle1=(Math.atan2(e.yx,e.yy)+Math.atan2(-k*e.xy,k*e.xx))/2,k=Math.cos(b),b=Math.sin(b);d.sx=u(e.xx/k,k,-e.xy/b,b);d.sy=u(e.yy/k,k,e.yx/b,b);return d}function m(e,d){var k=0>e.xx*e.yy||0<e.xy*e.yx?-1:1,b=d.angle2=(Math.atan2(k*e.yx,k*e.xx)+Math.atan2(-e.xy,e.yy))/2,k=Math.cos(b),b=Math.sin(b);d.sx=u(e.xx/k,
k,e.yx/b,b);d.sy=u(e.yy/k,k,-e.xy/b,b);return d}return f.decompose=function(g){var d=e.normalize(g);g={dx:d.dx,dy:d.dy,sx:1,sy:1,angle1:0,angle2:0};if(t(d.xy,0)&&t(d.yx,0))return q.mixin(g,{sx:d.xx,sy:d.yy});if(t(d.xx*d.yx,-d.xy*d.yy))return s(d,g);if(t(d.xx*d.xy,-d.yx*d.yy))return m(d,g);var k,b=new e.Matrix2D(d);k=q.mixin(b,{dx:0,dy:0,xy:b.yx,yx:b.xy});b=v([d,k]);k=v([k,d]);b=new e.Matrix2D({xx:b.vector1.x,xy:b.vector2.x,yx:b.vector1.y,yy:b.vector2.y});k=new e.Matrix2D({xx:k.vector1.x,xy:k.vector1.y,
yx:k.vector2.x,yy:k.vector2.y});d=new e.Matrix2D([e.invert(b),d,e.invert(k)]);s(k,g);d.xx*=g.sx;d.yy*=g.sy;m(b,g);d.xx*=g.sx;d.yy*=g.sy;return q.mixin(g,{sx:d.xx,sy:d.yy})}})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),function(f,q,e,t,u,v,s){f=f(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(f){var g=f.spatialReference,d=f.route;if(f.directions){var k=[],b=[];e.forEach(f.directions.features,
function(a,c){b[c]=a.compressedGeometry;k[c]=a.strings});f.directions.strings=k;this.directions=new s(f.directions,b)}this.routeName=f.routeName;d&&(d.geometry&&(d.geometry.spatialReference=g),this.route=new v(d));if(f.stops){var n=this.stops=[];e.forEach(f.stops,function(a,b){a.geometry&&(a.geometry.spatialReference=g);n[a.attributes.Sequence-1]=new v(a)})}},routeName:null,directions:null,route:null,stops:null});t("extend-esri")&&q.setObject("tasks.RouteResult",f,u);return f})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),
function(f,q,e,t,u,v,s,m,g,d,k,b){e.isAsync||m(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var n=q("dojo.dnd.Source",k,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){t.mixin(this,t.mixin({},b));var d=this.accept;if(d.length){this.accept={};for(var e=0;e<d.length;++e)this.accept[d[e]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;
this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&u.add(this.node,"dojoDndSource");this.targetState="";this.accept&&u.add(this.node,"dojoDndTarget");this.horizontal&&u.add(this.node,"dojoDndHorizontal");this.topics=[g.subscribe("/dnd/source/over",t.hitch(this,"onDndSourceOver")),g.subscribe("/dnd/start",t.hitch(this,"onDndStart")),g.subscribe("/dnd/drop",t.hitch(this,"onDndDrop")),g.subscribe("/dnd/cancel",t.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==
a)return!this.copyOnly||this.selfAccept;for(var d=0;d<b.length;++d){for(var e=a.getItem(b[d].id).type,g=!1,k=0;k<e.length;++k)if(e[k]in this.accept){g=!0;break}if(!g)return!1}return!0},copyState:function(a,c){if(a)return!0;2>arguments.length&&(c=this==b.manager().target);if(c){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){n.superclass.destroy.call(this);f.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!(this.isDragging&&
"Disabled"==this.targetState)){n.superclass.onMouseMove.call(this,a);var c=b.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var e=this.getSelectedNodes();e.length&&c.startDrag(this,e,this.copyState(d.getCopyKeyState(a),!0))}if(this.isDragging){e=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=v.position(this.current,!0);e=this.horizontal?a.pageX-this.targetBox.x<
this.targetBox.w/2==v.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||e!=this.before)this._markTargetAnchor(e),c.canDrop(!this.current||c.source!=this||!(this.current.id in this.selection))}}},onMouseDown:function(a){if(!this.mouseDown&&this._legalMouseDown(a)&&(!this.skipForm||!d.isFormElement(a)))this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,n.superclass.onMouseDown.call(this,a)},onMouseUp:function(a){this.mouseDown&&
(this.mouseDown=!1,n.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=b.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,c,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");c=this.accept&&this.checkAcceptance(a,c);this._changeState("Target",c?
"":"Disabled");this==a&&b.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,d,e){if(this==e)this.onDrop(a,b,d);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,d){if(this!=a)this.onDropExternal(a,b,d);else this.onDropInternal(b,d)},onDropExternal:function(a,b,e){var g=this._normalizedCreator;
this._normalizedCreator=this.creator?function(b,c){return g.call(this,a.getItem(b.id).data,c)}:e?function(b){var c=a.getItem(b.id);b=b.cloneNode(!0);b.id=d.getUniqueId();return{node:b,data:c.data,type:c.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();!e&&!this.creator&&a.selectNone();this.insertNodes(!0,b,this.before,this.current);!e&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=g},onDropInternal:function(a,b){var e=
this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return e.call(this,this.getItem(a.id).data,b)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=d.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=
e}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){n.superclass.onOverEvent.call(this);b.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){n.superclass.onOutEvent.call(this);b.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!s.isLeft(a))return!1;
if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(u.contains(a,"dojoDndHandle"))return!0;if(u.contains(a,"dojoDndItem")||u.contains(a,"dojoDndIgnore"))break}return!1}});return n})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),function(f,q,e,t,u,v,s,m,g,d){return q("dojox.gfx.Moveable",null,{constructor:function(d,b){this.shape=
d;this.delay=b&&0<b.delay?b.delay:0;this.mover=b&&b.mover?b.mover:g;this.leftButtonOnly=b&&b.leftButtonOnly;this.events=[this.shape.on(v.press,f.hitch(this,"onMouseDown"))]},destroy:function(){e.forEach(this.events,function(d){d.remove()});this.events=this.shape=null},onMouseDown:function(e){this.delay?(this.events.push(this.shape.on(v.move,f.hitch(this,"onMouseMove")),this.shape.on(v.release,f.hitch(this,"onMouseUp"))),this._lastX=e.clientX,this._lastY=e.clientY):(!this.leftButtonOnly||d.isLeft(e))&&
new this.mover(this.shape,e,this);t.stop(e)},onMouseMove:function(d){var b=d.clientY;if(Math.abs(d.clientX-this._lastX)>this.delay||Math.abs(b-this._lastY)>this.delay)this.onMouseUp(d),new this.mover(this.shape,d,this);t.stop(d)},onMouseUp:function(d){this.events.pop().remove()},onMoveStart:function(d){u.publish("/gfx/move/start",d);s.add(m.body(),"dojoMove")},onMoveStop:function(d){u.publish("/gfx/move/stop",d);s.remove(m.body(),"dojoMove")},onFirstMove:function(d){},onMove:function(d,b){this.onMoving(d,
b);this.shape.applyLeftTransform(b);this.onMoved(d,b)},onMoving:function(d,b){},onMoved:function(d,b){}})})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});e("extend-esri")&&q.setObject("tasks.PrintParameters",f,t);return f})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(f,q,e,t,u){f=f(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(e){q.mixin(this,e);this.location=new u(this.location)}});e("extend-esri")&&q.setObject("tasks.AddressCandidate",f,t);return f})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(f,q,e,t,u,
v,s,m,g,d){var k=f.shape={};k.Shape=e("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(u("gfxRegistry")){var b=k.register(this);this.getUID=function(){return b}}},destroy:function(){u("gfxRegistry")&&k.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},
getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var b=this.getBoundingBox();if(!b)return null;var e=this._getRealMatrix();return[d.multiplyPoint(e,b.x,b.y),d.multiplyPoint(e,b.x+b.width,b.y),d.multiplyPoint(e,b.x+b.width,b.y+b.height),d.multiplyPoint(e,b.x,b.y+b.height)]},getEventSource:function(){return this.rawNode},
setClip:function(b){this.clip=b},getClip:function(){return this.clip},setShape:function(b){this.shape=f.makeParameters(this.shape,b);this.bbox=null;return this},setFill:function(b){if(!b)return this.fillStyle=null,this;var d=null;if("object"==typeof b&&"type"in b)switch(b.type){case "linear":d=f.makeParameters(f.defaultLinearGradient,b);break;case "radial":d=f.makeParameters(f.defaultRadialGradient,b);break;case "pattern":d=f.makeParameters(f.defaultPattern,b)}else d=f.normalizeColor(b);this.fillStyle=
d;return this},setStroke:function(b){if(!b)return this.strokeStyle=null,this;if("string"==typeof b||q.isArray(b)||b instanceof g)b={color:b};b=this.strokeStyle=f.makeParameters(f.defaultStroke,b);b.color=f.normalizeColor(b.color);return this},setTransform:function(b){this.matrix=d.clone(b?d.normalize(b):d.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var b=this.getParent();b&&(b._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var b=
this.getParent();b&&(b._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(b){return b?this.setTransform([this.matrix,b]):this},applyLeftTransform:function(b){return b?this.setTransform([b,this.matrix]):this},applyTransform:function(b){return b?this.setTransform([this.matrix,b]):this},removeShape:function(b){this.parent&&this.parent.remove(this,b);return this},_setParent:function(b,d){this.parent=b;return this._updateParentMatrix(d)},
_updateParentMatrix:function(b){this.parentMatrix=b?d.clone(b):null;return this._applyTransform()},_getRealMatrix:function(){for(var b=this.matrix,e=this.parent;e;)e.matrix&&(b=d.multiply(e.matrix,b)),e=e.parent;return b}});k._eventsProcessing={on:function(b,d){return v(this.getEventSource(),b,k.fixCallback(this,f.fixTarget,d))},connect:function(b,d,a){"on"==b.substring(0,2)&&(b=b.substring(2));return this.on(b,a?q.hitch(d,a):d)},disconnect:function(b){return b.remove()}};k.fixCallback=function(b,
d,a,c){c||(c=a,a=null);if(q.isString(c)){a=a||t.global;if(!a[c])throw['dojox.gfx.shape.fixCallback: scope["',c,'"] is null (scope\x3d"',a,'")'].join("");return function(e){return d(e,b)?a[c].apply(a,arguments||[]):void 0}}return!a?function(e){return d(e,b)?c.apply(a,arguments):void 0}:function(e){return d(e,b)?c.apply(a,arguments||[]):void 0}};q.extend(k.Shape,k._eventsProcessing);k.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},
add:function(b){var d=b.getParent();d&&d.remove(b,!0);this.children.push(b);return b._setParent(this,this._getRealMatrix())},remove:function(b,d){for(var a=0;a<this.children.length;++a)if(this.children[a]==b){d||(b.parent=null,b.parentMatrix=null);this.children.splice(a,1);break}return this},clear:function(b){for(var d,a=0;a<this.children.length;++a)d=this.children[a],d.parent=null,d.parentMatrix=null,b&&d.destroy();this.children=[];return this},getBoundingBox:function(){if(this.children){var b=null;
s.forEach(this.children,function(e){var a=e.getBoundingBox();a&&((e=e.getTransform())&&(a=d.multiplyRectangle(e,a)),b?(b.x=Math.min(b.x,a.x),b.y=Math.min(b.y,a.y),b.endX=Math.max(b.endX,a.x+a.width),b.endY=Math.max(b.endY,a.y+a.height)):b={x:a.x,y:a.y,endX:a.x+a.width,endY:a.y+a.height})});b&&(b.width=b.endX-b.x,b.height=b.endY-b.y);return b}return null},_moveChildToFront:function(b){for(var d=0;d<this.children.length;++d)if(this.children[d]==b){this.children.splice(d,1);this.children.push(b);break}return this},
_moveChildToBack:function(b){for(var d=0;d<this.children.length;++d)if(this.children[d]==b){this.children.splice(d,1);this.children.unshift(b);break}return this}};k.Surface=e("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){s.forEach(this._nodes,m.destroy);this._nodes=[];s.forEach(this._events,function(b){b&&b.remove()});this._events=[];this.rawNode=null;if(u("ie"))for(;this._parent.lastChild;)m.destroy(this._parent.lastChild);
else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(b){},whenLoaded:function(b,d){var a=q.hitch(b,d);if(this.isLoaded)a(this);else v.once(this,"load",function(b){a(b)})}});q.extend(k.Surface,k._eventsProcessing);k.Rect=e("dojox.gfx.shape.Rect",k.Shape,{constructor:function(b){this.shape=f.getDefault("Rect");this.rawNode=b},getBoundingBox:function(){return this.shape}});k.Ellipse=e("dojox.gfx.shape.Ellipse",
k.Shape,{constructor:function(b){this.shape=f.getDefault("Ellipse");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-b.rx,y:b.cy-b.ry,width:2*b.rx,height:2*b.ry}}return this.bbox}});k.Circle=e("dojox.gfx.shape.Circle",k.Shape,{constructor:function(b){this.shape=f.getDefault("Circle");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:b.cx-b.r,y:b.cy-b.r,width:2*b.r,height:2*b.r}}return this.bbox}});k.Line=e("dojox.gfx.shape.Line",
k.Shape,{constructor:function(b){this.shape=f.getDefault("Line");this.rawNode=b},getBoundingBox:function(){if(!this.bbox){var b=this.shape;this.bbox={x:Math.min(b.x1,b.x2),y:Math.min(b.y1,b.y2),width:Math.abs(b.x2-b.x1),height:Math.abs(b.y2-b.y1)}}return this.bbox}});k.Polyline=e("dojox.gfx.shape.Polyline",k.Shape,{constructor:function(b){this.shape=f.getDefault("Polyline");this.rawNode=b},setShape:function(b,d){b&&b instanceof Array?(this.inherited(arguments,[{points:b}]),d&&this.shape.points.length&&
this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[b]);return this},_normalizePoints:function(){var b=this.shape.points,d=b&&b.length;if(d&&"number"==typeof b[0]){for(var a=[],c=0;c<d;c+=2)a.push({x:b[c],y:b[c+1]});this.shape.points=a}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var b=this.shape.points,d=b.length,a=b[0],c=a.x,e=a.y,g=a.x,f=a.y,k=1;k<d;++k)a=b[k],c>a.x&&(c=a.x),g<a.x&&(g=a.x),e>a.y&&(e=a.y),f<a.y&&(f=a.y);this.bbox={x:c,y:e,width:g-
c,height:f-e}}return this.bbox}});k.Image=e("dojox.gfx.shape.Image",k.Shape,{constructor:function(b){this.shape=f.getDefault("Image");this.rawNode=b},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});k.Text=e(k.Shape,{constructor:function(b){this.fontStyle=null;this.shape=f.getDefault("Text");this.rawNode=b},getFont:function(){return this.fontStyle},setFont:function(b){this.fontStyle="string"==typeof b?f.splitFontString(b):f.makeParameters(f.defaultFont,
b);this._setFont();return this},getBoundingBox:function(){var b=null;this.getShape().text&&(b=f._base._computeTextBoundingBox(this));return b}});k.Creator={createShape:function(b){switch(b.type){case f.defaultPath.type:return this.createPath(b);case f.defaultRect.type:return this.createRect(b);case f.defaultCircle.type:return this.createCircle(b);case f.defaultEllipse.type:return this.createEllipse(b);case f.defaultLine.type:return this.createLine(b);case f.defaultPolyline.type:return this.createPolyline(b);
case f.defaultImage.type:return this.createImage(b);case f.defaultText.type:return this.createText(b);case f.defaultTextPath.type:return this.createTextPath(b)}return null},createGroup:function(){return this.createObject(f.Group)},createRect:function(b){return this.createObject(f.Rect,b)},createEllipse:function(b){return this.createObject(f.Ellipse,b)},createCircle:function(b){return this.createObject(f.Circle,b)},createLine:function(b){return this.createObject(f.Line,b)},createPolyline:function(b){return this.createObject(f.Polyline,
b)},createImage:function(b){return this.createObject(f.Image,b)},createText:function(b){return this.createObject(f.Text,b)},createPath:function(b){return this.createObject(f.Path,b)},createTextPath:function(b){return this.createObject(f.TextPath,{}).setText(b)},createObject:function(b,d){return null}};return k})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(f,q,e,t){f=f(null,{declaredClass:"esri.tasks.RasterData",constructor:function(e){e&&
q.mixin(this,e)},url:null,format:null,itemID:null,toJson:function(){var e={};this.url&&(e.url=this.url);this.format&&(e.format=this.format);this.itemID&&(e.itemID=this.itemID);return e}});e("extend-esri")&&q.setObject("tasks.RasterData",f,t);return f})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(f,q){return f("dijit._Contained",null,{_getSibling:function(e){var f=this.domNode;do f=f[e+"Sibling"];while(f&&1!=f.nodeType);return f&&q.byNode(f)},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var e=this.getParent();return!e||!e.getIndexOfChild?-1:e.getIndexOfChild(this)}})})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b,n,a){q=q("dojo.dnd.Container",g,{skipForm:!1,allowNested:!1,constructor:function(a,
b){this.node=v.byId(a);b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&v.byId(b.dropParent);this.map={};this.current=null;this.containerState="";s.add(this.node,"dojoDndContainer");(!b||!b._skipStartup)&&this.startup();this.events=[k(this.node,n.over,t.hitch(this,"onMouseOver")),k(this.node,n.out,t.hitch(this,"onMouseOut")),k(this.node,"dragstart",t.hitch(this,"onSelectStart")),k(this.node,"selectstart",t.hitch(this,"onSelectStart"))]},creator:function(){},
getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(b,d){d=d||e.global;var g=this.map,f=a._empty,k;for(k in g)k in f||b.call(d,g[k],k,this);return d},clearItems:function(){this.map={}},getAllNodes:function(){return b((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var b={};this.getAllNodes().forEach(function(d){if(d.id){var e=this.getItem(d.id);if(e){b[d.id]=e;return}}else d.id=a.getUniqueId();
var e=d.getAttribute("dndType"),g=d.getAttribute("dndData");b[d.id]={data:g||d.innerHTML,type:e?e.split(/\s*,\s*/):["text"]}},this);this.map=b;return this},insertNodes:function(a,b,d){this.parent.firstChild?b?d||(d=this.parent.firstChild):d&&(d=d.nextSibling):d=null;var e;if(d)for(b=0;b<a.length;++b)e=this._normalizedCreator(a[b]),this.setItem(e.node.id,{data:e.data,type:e.type}),d.parentNode.insertBefore(e.node,d);else for(b=0;b<a.length;++b)e=this._normalizedCreator(a[b]),this.setItem(e.node.id,
{data:e.data,type:e.type}),this.parent.appendChild(e.node);return this},destroy:function(){f.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,d){a._skipStartup=!0;return new d(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var b=this.parent.getElementsByTagName("tbody");b&&b.length&&(this.parent=b[0])}this.defaultCreator=a._defaultCreator(this.parent);this.sync()},
onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(d){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(b){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container",
"");this.onOutEvent()},onSelectStart:function(b){if(!this.skipForm||!a.isFormElement(b))b.stopPropagation(),b.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var d="dojoDnd"+a,e=a.toLowerCase()+"State";s.replace(this.node,d+b,d+this[e]);this[e]=b},_addItemClass:function(a,b){s.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){s.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==
this.parent||this.allowNested)&&s.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(b,d){var e=(this.creator||this.defaultCreator).call(this,b,d);t.isArray(e.type)||(e.type=["text"]);e.node.id||(e.node.id=a.getUniqueId());s.add(e.node,"dojoDndItem");return e}});a._createNode=function(b){return!b?a._createSpan:function(a){return m.create(b,{innerHTML:a})}};a._createTrTd=function(a){var b=m.create("tr");m.create("td",{innerHTML:a},b);return b};a._createSpan=function(a){return m.create("span",
{innerHTML:a})};a._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};a._defaultCreator=function(b){b=b.tagName.toLowerCase();var d="tbody"==b||"thead"==b?a._createTrTd:a._createNode(a._defaultCreatorNodes[b]);return function(b,c){var e=b&&t.isObject(b),g,f;e&&b.tagName&&b.nodeType&&b.getAttribute?(g=b.getAttribute("dndData")||b.innerHTML,e=(e=b.getAttribute("dndType"))?e.split(/\s*,\s*/):["text"],f=b):(g=e&&b.data?b.data:b,e=e&&b.type?b.type:["text"],f=("avatar"==c?a._createSpan:d)(String(g)));
f.id||(f.id=a.getUniqueId());return{node:f,data:g,type:e}}};return q})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(f){f=f.bezierutils={};f.tAtLength=function(f,m){var g=0,d=6==f.length,k=0,b=0,n=d?t:v,a=function(c,h){for(var l=0,r=0;r<c.length-2;r+=2)l+=e(c[r],c[r+1],c[r+2],c[r+3]);r=d?e(f[0],f[1],f[4],f[5]):e(f[0],f[1],f[6],f[7]);l-r>h||k+l>m+h?(++b,l=n(c,0.5),a(l[0],h),Math.abs(k-m)<=h||a(l[1],h)):(k+=l,g+=1/(1<<b))};m&&a(f,0.5);return g};var q=f.computeLength=function(f){for(var m=
6==f.length,g=0,d=0;d<f.length-2;d+=2)g+=e(f[d],f[d+1],f[d+2],f[d+3]);d=m?e(f[0],f[1],f[4],f[5]):e(f[0],f[1],f[6],f[7]);0.1<g-d&&(f=m?t(f,0.5):u(f,0.5),g=q(f[0],m),g+=q(f[1],m));return g},e=f.distance=function(e,f,g,d){return Math.sqrt((g-e)*(g-e)+(d-f)*(d-f))},t=function(e,f){var g=1-f,d=g*g,k=f*f,b=e[0],n=e[1],a=e[2],c=e[3],h=e[4],l=e[5],r=d*b+2*g*f*a+k*h,d=d*n+2*g*f*c+k*l;return[[b,n,g*b+f*a,g*n+f*c,r,d],[r,d,g*a+f*h,g*c+f*l,h,l]]},u=function(e,f){var g=1-f,d=g*g,k=d*g,b=f*f,n=b*f,a=e[0],c=e[1],
h=e[2],l=e[3],r=e[4],q=e[5],t=e[6],u=e[7],v=k*a+3*d*f*h+3*g*b*r+n*t,k=k*c+3*d*f*l+3*g*b*q+n*u;return[[a,c,g*a+f*h,g*c+f*l,d*a+2*g*f*h+b*r,d*c+2*g*f*l+b*q,v,k],[v,k,d*h+2*g*f*r+b*t,d*l+2*g*f*q+b*u,g*r+f*t,g*q+f*u,t,u]]},v=f.splitBezierAtT=function(e,f){return 6==e.length?t(e,f):u(e,f)};return f})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(f,q,e,t,u,v,s,m){f=
f(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var g=e.map(this.geometries,function(d){return d.toJson()}),d={};d.outSR=this.outSR.wkid||t.toJson(this.outSR.toJson());d.inSR=this.geometries[0].spatialReference.wkid||t.toJson(this.geometries[0].spatialReference.toJson());d.geometries=t.toJson({geometryType:m.getJsonType(this.geometries[0]),geometries:g});this.transformation&&(d.transformation=this.transformation.wkid||
t.toJson(this.transformation));s.isDefined(this.transformForward)&&(d.transformForward=this.transformForward);return d}});u("extend-esri")&&q.setObject("tasks.ProjectParameters",f,v);return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(f,q,e,t,u,v,s,m,g,d,k,b,n,a){var c=q("dojo.dnd.Manager",[v],{constructor:function(){this.source=
this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:s("touch")?0:16,OFFSET_Y:s("touch")?-64:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=Boolean(this.target),this.avatar.update());d.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),d.publish("/dnd/source/over",null)):d.publish("/dnd/source/over",
null)},startDrag:function(a,b,c){function f(a){a.preventDefault();a.stopPropagation()}n.autoScrollStart(t.doc);this.source=a;this.nodes=b;this.copy=Boolean(c);this.avatar=this.makeAvatar();t.body().appendChild(this.avatar.node);d.publish("/dnd/start",a,b,this.copy);this.events=[g(t.doc,k.move,e.hitch(this,"onMouseMove")),g(t.doc,k.release,e.hitch(this,"onMouseUp")),g(t.doc,"keydown",e.hitch(this,"onKeyDown")),g(t.doc,"keyup",e.hitch(this,"onKeyUp")),g(t.doc,"dragstart",f),g(t.body(),"selectstart",
f)];u.add(t.body(),"dojoDnd"+(c?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){u.remove(t.body(),["dojoDndCopy","dojoDndMove"]);f.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new a(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var c=this.avatar;c&&
(n.autoScrollNodes(a),c=c.node.style,c.left=a.pageX+this.OFFSET_X+"px",c.top=a.pageY+this.OFFSET_Y+"px",c=Boolean(this.source.copyState(b.getCopyKeyState(a))),this.copy!=c&&this._setCopyStatus(c));s("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var c=Boolean(this.source.copyState(b.getCopyKeyState(a)));d.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,a);d.publish("/dnd/drop",this.source,this.nodes,c,this.target,a)}else d.publish("/dnd/cancel");
this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case m.CTRL:a=Boolean(this.source.copyState(!0));this.copy!=a&&this._setCopyStatus(a);break;case m.ESCAPE:d.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==m.CTRL&&(a=Boolean(this.source.copyState(!1)),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();u.replace(t.body(),"dojoDnd"+(this.copy?"Copy":"Move"),
"dojoDnd"+(this.copy?"Move":"Copy"))}});b._manager=null;c.manager=b.manager=function(){b._manager||(b._manager=new c);return b._manager};return c})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(f,q,e,t,u,v,s,m){return f("dojo.dnd.Avatar",null,{constructor:function(e){this.manager=e;this.construct()},construct:function(){var e=v.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",
zIndex:"1999",margin:"0px"}}),d=this.manager.source,f,b=v.create("tbody",null,e),n=v.create("tr",null,b),a=v.create("td",null,n),c=Math.min(5,this.manager.nodes.length),h=0;s("highcontrast")&&v.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},a);v.create("span",{innerHTML:d.generateText?this._generateText():""},a);for(t.set(n,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});h<c;++h)d.creator?f=d._normalizedCreator(d.getItem(this.manager.nodes[h].id).data,"avatar").node:(f=
this.manager.nodes[h].cloneNode(!0),"tr"==f.tagName.toLowerCase()&&(n=v.create("table"),v.create("tbody",null,n).appendChild(f),f=n)),f.id="",n=v.create("tr",null,b),a=v.create("td",null,n),a.appendChild(f),t.set(n,{"class":"dojoDndAvatarItem",style:{opacity:(9-h)/10}});this.node=e},destroy:function(){v.destroy(this.node);this.node=!1},update:function(){u.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(s("highcontrast")){var g=e.byId("a11yIcon"),d="+";this.manager.canDropFlag&&
!this.manager.copy?d="\x3c ":!this.manager.canDropFlag&&!this.manager.copy?d="o":this.manager.canDropFlag||(d="x");g.innerHTML=d}m("tr.dojoDndAvatarHeader td span"+(s("highcontrast")?" span":""),this.node).forEach(function(d){d.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(f,
q,e,t){return f("dijit.DropDownMenu",t,{templateString:e,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(e){this._moveToPopup(e);e.stopPropagation();e.preventDefault()},_onLeftArrow:function(e){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else e.stopPropagation(),e.preventDefault()}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(f,q,e,t,u,v,s,m,g,d,k,b){s=f("dijit.MenuItem"+(v("dojo-bidi")?"_NoBidi":""),[m,g,d,k],{templateString:b,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(b){this._set("label",b);var a="",c;c=b.search(/{\S}/);if(0<=c){var a=b.charAt(c+1),d=b.substr(0,c);b=b.substr(c+3);c=d+a+b;b=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+a+"\x3c/span\x3e"+b}else c=b;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=b;this._set("shortcutKey",a)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(b){b&&!("label"in this.params)&&this._set("label",b.innerHTML)},buildRendering:function(){this.inherited(arguments);e.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&e.set(this.accelKeyNode,"id",this.id+"_accel");q.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==v("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(b){}},_setSelected:function(b){t.toggle(this.domNode,
"dijitMenuItemSelected",b)},setLabel:function(b){u.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",b)},setDisabled:function(b){u.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",b)},_setDisabledAttr:function(b){this.focusNode.setAttribute("aria-disabled",b?"true":"false");this._set("disabled",b)},_setAccelKeyAttr:function(b){this.accelKeyNode&&(this.accelKeyNode.style.display=
b?"":"none",this.accelKeyNode.innerHTML=b,e.set(this.containerNode,"colSpan",b?"1":"2"));this._set("accelKey",b)}});v("dojo-bidi")&&(s=f("dijit.MenuItem",s,{_setLabelAttr:function(b){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return s})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(f,
q,e,t,u,v,s,m,g,d,k){f=f(d,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(b){this._geocodeHandler=q.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=q.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=q.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(b){this.outSpatialReference=b},_geocodeHandler:function(b,d,a,c,e){try{var g=b.candidates,f;d=[];var m,q=g.length,s=b.spatialReference,t;for(m=0;m<q;m++){f=g[m];if(t=f.location)t.spatialReference=s;d[m]=new k(f)}this._successHandler([d],"onAddressToLocationsComplete",a,e)}catch(u){this._errorHandler(u,c,e)}},_geocodeAddressesHandler:function(b,d,a,c,e){try{var g=b.locations;d=[];var f,m=g.length,q=b.spatialReference,s;for(f=0;f<m;f++){if(s=
g[f].location)s.spatialReference=q;d[f]=new k(g[f])}this._successHandler([d],"onAddressesToLocationsComplete",a,e)}catch(t){this._errorHandler(t,c,e)}},addressToLocations:function(b,d,a,c,e){var f,k,s,v,F,x,A;b.address&&(c=a,a=d,d=b.outFields,e=b.searchExtent,A=b.countryCode,f=b.magicKey,k=b.distance,x=b.categories,b.location&&this.normalization&&(s=b.location.normalize()),v=b.maxLocations,F=b.forStorage,b=b.address);e&&(e=e.shiftCentralMeridian());var E=this.outSpatialReference;b=this._encode(q.mixin({},
this._url.query,b,{f:"json",outSR:E&&u.toJson(E.toJson()),outFields:d&&d.join(",")||null,searchExtent:e&&u.toJson(e.toJson()),category:x&&x.join(",")||null,countryCode:A||null,magicKey:f||null,distance:k||null,location:s||null,maxLocations:v||null,forStorage:F||null}));var y=this._geocodeHandler,H=this._errorHandler,G=new t(g._dfdCanceller);G._pendingDfd=m({url:this._url.path+"/findAddressCandidates",content:b,callbackParamName:"callback",load:function(b,d){y(b,d,a,c,G)},error:function(a){H(a,c,G)}});
return G},suggestLocations:function(b){var d;d=new t;b.hasOwnProperty("location")&&this.normalization&&(b.location=b.location.normalize());b.searchExtent&&(b.searchExtent=b.searchExtent.shiftCentralMeridian());b=this._encode(q.mixin({},this._url.query,{f:"json",text:b.text,searchExtent:b.searchExtent&&u.toJson(b.searchExtent.toJson()),category:b.categories&&b.categories.join(",")||null,location:b.location||null,distance:b.distance||null},{f:"json"}));m({url:this._url.path+"/suggest",content:b,callbackParamName:"callback"}).then(q.hitch(this,
function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);d.resolve(a)}),q.hitch(this,function(a){this._errorHandler(a);d.reject(a)}));return d},addressesToLocations:function(b,d,a){var c=this.outSpatialReference,f=[];e.forEach(b.addresses,function(a,b){f.push({attributes:a})});b=this._encode(q.mixin({},this._url.query,{addresses:u.toJson({records:f})},{f:"json",outSR:c&&u.toJson(c.toJson())}));var k=this._geocodeAddressesHandler,r=this._errorHandler,s=new t(g._dfdCanceller);s._pendingDfd=
m({url:this._url.path+"/geocodeAddresses",content:b,callbackParamName:"callback",load:function(b,c){k(b,c,d,a,s)},error:function(b){r(b,a,s)}});return s},_reverseGeocodeHandler:function(b,d,a,c,e){try{var g=new k({address:b.address,location:b.location,score:100});this._successHandler([g],"onLocationToAddressComplete",a,e)}catch(f){this._errorHandler(f,c,e)}},locationToAddress:function(b,d,a,c){b&&this.normalization&&(b=b.normalize());var e=this.outSpatialReference;b=this._encode(q.mixin({},this._url.query,
{outSR:e&&u.toJson(e.toJson()),location:b&&u.toJson(b.toJson()),distance:d,f:"json"}));var f=this._reverseGeocodeHandler,k=this._errorHandler,s=new t(g._dfdCanceller);s._pendingDfd=m({url:this._url.path+"/reverseGeocode",content:b,callbackParamName:"callback",load:function(b,d){f(b,d,a,c,s)},error:function(a){k(a,c,s)}});return s},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});
v("extend-esri")&&q.setObject("tasks.Locator",f,s);return f})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(f,q,e,t,u){f=f(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(e){this.messages=[];q.mixin(this,e);e=this.messages;var f,m=e.length;for(f=0;f<m;f++)e[f]=new u(e[f])},jobId:"",jobStatus:""});q.mixin(f,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});e("extend-esri")&&q.setObject("tasks.JobInfo",f,t);return f})},"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsTravelModeCarClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" travel-mode-key\x3d"Driving" data-dojo-attach-point\x3d"_useTravelModeCarNode"\x3e${_i18n.widgets.directions.travelMode.car}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsTravelModeTruckClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" travel-mode-key\x3d"Trucking" data-dojo-attach-point\x3d"_useTravelModeTruckNode"\x3e${_i18n.widgets.directions.travelMode.truck}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsTravelModeWalkingClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsButtonTabLastClass}" travel-mode-key\x3d"Walking" data-dojo-attach-point\x3d"_useTravelModeWalkingNode"\x3e${_i18n.widgets.directions.travelMode.walking}\x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_travelModeDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-dojo-attach-point\x3d"_useMilesNode"\x3e${_i18n.widgets.directions.units.MILES.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode"\x3e${_i18n.widgets.directions.units.KILOMETERS.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsImpedanceContainerClass}" data-dojo-attach-point\x3d"_travelModeImpedanceNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsImpedanceTimeClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" travel-mode-key\x3d"Time" data-dojo-attach-point\x3d"_useTravelModeTimeNode"\x3e${_i18n.widgets.directions.impedance.fastest}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsImpedanceDistanceClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsButtonTabLastClass}" travel-mode-key\x3d"Distance" data-dojo-attach-point\x3d"_useTravelModeDistanceNode"\x3e${_i18n.widgets.directions.impedance.shortest}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass}" data-dojo-attach-point\x3d"_getDirectionsButtonNode"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_errorNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"*noref":1}});
define("esri/dijit/Directions","require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Geocoder dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source ../kernel ../graphic ../units ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/PictureMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../request ../config ../tasks/ProjectParameters dojo/uacss".split(" "),function(f,
q,e,t,u,v,s,m,g,d,k,b,n,a,c,h,l,r,z,w,F,x,A,E,y,H,G,D,C,B,I,M,J,K,O,S,L,P,T,N,U,V,W,X,Q,Y,Z,$,R,aa,ba,ca){q=q("esri.dijit.Directions",[U,m],{templateString:F,basePath:f.toUrl("."),mapClickActive:!1,_eventMap:{activate:!0,deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"]},_tmDrivingTime:"Driving Time",_tmTruckingTime:"Trucking Time",_tmWalkingTime:"Walking Time",
_tmDrivingDistance:"Driving Distance",_tmTruckingDistance:"Trucking Distance",_tmWalkingDistance:"Walking Distance",constructor:function(a,b){this._css={widgetContainerClass:"esriDirectionsContainer",stopsContainerClass:"esriStopsContainer",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",travelModesContainerClass:"esriTravelModesContainer",
stopsTravelModeCarClass:"esriTravelModeCar",stopsTravelModeTruckClass:"esriTravelModeTruck",stopsTravelModeWalkingClass:"esriTravelModeWalking",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",
stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSummaryClass:"esriResultsSummary",resultsViewFullRouteClass:"esriResultsViewFullRoute",resultsRouteNameClass:"esriResultsRouteName",resultsRouteButtonContainerClass:"esriResultsButtonsContainer",
routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeLastClass:"esriDMTStopLast",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",
esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",
clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",directions:null,returnToStart:!1,optimalRoute:!1,
routeTaskUrl:location.protocol+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:location.protocol+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",geometryTaskUrl:location.protocol+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],geocoderOptions:{autoComplete:!1,autoNavigate:!1},stopsInfoTemplate:new B("Location","${address}${error}"),segmentInfoTemplate:new B("Route",
'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),textSymbolFont:new N("11px",N.STYLE_NORMAL,N.VARIANT_NORMAL,N.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new v([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new L({url:this.basePath+"/images/Directions/greenPoint.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,
10.875),fromSymbolDrag:(new L({url:this.basePath+"/images/Directions/greenPointMove.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new L({url:this.basePath+"/images/Directions/bluePoint.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new L({url:this.basePath+"/images/Directions/bluePointMove.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new L({url:this.basePath+"/images/Directions/redPoint.png",height:21.75,
width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new L({url:this.basePath+"/images/Directions/redPointMove.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new L({url:this.basePath+"/images/Directions/grayPoint.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new L({url:this.basePath+"/images/Directions/grayPointMove.png",height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),routeSymbol:(new P).setColor(new v([0,
69,117,1])).setWidth(4),segmentSymbol:(new P).setColor(new v([0,122,194,1])).setWidth(8),printPage:"",printTemplate:"",autoCenterAtSegmentStart:!0,focusOnNewStop:!0,dragging:!0,canModifyStops:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSegmentPopup:!0,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0};
this.defaults=e.mixin({},this.options,a);this._sortId="_dndId_"+this.id;this._stopReference="_dndStop_"+this.id;this._i18n=w;this.domNode=b},postCreate:function(){this.inherited(arguments);this.own(k(this._activateButtonNode,s,e.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(k(this._addDestinationNode,s,e.hitch(this,this._addStopButton)));this.own(k(this._optionsButtonNode,s,e.hitch(this,this._toggleOptionsMenu)));this.own(k(this._findOptimalOrderNode,s,e.hitch(this,
this._toggleCheckbox)));this.own(k(this._returnToStartNode,s,e.hitch(this,this._toggleCheckbox)));this.own(k(this._useTrafficNode,s,e.hitch(this,this._toggleCheckbox)));this.own(k(this._useMilesNode,s,e.hitch(this,this._toggleUnits)));this.own(k(this._useKilometersNode,s,e.hitch(this,this._toggleUnits)));this.own(k(this._useTravelModeTimeNode,s,e.hitch(this,this._toggleTravelModeImpedance)));this.own(k(this._useTravelModeDistanceNode,s,e.hitch(this,this._toggleTravelModeImpedance)));this.own(k(this._useTravelModeCarNode,
s,e.hitch(this,this._toggleTravelMode)));this.own(k(this._useTravelModeTruckNode,s,e.hitch(this,this._toggleTravelMode)));this.own(k(this._useTravelModeWalkingNode,s,e.hitch(this,this._toggleTravelMode)));this.own(k(this._getDirectionsButtonNode,s,e.hitch(this,this._solveAndZoom)));this.own(k(this._clearDirectionsButtonNode,s,e.hitch(this,function(){this.clearDirections();this.onDirectionsClear()})));this._setWidgetProperties();this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);
this._id=Math.round(1E8*Math.random());return this._init()},destroy:function(){this._disconnectEvents();A.empty(this.domNode);this.inherited(arguments)},activate:function(){this.set("mapClickActive",!0)},deactivate:function(){this.set("mapClickActive",!1)},_activate:function(){var a=this.get("mapClickActive");this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();a?(this.map&&(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),
this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=k(this.map,"click",e.hitch(this,function(a){this.addStop(new D(a.mapPoint)).then(e.hitch(this,function(){1<this.stopGraphics.length&&this.getDirections()}))}))),h.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(h.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_destroyGeocoders:function(){var a=
this.get("geocoders");if(a&&a.length)for(var b=0;b<a.length;b++)a[b]&&a[b].destroy();this.set("geocoders",[])},_disconnectEvents:function(){this.clearDirections(!0);var a;if(this._watchEvents&&this._watchEvents.length)for(a=0;a<this._watchEvents.length;a++)this._watchEvents[a].unwatch();if(this._onEvents&&this._onEvents.length)for(a=0;a<this._onEvents.length;a++)this._onEvents[a].remove();if(this._geocoderFindEvents&&this._geocoderFindEvents.length)for(a=0;a<this._geocoderFindEvents.length;a++)this._geocoderFindEvents[a].remove();
if(this._geocoderWatchEvents&&this._geocoderWatchEvents.length)for(a=0;a<this._geocoderWatchEvents.length;a++)this._geocoderWatchEvents[a].unwatch();if(this._geocoderSelectEvents&&this._geocoderSelectEvents.length)for(a=0;a<this._geocoderSelectEvents.length;a++)this._geocoderSelectEvents[a].remove();this._onEvents=[];this._watchEvents=[];this._geocoderSelectEvents=[];this._geocoderFindEvents=[];this._geocoderWatchEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();
this._destroyDnD()},clearDirections:function(){this.get("routeParams")&&this.get("routeParams").stops&&(this.get("routeParams").stops.features.length?this.get("routeParams").stops.features=[]:arguments.length||this.reset());this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._removeTrafficLayer()},reset:function(){return this._enqueue(function(){this._setWidgetProperties();return this._init()})},onActivate:function(){},onDeactivate:function(){},onLoad:function(){},
onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0)},onDirectionsFinish:function(){this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(a){return this._enqueue(function(){if(0<=a&&a<this.stops.length)return this.clearErrors(),this._removeStop(a);var b=new y;b.reject();return b.promise})},updateStops:function(a){return this._enqueue(function(){this.clearErrors();
return this._updateStops(a)})},addStops:function(a,b){return this._enqueue(function(){this.clearErrors();return this._addStops(a,b)})},addStop:function(a,b){return this._enqueue(function(){this.clearErrors();return this._addStop(a,b)})},updateStop:function(a,b){return this._enqueue(function(){this.clearErrors();return this._updateStop(a,b)})},clearErrors:function(){this.errors=[];this._errorNode&&(this._errorNode.innerHTML="")},getDirections:function(){return this._enqueue(this._getDirections)},unhighlightSegment:function(){this.get("map")&&
(this.get("map").graphics&&this.get("showSegmentHighlight"))&&(this.get("map").graphics.remove(this._segmentGraphic),this._segmentGraphic=null)},highlightSegment:function(a){"undefined"===typeof a&&(a=0);a=this.get("directions").features[a];var b=new O(a.geometry),c=b.getPoint(0,0),d=b.getPoint(0,1);S.getLength(c,d)||(b=c);this.unhighlightSegment();(this._segmentGraphic=new D(b,this.get("segmentSymbol"),a.attributes,this.get("segmentInfoTemplate")))&&this.get("map")&&this.get("map").graphics&&this.get("showSegmentHighlight")&&
this.get("map").graphics.add(this._segmentGraphic)},zoomToSegment:function(a){"undefined"===typeof a&&(a=0);if(this.get("map")){var b=this.get("directions").features[a],c=(new O(b.geometry)).getExtent(),c=this.get("map").setExtent(c,!0);c.then(e.hitch(this,function(){this._showSegmentPopup(b,a)}));return c.promise}return null},centerAtSegmentStart:function(a){"undefined"===typeof a&&(a=0);if(this.get("map")){var b=this.get("directions").features[a],c=b.geometry.getPoint(0,0);this.get("map").centerAt(c).then(e.hitch(this,
function(){this._showSegmentPopup(b,a)}))}},zoomToFullRoute:function(){return this.get("map")&&this.get("directions")?(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0)):null},setListIcons:function(){var a,b=this._dnd.getAllNodes();for(a=0;a<b.length;a++){var c=r("."+this._css.stopIconClass,b[a])[0];c&&(c.innerHTML=this._getLetter(a));h.remove(b[a],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+
" "+this._css.stopUnreachedFirstOrLastClass);c=this.stopGraphics&&this.stopGraphics[a]&&this.stopGraphics[a].attributes?this.stopGraphics[a].attributes.Status:void 0;c=0<c&&6>c;0===a?h.add(b[a],c?this._css.stopUnreachedFirstOrLastClass:this._css.stopOriginClass):a===b.length-1&&!this._startReturn?h.add(b[a],c?this._css.stopUnreachedFirstOrLastClass:this._css.stopDestinationClass):c&&h.add(b[a],this._css.stopUnreachedClass)}a=r("[data-reverse-td]",this._dndNode)[0];A.destroy(a);this.get("showReverseStopsButton")&&
A.create("td",{"data-reverse-td":"true",rowspan:b.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+w.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(a){a.stopPropagation()},onmouseout:function(a){a.stopPropagation()}},b[0])},addRouteSymbols:function(){if(this.stopGraphics.length&&this.get("map")&&this.get("map").graphics)for(var a=
0;a<this.stopGraphics.length;a++)if(this.stopGraphics[a]){this.get("map").graphics.add(this.stopGraphics[a]);var b=this.stopGraphics[a].getDojoShape();b&&b.moveToFront();this.get("map").graphics.add(this.textGraphics[a]);(b=this.textGraphics[a].getDojoShape())&&b.moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var a=this.get("stops"),b=0;b<a.length;b++){var c=a[b];if(c&&c.feature){var d=c.feature.attributes?c.feature.attributes.Status:void 0,e=this._setStopSymbol(b,a.length+
(this._startReturn?1:0),!1,d),g=this._defaultSR;this.get("map")&&(g=this.get("map").spatialReference);var g=new J(c.feature.geometry.x,c.feature.geometry.y,g),f=this._getLetter(b),f=new T(f,this.get("textSymbolFont"),this.get("textSymbolColor"));this.get("textSymbolOffset")&&f.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y);f=new D(g,f);f._textGraphic=!0;f._index=b;var h=c.feature.attributes,c=new D(g,e,{address:c.name,Status:d,SourceID:h&&h.SourceID?h.SourceID:null,SourceOID:h&&
h.SourceOID?h.SourceOID:null,PosAlong:h&&h.PosAlong?h.PosAlong:null,SideOfEdge:h&&h.SideOfEdge?h.SideOfEdge:null},this.get("stopsInfoTemplate"));c._drag=!0;c._index=b;this.stopGraphics[b]=c;this.textGraphics[b]=f}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this.addRouteSymbols();this.setListIcons()},setTravelMode:function(a){var b=new y,c=this.serviceDescription;if(c&&c.supportedTravelModes&&c.supportedTravelModes.length){for(var c=c.supportedTravelModes,
d=!1,e=!1,f=0;f<c.length;f++)if(c[f].name===a&&c[f]._nodeTravelMode&&c[f]._nodeImpedance){e=!0;if(d=this.travelModeName!==a)this.set("travelModeName",c[f].name),this.routeParams.travelMode=c[f].itemId,k.emit(c[f]._nodeTravelMode,"click",{bubbles:!1,cancelable:!0}),k.emit(c[f]._nodeImpedance,"click",{bubbles:!1,cancelable:!0});break}e?d?this._solveAndZoom().always(function(){b.resolve(a)}):b.resolve(a):b.reject(a);this._useTrafficNode&&(c=a===this._tmDrivingTime,this._useTrafficNode.disabled=!c,!c&&
this._useTrafficNode.checked&&this._removeTrafficLayer())}else b.reject(a);return b.promise},getSupportedTravelModeNames:function(){var a=[],b=this.serviceDescription;if(b&&b.supportedTravelModes&&b.supportedTravelModes.length)for(var b=b.supportedTravelModes,c=0;c<b.length;c++)a.push(b[c].name);return a},setDirectionsLengthUnits:function(){var a=1===arguments.length?arguments[0]:this.get("directionsLengthUnits"),b=new y;h.remove(this._useMilesNode,this._css.stopsPressedButtonClass);h.remove(this._useKilometersNode,
this._css.stopsPressedButtonClass);a===C.KILOMETERS?h.add(this._useKilometersNode,this._css.stopsPressedButtonClass):a===C.MILES&&h.add(this._useMilesNode,this._css.stopsPressedButtonClass);a===C.KILOMETERS||a===C.METERS||a===C.MILES||a===C.NAUTICAL_MILES?(this.directionsLengthUnits=a,this.autoSolve?this._getDirections().always(function(){b.resolve(a)}):b.resolve(a)):b.reject(a);return b.promise},setDirectionsLanguage:function(){var a=1===arguments.length?arguments[0]:this.get("directionsLanguage"),
b=new y,a=this._setDirectionsLanguageByLocale(a);this.autoSolve?this.getDirections().always(function(){b.resolve(a)}):b.resolve(a);return b.promise},useMyCurrentLocation:function(a){return this.geocoders[a]?this._createLocateButton(this.geocoders[a],!0,!0):!1},_getDirections:function(){this._removeEmptyStops();this.clearErrors();var a=new y;this._calculateValidStops()>=this.get("minStops")?(this.onDirectionsStart(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.get("stops")).then(e.hitch(this,
function(b){this.stops=b;this._setStops();var c=this._validateStops(b);c.error?(b=w.widgets.directions.error.locator,(c=this.get("geocoders")[c.index])&&(b=w.widgets.directions.error.unknownStop.replace("\x3cname\x3e",c.get("value"))),this._resultError(b),this.set("directions",null),this._clearRouteGraphics(),a.reject(b),this.onDirectionsFinish(Error([b]))):this._configureRoute().always(function(b){a.resolve(b)})}),e.hitch(this,function(b){this.set("directions",null);this._clearRouteGraphics();a.reject(b);
this.onDirectionsFinish()}))):(this.clearDirections(!0),this.createRouteSymbols(),a.reject(w.widgets.directions.error.notEnoughStops));return a.promise},_showLoadingSpinner:function(a){void 0===a&&(a=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()&&this.loaded);a?h.add(this._widgetContainer,this._css.resultsLoadingClass):h.remove(this._widgetContainer,this._css.resultsLoadingClass)},_enqueue:function(a){var b=new y;this._requestQueueTail||(this._requestQueueTail=new y,this._requestQueueTail.resolve());
this._requestQueueTail.promise.always(e.hitch(this,function(){try{var c=a.call(this);c&&"object"===typeof c&&c.hasOwnProperty("isFulfilled")?c.then(e.hitch(this,function(a){b.resolve(a);this._showLoadingSpinner()}),e.hitch(this,function(a){b.reject(a);this._showLoadingSpinner()})):(b.resolve(c),this._showLoadingSpinner())}catch(d){b.reject(d),this._showLoadingSpinner()}}));this._requestQueueTail=b;this._showLoadingSpinner();return b.promise},_createDnD:function(){this._dnd=new H(this._dndNode,{skipForm:!0,
withHandles:!0})},_destroyDnD:function(){A.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_usingAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setGeocoderOptions:function(){var a={theme:this.get("theme")};this.defaults.geocoderOptions.autoComplete||(a.maxLocations=1);var b={map:this.get("map")};this.geocoderOptions=e.mixin(a,this.defaults.geocoderOptions,b)},_setDefaultUnits:function(){if(this.get("directionsLengthUnits"))this.setDirectionsLengthUnits(this.directionsLengthUnits);
else{var a=C.KILOMETERS;this.defaults.directionsLengthUnits?a=this.defaults.directionsLengthUnits:this.defaults.directionsLanguage&&(a="en"===this.defaults.directionsLanguage?C.MILES:C.KILOMETERS);this.set("directionsLengthUnits",a)}},_setTrafficOptions:function(){this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&"esriNTSHistoricalAndLive"===this.serviceDescription.trafficSupport);this._usingAGOL()&&this.get("showTrafficOption")&&(this.get("trafficLayer")||
this.set("trafficLayer",new M(location.protocol+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:0.4})));this._optionsMenu()},_updateCanModifyStops:function(){this.get("canModifyStops")?this._showAddDestination():this._hideAddDestination()},_setWidgetProperties:function(){this._stopsReady=!1;this._disconnectEvents();this.set("loaded",!1);this.set("map",this.defaults.map);this.set("alphabet",this.defaults.alphabet);this.set("directions",this.defaults.directions);this.set("directionsLanguage",
this.defaults.directionsLanguage);this.set("routeTaskUrl",this.defaults.routeTaskUrl);this.set("printTaskUrl",this.defaults.printTaskUrl);this.set("geometryTaskUrl",this.defaults.geometryTaskUrl);this.set("stops",[]);this.set("textSymbolFont",this.defaults.textSymbolFont);this.set("textSymbolColor",this.defaults.textSymbolColor);this.set("textSymbolOffset",this.defaults.textSymbolOffset);this.set("fromSymbol",this.defaults.fromSymbol);this.set("fromSymbolDrag",this.defaults.fromSymbolDrag);this.set("stopSymbol",
this.defaults.stopSymbol);this.set("stopSymbolDrag",this.defaults.stopSymbolDrag);this.set("toSymbol",this.defaults.toSymbol);this.set("toSymbolDrag",this.defaults.toSymbolDrag);this.set("unreachedSymbol",this.defaults.unreachedSymbol);this.set("unreachedSymbolDrag",this.defaults.unreachedSymbolDrag);this.set("routeSymbol",this.defaults.routeSymbol);this.set("segmentSymbol",this.defaults.segmentSymbol);this.set("showPrintPage",this.defaults.showPrintPage);this.set("showSegmentPopup",this.defaults.showSegmentPopup);
this.set("showSegmentHighlight",this.defaults.showSegmentHighlight);this.set("autoCenterAtSegmentStart",this.defaults.autoCenterAtSegmentStart);this.set("showReverseStopsButton",this.defaults.showReverseStopsButton);this.set("focusOnNewStop",this.defaults.focusOnNewStop);this.set("dragging",this.defaults.dragging);this.set("canModifyStops",this.defaults.canModifyStops);this.set("theme",this.defaults.theme);this.set("showReturnToStartOption",this.defaults.showReturnToStartOption);this.set("showOptimalRouteOption",
this.defaults.showOptimalRouteOption);this.set("optimalRoute",this.defaults.optimalRoute);this.set("returnToStart",this.defaults.returnToStart);this.set("traffic",this.defaults.traffic);this.set("trafficLayer",this.defaults.trafficLayer);this.set("minStops",this.defaults.minStops);this.set("maxStops",this.defaults.maxStops);this.set("printPage",this.defaults.printPage);this.set("autoSolve",this.defaults.autoSolve);this.set("directionsLengthUnits",this.defaults.directionsLengthUnits);this.set("directionsLanguage",
this.defaults.directionsLanguage);this.set("stopsInfoTemplate",this.defaults.stopsInfoTemplate);this.set("segmentInfoTemplate",this.defaults.segmentInfoTemplate);this.set("geocoders",[]);this.set("showTravelModesOption",this.defaults.showTravelModesOption);this.set("showMilesKilometersOption",this.defaults.showMilesKilometersOption);this.set("showClearButton",this.defaults.showClearButton);this.set("showActivateButton",this.defaults.showActivateButton);this._defaultSR=new I(4326);this._updateCanModifyStops()},
_setStopsAttr:function(a){this._stopsReady?(a||(a=[]),this._updateStops(a),this._setStops()):this._set("stops",a)},_updateStops:function(a){this.stops||(this.stops=[]);a||(a=[]);var b=this.stops.length;return a&&a.length?this._getCandidates(a).then(e.hitch(this,function(a){var c=a.length,d=0,d=0;if(c===b)for(d=0;d<c;d++)this._updateStopInsert(a[d],d);else if(c>b){if(b)for(d;d<b;d++)this._updateStopInsert(a[d],d);for(d;d<c;d++)this._insertStop(a[d],d)}else{for(var e=b-c,d=0;d<e;d++)this._removeStop();
for(d=0;d<c;d++)this._updateStopInsert(a[d],d)}this._setStops()})):this._init()},_removeStop:function(a){var b=new y,c;if(this.stops.length>this.get("minStops")){"undefined"===typeof a&&(a=this.stops.length-1);c=this.stops.splice(a,1);this._setStops();var d=this._dnd.getAllNodes()[a],e=this.get("geocoders");e[a].destroy();e.splice(a,1);this.set("geocoders",e);this._geocoderSelectEvents[d.id].remove();this._geocoderFindEvents[d.id].remove();this._geocoderWatchEvents[d.id].unwatch();A.destroy(d);this._dnd.sync();
this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()}else if(0<=a){c=this.stops.splice(a,1);for(d=a;d<this.get("minStops")-1;d++)this.geocoders[d].set("value",this.geocoders[d+1].get("value"));this.geocoders[d].set("value","")}this._solveAndZoom().always(function(){b.resolve(c,a)});return b.promise},_removeTrafficLayer:function(){var a=this.get("trafficLayer"),b=this.get("map");a&&b&&b.removeLayer(a);this._trafficLayerAdded=!1},_addStops:function(a,
b){for(var c=new y,d=[],e=0;e<Math.min(a.length,this.maxStops-this.stopGraphics.length);e++){var f=new y;this._addStop(a[e],void 0===b?b:b+e).always(f.resolve);d.push(f)}E(d).then(c.resolve);return c.promise},_addStop:function(a,b){var c=new y;this._checkMaxStops();this.maxStopsReached?(this._resultError(w.widgets.directions.error.maximumStops),c.reject(w.widgets.directions.error.maximumStops)):this._getCandidate(a).then(e.hitch(this,function(a){b=this._insertStop(a,b);this._setStops();c.resolve(a,
b)}),e.hitch(this,function(a){c.reject(a)}));return c.promise},_removeEmptyStops:function(){if(this.stops.length>this.get("minStops"))for(var a=this.stops.length-1;this.stops.length>this.get("minStops")&&-1<a;a--){var b=this.stops[a];(!b||!b.name)&&this._removeStop(a)}},_setReverseGeocode:function(a,b,c){if(a.feature.geometry&&-1<c){var d={address:a.name};this.stopGraphics[c]&&(this.stopGraphics[c].setAttributes(d),this.stopGraphics[c].setGeometry(b));this.textGraphics[c]&&(this.textGraphics[c].setAttributes(d),
this.textGraphics[c].setGeometry(b));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._moveInProgress||this._unsetDraggableObject(this._dragGraphic);this.get("geocoders")[c]&&this.get("geocoders")[c].set("value",a.name);this.stops[c]=a;this.stops[c].feature.setGeometry(b);this._setStops();this.get("autoSolve")&&this.getDirections()}},_insertStop:function(a,b){var c,d;if(void 0===b)for(c=0;c<this.geocoders.length;c++){if(!this.geocoders[c].get("value")){d=
this.geocoders[c];break}}else c=b,this.geocoders[c]&&!this.geocoders[c].get("value")&&(d=this.geocoders[c]);d&&(void 0===b||b===c)?(d.set("value",a.name),this.stops[c]=a,d[this._stopReference]=a):(void 0===b&&(b=this.geocoders.length),this._createGeocoder(a,b))},_createGeocoder:function(a,b){var c=this._dnd.getAllNodes(),d=!1,f=!1,g=c.length;c[b]?(f=c[b],d=!0):d=f=!1;var k=e.hitch(this,function(a,b){var c=b?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,d=b?this._css.stopDnDHandleClassHidden:
this._css.stopDnDHandleClass;h.replace(a.children[0],c,d);2<this.geocoders.length&&(c=b?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,d=b?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,h.replace(a.children[3].children[0],c,d))}),l=A.create("tr",{className:this._css.stopClass,onmouseover:function(){k(this,!0)},onmouseout:function(){k(this,!1)}});A.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},l);c=A.create("td",{className:this._css.stopIconColumnClass},
l);A.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(g),"data-center-at":"true"},c);g=A.create("td",{className:this._css.esriStopGeocoderColumnClass},l);g=A.create("div",{},g);this.get("canModifyStops")&&(c=A.create("td",{className:this._css.stopIconRemoveColumnClass},l),A.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},c));this._dnd.insertNodes(!1,[l],d,f);this.stops.splice(b,0,a);d=e.mixin({},this.get("geocoderOptions"),
{value:a.name});d=new x(d,g);d[this._sortId]=l.id;d[this._stopReference]=a;f=this.get("geocoders");f.splice(b,0,d);d.startup();this.set("geocoders",f);f=e.hitch(this,function(a){if(a&&(a.results||a.result)){var b=this._dnd.getAllNodes(),b=u.indexOf(b,l),c=!0;a.results&&a.results.results&&a.results.results.length?(this._setStops(),this.stops[b]=a.results.results[0]):a.result?(this._setStops(),this.stops[b]=a.result):(this._removeStopButton(b),this.set("directions",null),this._resultError(w.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
a.target.get("value"))),this._clearRouteGraphics(),c=!1);c&&this._solveAndZoom()}});g=d.on("select",f);this._geocoderSelectEvents[l.id]=g;f=d.on("find-results",f);this._geocoderFindEvents[l.id]=f;f=d.watch("value",e.hitch(this,function(a,b,c){a=this._dnd.getAllNodes();a=u.indexOf(a,l);this.stops[a]&&c!==this.stops[a].name&&(this.stops[a]={name:c},this._setStops())}));this._geocoderWatchEvents[l.id]=f;this._checkMaxStops();this.setListIcons();this.get("focusOnNewStop")&&d.focus();this._stopsRemovable();
this._optionsMenu();this._sortGeocoders()},_removeLocateButtonVisibilityEvents:function(){for(var a=0;a<this.geocoders.length;a++){var b=this.geocoders[a];b._onMouseEnter&&b._onMouseEnter.remove();b._onMouseOut&&b._onMouseOut.remove();b._onKeyPress&&b._onKeyPress.remove();b._locateButton&&(b._locateButton._onMouseEnter&&b._locateButton._onMouseEnter.remove(),b._locateButton._onMouseOut&&b._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();
for(var a=this,c=0;c<this.geocoders.length;c++){var d=this.geocoders[c];d.inputNode._geocoder=d;d._onMouseEnter=k(d.inputNode,[b.enter,"focus"],function(b){b instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;a._createLocateButton(this._geocoder,!0)});d._onMouseOut=k(d.inputNode,[b.leave,"blur"],function(b){b instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(e.hitch(this,function(){!this._geocoder._lbShown_lb&&
!this._geocoder._lbShown_f&&a._destroyLocateButton(this._locateButton)}),400)});d._onKeyPress=k(d.inputNode,"keydown",function(b){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(e.hitch(this,function(){""===this.value?a._createLocateButton(this._geocoder,!0):a._destroyLocateButton(this._locateButton)}),400)});d.inputNode._locateButton&&(d=d.inputNode._locateButton,d._onMouseEnter=k(d.domNode,b.enter,function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)}),
d._onMouseOut=k(d.domNode,b.leave,function(){this._geocoder._lbShown_lb=!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(e.hitch(this,function(){!this._geocoder._lbShown_g&&!this._geocoder._lbShown_f&&a._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)}))}},_createLocateButton:function(a,b,c){var d=new y;f(["./LocateButton"],e.hitch(this,function(f){this._destroyLocateButton(a.inputNode._locateButton);if(a){var g=A.create("div",{},a.domNode);
h.add(a.domNode,this._css.stopsInnerGeocoderClass);var l=new f({map:this.map,highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},g);l.startup();a.inputNode._locateButton=l;l.domNode._geocoder=a;this._setLocateButtonVisibilityEvents();f=e.hitch(this,function(){l._locating=!0;a.set("value","");a.inputNode.placeholder=w.widgets.directions.retrievingMyLocation.toUpperCase()});l._onBeforeLocate=k(l._locateNode,s,f);l._onLocate=k(l,"locate",e.hitch(this,function(c){l._locating=!1;c.graphic?(b&&
this._destroyLocateButton(a.inputNode._locateButton),this.updateStop(new D(c.graphic.geometry),u.indexOf(this.geocoders,a)).then(e.hitch(this,function(){1<this.stopGraphics.length?this._solveAndZoom().then(function(){d.resolve(c)}):d.resolve(c)}))):(a.set("value",""),a.inputNode.placeholder=w.widgets.directions.myLocationError.toUpperCase(),console.error(c.error),d.reject(c.error))}));c?(f(),l.locate()):d.resolve()}else d.reject()}));return d.promise},_destroyLocateButton:function(a){if(a){var b=
a.domNode._geocoder;clearTimeout(b._destroyTimeout);a._locating?b._destroyTimeout=setTimeout(e.hitch(this,function(){!b._lbShown_lb&&!b._lbShown_f&&this._destroyLocateButton(a)}),100):(a.clear(),a._onBeforeLocate.remove(),a._onLocate.remove(),a._onMouseEnter&&a._onMouseEnter.remove(),a._onMouseOut&&a._onMouseOut.remove(),a.destroy(),b.inputNode&&(b.inputNode._locateButton=null,b.inputNode.placeholder=""))}},_validateStops:function(a){if(a)for(var b=0;b<a.length;b++)if(!a[b]||!a[b].feature)return{error:!0,
index:b};return{error:!1}},_sortStops:function(){this.stops.length&&(this.stops.sort(e.hitch(this,function(a,b){for(var c,d,e=0;e<this.get("geocoders").length;e++)this.geocoders[e][this._stopReference]===a?c=e:this.geocoders[e][this._stopReference]===b&&(d=e);return c>d?1:d>c?-1:0})),this._setStops())},_getCandidate:function(a){var b=new y,c=typeof a,d={name:""};a?"object"===c&&a.hasOwnProperty("feature")&&a.hasOwnProperty("name")?b.resolve(a):"object"===c&&a.hasOwnProperty("address")&&a.hasOwnProperty("location")?
(c=this._globalGeocoder._hydrateResult(a),b.resolve(c)):"object"===c&&a.hasOwnProperty("name")&&!a.name?b.resolve(d):("object"===c&&a.hasOwnProperty("name")&&(a=a.name),this._globalGeocoder?this._globalGeocoder.find(a).then(e.hitch(this,function(c){c.results&&c.results.length?a.geometry&&!isNaN(a.geometry.x)&&!isNaN(a.geometry.y)&&this.map.spatialReference.wkid===a.geometry.spatialReference.wkid?(c.results[0].feature.geometry=a.geometry,b.resolve(c.results[0])):!c.results[0].feature.geometry||isNaN(c.results[0].feature.geometry.x)||
isNaN(c.results[0].feature.geometry.y)?(this._resultError(w.widgets.directions.error.locator),b.reject(w.widgets.directions.error.locator)):b.resolve(c.results[0]):(this._resultError(w.widgets.directions.error.locator),b.reject(w.widgets.directions.error.locator))}),e.hitch(this,function(){this._decorateUngeocodedStop(a).then(b.resolve,b.reject)})):(this._resultError(w.widgets.directions.error.locatorUndefined),b.reject(w.widgets.directions.error.locatorUndefined))):b.resolve(d);return b.promise},
_updateStopInsert:function(a,b){this.get("geocoders")[b]&&(this.get("geocoders")[b].set("value",a.name),this.stops[b]=a,this._setStops())},_updateStop:function(a,b){var c=new y;this.stops?("undefined"===typeof b&&(b=this.stops.length-1),this._getCandidate(a).then(e.hitch(this,function(a){this._updateStopInsert(a,b);c.resolve(a)}),e.hitch(this,function(a){c.reject(a)}))):c.reject("could not update stop");return c.promise},_renderDirections:function(){var a=this.get("directions"),c="";if(this._resultsNode){c+=
'\x3cdiv class\x3d"'+this._css.resultsRouteNameClass+'"\x3e';c+=a.routeName;c+="\x3c/div\x3e";c+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';if(a.totalLength||a.totalTime){var d=this._formatDistance(a.totalLength,w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].name),f=this._formatTime(a.totalTime),c=c+('\x3cdiv class\x3d"'+this._css.resultsSummaryClass+'"\x3e');d&&(c+=d);d&&f&&(c+=" \x26middot; ");f&&(c+=f);c+="\x3c/div\x3e"}c+='\x3cdiv class\x3d"'+
this._css.clearClass+'"\x3e\x3c/div\x3e';c+='\x3cdiv class\x3d"'+this._css.resultsRouteButtonContainerClass+'"\x3e';c+='\x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"'+this._css.linkButtonClass+" "+this._css.resultsViewFullRouteClass+'" data-full-route\x3d"true"\x3e'+w.widgets.directions.viewFullRoute+"\x3c/div\x3e";this.get("showPrintPage")&&(c+='\x3cdiv tabindex\x3d"0" role\x3d"button" title\x3d"'+w.widgets.directions.print+'" class\x3d"'+this._css.resultsPrintClass+'" data-print-directions\x3d"true"\x3e\x3c/div\x3e');
var c=c+('\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e'),c=c+"\x3c/div\x3e",c=c+('\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e'),c=c+('\x3ctable summary\x3d"'+a.routeName+'"\x3e'),c=c+'\x3ctbody role\x3d"menu"\x3e',h=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d].feature.attributes;if(e&&e.Sequence===b)return 0===e.Status||6===e.Status?b:h(a,b+1)}return c?1:h(a,1,!0)},m=h(this.stops,1);u.forEach(a.features,e.hitch(this,function(b,d){var e=this._css.routeClass;b.attributes&&
(b.attributes.step=d+1);b.attributes.maneuverType&&(e+=" "+b.attributes.maneuverType);0===d&&1===m?e+=" "+this._css.routeOriginClass:d===a.features.length-1&&(e+=" "+this._css.routeDestinationClass);d===a.features.length-1&&(e+=" "+this._css.routeLastClass);c+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+e+" "+this._css.routeZoomClass+'" data-segment\x3d"'+d+'"\x3e';c+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';"esriDMTDepart"===
b.attributes.maneuverType?(m=h(this.stops,m),c+=this._getLetter(m-1),m++):"esriDMTStop"===b.attributes.maneuverType&&(m=h(this.stops,m),c+=this._getLetter(m-1));c+="\x3c/div\x3e";c+="\x3c/td\x3e";c+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';var e=a.strings[d],f;if(e){var g=b.attributes.text;for(f=0;f<e.length;f++)g=this._boldText(g,e[f].string);b.attributes.formattedText=
g}else b.attributes.formattedText=b.attributes.text;c+="\x3cstrong\x3e"+z.format(b.attributes.step)+".\x3c/strong\x3e "+b.attributes.formattedText;c+="\x3c/div\x3e";e=this._formatDistance(b.attributes.length,w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].abbr);f=this._formatTime(b.attributes.time);e&&(c+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',c+=e,f&&(c+=" "+f),c+="\x3c/div\x3e");c+="\x3c/div\x3e";c+="\x3c/td\x3e";c+="\x3c/tr\x3e"}));c+="\x3c/tbody\x3e";
c+="\x3c/table\x3e";c+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=c);this._disconnectResults();(d=r("[data-segment]",this._resultsNode))&&d.length&&u.forEach(d,e.hitch(this,function(c){var d=k(c,b.enter,e.hitch(this,function(){var b=parseInt(l.get(c,"data-segment"),10);this.highlightSegment(b);this.onSegmentHighlight(a.features[b])}));this._resultEvents.push(d);d=k(c,"focusin",e.hitch(this,function(){var b=parseInt(l.get(c,"data-segment"),10);this.highlightSegment(b);this.onSegmentHighlight(a.features[b])}));
this._resultEvents.push(d);d=k(c,"focusout",e.hitch(this,function(){this.unhighlightSegment()}));this._resultEvents.push(d);d=k(c,b.leave,e.hitch(this,function(){this.unhighlightSegment()}));this._resultEvents.push(d);this.get("autoCenterAtSegmentStart")&&(d=k(c,"click, keydown",e.hitch(this,function(b){if(b&&("click"===b.type||"keydown"===b.type&&b.keyCode===g.ENTER))b=parseInt(l.get(c,"data-segment"),10),this.centerAtSegmentStart(b),this.onSegmentSelect(a.features[b])})),this._resultEvents.push(d))}))}},
_showRoute:function(a){if(!this._moveInProgress){this.editToolbar.deactivate();this._clearDisplayAfterSolve();this.set("solveResult",a);var b=a.routeResults[0].directions;this.set("directions",b);var c=a.routeResults[0].stops;if(c&&c.length){var d=[],f,g=c.length;this._startReturn&&g--;for(f=0;f<g;f++){var h=c[f],h={extent:new K({xmin:h.geometry.x-0.25,ymin:h.geometry.y-0.25,xmax:h.geometry.x+0.25,ymax:h.geometry.y+0.25,spatialReference:h.geometry.spatialReference}),feature:h,name:h.attributes.Name};
d.push(h)}this.stops=d;for(f=0;f<this.stops.length;f++)this._updateStop(this.stops[f],f);this._setStops()}this.set("mergedRouteGraphic",new D(b.mergedGeometry,this.get("routeSymbol")));if(this.get("map")&&this.get("map").graphics){var k=[];u.forEach(b.features,e.hitch(this,function(a){a.setSymbol(this.get("routeSymbol"));this.get("map").graphics.add(a);k.push(a);(a=a.getDojoShape())&&a.moveToBack()}));this.set("displayedRouteGraphics",k)}this.createRouteSymbols();this._renderDirections();this.onDirectionsFinish(a)}},
_setGeocodersStopReference:function(){if(this.geocoders)for(var a=0;a<this.geocoders.length;a++)this.geocoders[a]&&this.stops[a]&&(this.geocoders[a][this._stopReference]=this.stops[a])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(a){var b=[];if(a&&a.length){for(var c=0;c<a.length;c++)b.push(this._getCandidate(a[c]));return E(b)}a=new y;a.resolve([]);return a.promise},_clearResultsHTML:function(){this._resultsNode&&
(this._resultsNode.innerHTML="")},_showSegmentPopup:function(a){if(a&&this.get("showSegmentPopup")&&this.get("map")&&this.get("map").infoWindow){var b=a.geometry.getPoint(0,0);a=new D(b,null,a.attributes,this.get("segmentInfoTemplate"));this.get("map").infoWindow.setFeatures([a]);this.get("map").infoWindow.show(b)}},_removeStopButton:function(a){this.stops.length>this.get("minStops")?this.removeStop(a):(this._setStops(),this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve())},_addStopButton:function(){this.addStop(void 0,
this.stops.length)},_sortGeocoders:function(){var a=this._dnd.getAllNodes();this.geocoders.sort(e.hitch(this,function(b,c){return this._sortGeocodersToNodes(b,c,a,this._sortId)}));this._sortStops();for(var b=0;b<this.geocoders.length;b++)this.geocoders[b].inputNode.title=w.widgets.directions.stopNoTitle+(b+1);this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var a=0;a<this._resultEvents.length;a++)this._resultEvents[a]&&this._resultEvents[a].remove();
this._resultEvents=[]},_formatTime:function(a){var b,c="";b=Math.round(a);a=Math.floor(b/60);b=Math.floor(b%60);a&&(c+=a+" ",c=1<a?c+w.widgets.directions.time.hours:c+w.widgets.directions.time.hour);a&&b&&(c+=" ");b&&(c+=b+" ",c=1<b?c+w.widgets.directions.time.minutes:c+w.widgets.directions.time.minute);return c},_formatDistance:function(a,b){var c=Math.round(100*a)/100;return 0===c?"":z.format(c)+" "+b},_setMoveSymbol:function(a){this._moveSymbolSet=!0;var b=this._setStopSymbol(a._index,this.stopGraphics.length,
!0,a.attributes.Status);a.setSymbol(b)},_unsetMoveSymbol:function(a){var b=this._setStopSymbol(a._index,this.stopGraphics.length,!1,a.attributes.Status);a.setSymbol(b);this._moveSymbolSet=!1},_removeTextGraphic:function(a){a=this.textGraphics[a];this.get("map").graphics.remove(a)},_setDraggableObject:function(a){a._drag&&(this.get("map")&&this.get("map").graphics)&&(this.get("map")._directionsWidgetDragging=!0,this._removeTextGraphic(a._index),this._dragGraphic=a,this._dragGeometry=a.geometry,this.editToolbar.activate(R.MOVE,
a))},_setTextGraphic:function(a){if(a._drag&&this.get("map")&&this.get("map").graphics){var b=this.textGraphics[a._index];b.setGeometry(a.geometry);this.get("map").graphics.add(b);(a=b.getDojoShape())&&a.moveToFront()}},_unsetDraggableObject:function(a){a._drag&&(this.get("map")._directionsWidgetDragging=!1,this._moveSymbolSet&&this._unsetMoveSymbol(a),this._setTextGraphic(a),this.editToolbar.deactivate())},_isMyStopGraphic:function(a){return-1<u.indexOf(this.get("stopGraphics"),a)||-1<u.indexOf(this.get("textGraphics"),
a)},_editToolbar:function(){this.get("map")?this.set("editToolbar",new R(this.get("map"))):this.set("editToolbar",null)},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var a=new y;this._globalGeocoder=new x(this.get("geocoderOptions"),A.create("div"));k.once(this._globalGeocoder,"load",e.hitch(this,function(){a.resolve()},function(b){a.reject(b)}));this._globalGeocoder.startup();return a.promise},
_init:function(){var a=new y;this.set("loaded",!1);if(this.get("map"))if(this.get("map").loaded)this._configure().always(a.resolve);else k.once(this.get("map"),"load",e.hitch(this,function(){this._configure().always(a.resolve)}));else this._configure().always(a.resolve);return a.promise},_setDefaultStops:function(){var a=new y;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(e.hitch(this,function(){this.get("focusOnNewStop")&&(this.get("geocoders")&&this.get("geocoders").length)&&
this.get("geocoders")[0].focus();this._removeEmptyStops();a.resolve()}),a.reject):a.resolve();return a.promise},_configure:function(){var a=new y;this._createDnD();this._setGeocoderOptions();this._createGlobalGeocoder().then(e.hitch(this,function(){this._editToolbar();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();var b=[this._createRouteTask(),this._setDefaultStops()];E(b).then(e.hitch(this,function(){this._setDefaultUnits();
this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();this._setDirectionsLanguageByLocale(!this.directionsLanguage?t.locale.toLowerCase():this.directionsLanguage);this._stopsReady=!0;this.set("loaded",!0);this.onLoad();a.resolve(!0)}),function(b){a.reject(b)})}),function(b){a.reject(b)});return a.promise},_setDirectionsLanguageByLocale:function(a){var b=this.serviceDescription.directionsSupportedLanguages,c=function(a){if(b)for(var c=0;c<b.length;c++)if(b[c].toLowerCase().substr(0,
2)===a)return b[c];return null},d=c(a);d||(a=a.substr(0,2),d=c(a));this.directionsLanguage=d;return this.routeParams.directionsLanguage=d},_calculateValidStops:function(){for(var a=0,b=this.stops,c=0;c<b.length;c++)b[c]&&b[c].name&&a++;return a},_setStopSymbol:function(a,b,c,d){return void 0===d||0===d||6===d?0===a?this.get(c?"fromSymbolDrag":"fromSymbol"):a===b-1?this.get(c?"toSymbolDrag":"toSymbol"):this.get(c?"stopSymbolDrag":"stopSymbol"):this.get(c?"unreachedSymbolDrag":"unreachedSymbol")},_addTrafficLayer:function(){var a=
this.get("trafficLayer"),b=this.get("map");b&&(a&&!this._trafficLayerAdded)&&(b.addLayer(a),a.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(a){a.target===this._useMilesNode?this.setDirectionsLengthUnits(C.MILES):a.target===this._useKilometersNode&&this.setDirectionsLengthUnits(C.KILOMETERS)},_toggleTravelModeImpedance:function(a){h.add(a.target,this._css.stopsPressedButtonClass);a.target===this._useTravelModeTimeNode?h.remove(this._useTravelModeDistanceNode,this._css.stopsPressedButtonClass):
a.target===this._useTravelModeDistanceNode&&h.remove(this._useTravelModeTimeNode,this._css.stopsPressedButtonClass);this._travelModeImpedanceKey=a.target.attributes["travel-mode-key"].value;this.setTravelMode(this._travelModeKey+" "+this._travelModeImpedanceKey)},_toggleTravelMode:function(a){h.add(a.target,this._css.stopsPressedButtonClass);a.target===this._useTravelModeCarNode?(h.remove(this._useTravelModeTruckNode,this._css.stopsPressedButtonClass),h.remove(this._useTravelModeWalkingNode,this._css.stopsPressedButtonClass)):
a.target===this._useTravelModeTruckNode?(h.remove(this._useTravelModeCarNode,this._css.stopsPressedButtonClass),h.remove(this._useTravelModeWalkingNode,this._css.stopsPressedButtonClass)):a.target===this._useTravelModeWalkingNode&&(h.remove(this._useTravelModeCarNode,this._css.stopsPressedButtonClass),h.remove(this._useTravelModeTruckNode,this._css.stopsPressedButtonClass));this._travelModeKey=a.target.attributes["travel-mode-key"].value;this.setTravelMode(this._travelModeKey+" "+this._travelModeImpedanceKey)},
_toggleCheckbox:function(a){var b=l.get(a.target,"checked");a.target===this._findOptimalOrderNode?this.set("optimalRoute",b):a.target===this._useTrafficNode?this.set("traffic",b):a.target===this._returnToStartNode&&this.set("returnToStart",b)},_configureRouteOptions:function(){var a=this.get("routeParams");this.get("directionsLengthUnits")?a.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",a.directionsLengthUnits);a.findBestSequence=this.get("optimalRoute");
a.returnStops=!0;this.get("traffic")?(a.startTime=new Date,a.startTimeIsUTC=!0,this._addTrafficLayer()):(a.startTime=null,a.startTimeIsUTC=null,this._removeTrafficLayer());if(this.get("returnToStart")&&this.stopGraphics.length){var b=new D(this.stopGraphics[0].geometry,null,this.stopGraphics[0].attributes),c=this.stopGraphics.slice(0);this._startReturn=b;c.push(b);a.stops.features=c}else this._startReturn=null,a.stops.features=this.stopGraphics;this.set("routeParams",a)},_configureRoute:function(){var a=
new y;this.createRouteSymbols();this._configureRouteOptions();this.routeTask.solve(this.routeParams,e.hitch(this,function(b){this._showRoute(b);a.resolve(b)}),e.hitch(this,function(b){for(var c=0;c<this.stops.length;c++)this.stops[c].feature.attributes=e.mixin(this.stops[c].feature.attributes,{Status:5});this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(b);a.reject(b)}));return a.promise},_boldText:function(a,b){return a.replace(RegExp("(^|\\s)("+
b+")(\\s|$)","ig"),"$1\x3cstrong\x3e$2\x3c/strong\x3e$3")},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length&&this.get("map")&&this.get("map").graphics)for(var a=0;a<this.stopGraphics.length;a++)this.get("map").graphics.remove(this.stopGraphics[a]),this.get("map").graphics.remove(this.textGraphics[a]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_clearRouteGraphics:function(){var a=this.get("displayedRouteGraphics"),b=this.get("map");a&&(a.length&&b&&b.graphics)&&
(u.forEach(a,function(a){b.graphics.remove(a)}),this.set("displayedRouteGraphics",[]));this.unhighlightSegment()},_clearInfoWindow:function(){this.get("map")&&this.get("map").infoWindow&&(this.get("map").infoWindow.hide(),this.get("map").infoWindow.features&&this.get("map").infoWindow.clearFeatures())},_clearDisplayBeforeSolve:function(){this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this.clearErrors()},_getLetter:function(a){var b=
this.get("alphabet"),c="";b&&b.length&&(a=a||0,a>=b.length&&(c=this._getLetter(Math.floor(a/this.alphabet.length)-1),a%=this.alphabet.length),"string"===typeof b?c+=b.substr(a,1):b instanceof Array&&(c+=b[a]));return c},_solveAndZoom:function(){if(this.get("autoSolve"))return this.getDirections().then(e.hitch(this,function(){this.zoomToFullRoute()}));var a=new y;a.resolve();return a.promise},_setupEvents:function(){var a=k(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",e.hitch(this,
function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===g.ENTER)&&this._reverseStops()}));this._onEvents.push(a);a=k(this._resultsNode,"[data-print-directions]:click, [data-print-directions]:keydown",e.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===g.ENTER)&&this._printDirections()}));this._onEvents.push(a);a=k(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",e.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===
g.ENTER)&&this.zoomToFullRoute()}));this._onEvents.push(a);a=k(this._dndNode,"[data-remove]:click, [data-remove]:keydown",e.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===g.ENTER)){var b=r("[data-remove]",this._dndNode);a=u.indexOf(b,a.target);this._removeStopButton(a)}}));this._onEvents.push(a);this._onEvents.push(k(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",e.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===g.ENTER)){var b=
r("[data-center-at]",this._dndNode);a=u.indexOf(b,a.target);this.stops[a]&&(this.stops[a].feature&&this.stops[a].feature.geometry)&&this.map.centerAndZoom(this.stops[a].feature.geometry)}})));a=k(this._dnd,"Drop",e.hitch(this,function(){this._dnd.sync();this._sortGeocoders();this.setListIcons();this._calculateValidStops()===this.get("geocoders").length&&this.get("routeParams").stops.features.length&&this._solveAndZoom()}));this._onEvents.push(a);a=k(this._dnd,"DndStart",e.hitch(this,function(){var a=
r("body")[0];h.add(a,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()}));this._onEvents.push(a);a=k(this._dnd,"DndDrop, DndCancel",e.hitch(this,function(){var a=r("body")[0];h.remove(a,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()}));this._onEvents.push(a);this.get("map")&&this.get("map").graphics&&(a=this.get("map").graphics.on("mouse-over",e.hitch(this,function(a){if(this.get("dragging")&&!this.get("map")._directionsWidgetDragging){var b;this._isMyStopGraphic(a.graphic)&&
(a.graphic._drag?(b=this.editToolbar.getCurrentState(),b.graphic||this._setDraggableObject(a.graphic),this._moveSymbolSet||this._setMoveSymbol(a.graphic)):a.graphic._textGraphic&&(b=this.editToolbar.getCurrentState(),this.stopGraphics[a.graphic._index]&&(b.graphic||this._setDraggableObject(this.stopGraphics[a.graphic._index]),this._moveSymbolSet||this._setMoveSymbol(this.stopGraphics[a.graphic._index]))))}})),this._onEvents.push(a),a=this.get("map").graphics.on("mouse-out",e.hitch(this,function(a){this.get("dragging")&&
this._isMyStopGraphic(a.graphic)&&!this._moveInProgress&&a.graphic._drag&&this._unsetDraggableObject(a.graphic)})),this._onEvents.push(a),this._editToolbarEvents());a=this.watch("theme",this._updateThemeWatch);this._watchEvents.push(a);a=this.watch("canModifyStops",this._updateCanModifyStops);this._watchEvents.push(a);a=this.watch("showReturnToStartOption",this._optionsMenu);this._watchEvents.push(a);a=this.watch("showOptimalRouteOption",this._optionsMenu);this._watchEvents.push(a);a=this.watch("returnToStart",
this._setMenuNodeValues);this._watchEvents.push(a);a=this.watch("optimalRoute",this._setMenuNodeValues);this._watchEvents.push(a);a=this.watch("routeTaskUrl",e.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()}));this._watchEvents.push(a);this._watchEvents.push(this.watch("printTaskUrl",e.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",e.hitch(this,function(){this._createGeometryTask()})));a=this.watch("routeParams",e.hitch(this,
function(){this._createRouteParams();this._setDefaultUnits()}));this._watchEvents.push(a);a=this.watch("geocoderOptions",e.hitch(this,function(){this._setGeocoderOptions();this._createGlobalGeocoder()}));this._watchEvents.push(a);a=this.watch("showReverseStopsButton",this.setListIcons);this._watchEvents.push(a);a=this.watch("showPrintPage",this._renderDirections);this._watchEvents.push(a);a=this.watch("trafficLayer",this._trafficLayerUpdate);this._watchEvents.push(a);a=this.watch("editToolbar",this._editToolbarEvents);
this._watchEvents.push(a);a=this.watch("showTravelModesOption",this._showTravelModesOption);this._watchEvents.push(a);a=this.watch("showMilesKilometersOption",this._showMilesKilometersOption);this._watchEvents.push(a);a=this.watch("showClearButton",this._showClearButton);this._watchEvents.push(a);a=this.watch("directionsLengthUnits",this.setDirectionsLengthUnits);this._watchEvents.push(a);this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",
this._activate));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton))},_editToolbarEvents:function(){var a=k(this.editToolbar,"graphic-click",e.hitch(this,function(a){this.get("map")&&this.get("map").infoWindow&&(this.get("map").infoWindow.setFeatures([a.graphic]),this.get("map").infoWindow.show(a.graphic.geometry))}));this._onEvents.push(a);a=k(this.editToolbar,"graphic-first-move",e.hitch(this,function(){this._moveInProgress=!0}));this._onEvents.push(a);a=k(this.editToolbar,
"graphic-move-stop",e.hitch(this,function(a){this._moveInProgress=!1;this._unsetDraggableObject(a.graphic);if(this._dragGeometry!==a.graphic.geometry){this._currentEditableGraphic=a.graphic;if(this.get("autoSolve"))this.onDirectionsStart();this._globalGeocoder.find(a.graphic.geometry).then(e.hitch(this,function(b){b&&b.results.length?this._setReverseGeocode(b.results[0],b.geometry,u.indexOf(this.stopGraphics,a.graphic)):this._reverseGeocodeError(Error(w.widgets.directions.error.locator))}),e.hitch(this,
function(){this._decorateUngeocodedStop(a.graphic).then(e.hitch(this,function(b){this._setReverseGeocode(b,b.feature.geometry,u.indexOf(this.stopGraphics,a.graphic))}))}))}}));this._onEvents.push(a)},_decorateUngeocodedStop:function(a){var b=new y,c=function(c,d){b.resolve({name:void 0===c?w.widgets.directions.unlocatedStop:c.toFixed(6)+" "+d.toFixed(6),feature:a})};if(a.geometry)if(a.geometry.spatialReference&&4326!==a.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator())f(["../geometry/webMercatorUtils"],
function(b){b=b.xyToLngLat(a.geometry.x,a.geometry.y);c(b[0],b[1])});else if(this._geometryService){var d=new ca;d.outSR=new I(4326);d.geometries=[a.geometry];this._geometryService.project(d).then(e.hitch(this,function(b){b&&b.length?c(b[0].x,b[0].y):c(a.geometry.x,a.geometry.y)}),e.hitch(this,function(){c()}))}else c(a.geometry.x,a.geometry.y);else c(a.geometry.x,a.geometry.y);else c();return b.promise},_trafficLayerUpdate:function(a,b,c){a=this.get("map");b&&(a&&this._trafficLayerAdded)&&(a.removeLayer(b),
this._trafficLayerAdded=!1);c&&(a&&this.get("traffic")&&!this._trafficLayerAdded)&&(a.addLayer(c),c.show(),this._trafficLayerAdded=!0)},_reverseGeocodeError:function(a){this.onDirectionsFinish(a);a=w.widgets.directions.error.locator;this._resultError(a);this._clearRouteGraphics();this._currentEditableGraphic.setAttributes({error:a});this._updateStop({name:""},this._currentEditableGraphic._index)},_routeTaskError:function(a){var b=w.widgets.directions.error.routeTask,c=a.details;c&&1===c.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===
c[0]?b=w.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===c[0]&&(b=w.widgets.directions.error.nonNAmTruckingMode));this._resultError(b);this.onDirectionsFinish(a)},_resultError:function(a){var b="";this.errors.push(a);b+='\x3cdiv class\x3d"'+this._css.routesErrorClass+'"\x3e';if(this.errors.length){for(var b=b+"\x3cul\x3e",c=0;c<this.errors.length;c++)b+="\x3cli\x3e"+this.errors[c]+"\x3c/li\x3e";b+="\x3c/ul\x3e"}b+=
"\x3c/div\x3e";this._errorNode&&(this._errorNode.innerHTML=b);this.onError(a)},_getUnits:function(a){switch(a){case C.KILOMETERS:return"KILOMETERS";case C.METERS:return"METERS";case C.NAUTICAL_MILES:return"NAUTICAL_MILES";default:return"MILES"}},_createRouteTask:function(){var a=new y;this.set("routeTask",new W(this.get("routeTaskUrl")));this._usingAGOL()&&this._setTravelModeComponentsVisibility(!0);this._createRouteParams();aa({url:this.get("routeTask").url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(e.hitch(this,
function(b){if(b.networkDataset){this.set("serviceDescription",b);this._showTravelModesOption();if(this._hasAGOLTravelModes){var c=this.getSupportedTravelModeNames(),c=this.travelModeName&&c.length&&-1<u.indexOf(c,this.travelModeName)?this.travelModeName:this._tmDrivingTime,d=c.split(" ");this._travelModeKey=d[0];this._travelModeImpedanceKey=d[1];this.setTravelMode(c)}b.serviceLimits&&b.serviceLimits.Route_MaxStops&&this.set("maxStops",b.serviceLimits.Route_MaxStops);a.resolve()}else this._resultError(w.widgets.directions.error.cantFindRouteServiceDescription),
a.reject(w.widgets.directions.error.cantFindRouteServiceDescription)}),e.hitch(this,function(){this._resultError(w.widgets.directions.error.cantFindRouteServiceDescription);a.reject(w.widgets.directions.error.cantFindRouteServiceDescription)}));return a.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new Y(this.printTaskUrl,{async:!1}):null;var a=new $;a.exportOptions={width:670,height:750,dpi:96};a.format=
"PNG32";a.layout="MAP_ONLY";a.preserveScale=!1;a.showAttribution=!1;var b=new Z;b.map=this.map;b.outSpatialReference=this.map.spatialReference;b.template=a;this._printParams=b},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new Q(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=this.defaults.geometryTaskUrl?new Q(this.defaults.geometryTaskUrl):ba.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var a=
this.get("serviceDescription"),b=!this.showTravelModesOption||!a;if(a){this._hasAGOLTravelModes=(a=a.supportedTravelModes)&&a.length?!0:!1;var c={};c[this._tmDrivingTime]=null;c[this._tmTruckingTime]=null;c[this._tmWalkingTime]=null;c[this._tmDrivingDistance]=null;c[this._tmTruckingDistance]=null;c[this._tmWalkingDistance]=null;if(this._hasAGOLTravelModes)for(var d in c)if(c.hasOwnProperty(d)){for(var e=!1,f=0;f<a.length;f++)if(a[f].name===d){c[d]=a[f].itemId;a[f]._nodeTravelMode=-1<d.indexOf("Driving")?
this._useTravelModeCarNode:-1<d.indexOf("Trucking")?this._useTravelModeTruckNode:this._useTravelModeWalkingNode;a[f]._nodeImpedance=-1<d.indexOf("Time")?this._useTravelModeTimeNode:this._useTravelModeDistanceNode;e=!0;break}if(!e){this._hasAGOLTravelModes=!1;break}}b=b||!this._hasAGOLTravelModes;this.showTravelModesOption=this.showTravelModesOption&&this._hasAGOLTravelModes}this._setTravelModeComponentsVisibility(!b)},_setTravelModeComponentsVisibility:function(a){c.set(this._travelModeContainerNode,
"display",a?"inline-block":"none");c.set(this._travelModeImpedanceNode,"display",a?"inline-block":"none");c.set(this._useTravelModeTruckNode,"display",this.hideTruckingMode?"none":"inline-block");c.set(this._travelModeImpedanceNode,"display",this.hideFastestShortestOption?"none":"inline-block")},_showMilesKilometersOption:function(){c.set(this._travelModeDistanceUnitsNode,"display",this.showMilesKilometersOption?"block":"none")},_showClearButton:function(){c.set(this._clearDirectionsButtonNode,"display",
this.showClearButton?"inline-block":"none")},_showActivateButton:function(){c.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_createRouteParams:function(){var a={directionsOutputType:"complete",stops:new V,returnDirections:!0,doNotLocateOnRestrictedElements:!0};this.get("map")?a.outSpatialReference=this.get("map").spatialReference:a.outSpatialReference=this._defaultSR;this.get("routeParams")||(this.routeParams={});
var b=new X;this.routeParams=e.mixin(b,{returnRoutes:!1,preserveFirstStop:!0,preserveLastStop:!0,ignoreInvalidLocations:!0},this.get("routeParams"),a)},_reverseStops:function(){var a=this._dnd.getAllNodes();a.length&&(this._removeLocateButtonVisibilityEvents(),a.reverse(),this._dnd.clearItems(),this._dnd.insertNodes(!1,a),this._dnd.sync(),this._stopsRemovable(),this._optionsMenu(),this._checkMaxStops(),this.setListIcons(),this._sortGeocoders(),this._solveAndZoom())},_sortGeocodersToNodes:function(a,
b,c,d){b=b[d];a=n.byId(a[d]);d=n.byId(b);a=u.indexOf(c,a);d=u.indexOf(c,d);for(b=0;b<c.length;b++){if(b===a)return-1;if(b===d)return 1}},_setMenuNodeValues:function(){var a=this.get("optimalRoute");this._findOptimalOrderNode&&l.set(this._findOptimalOrderNode,"checked",a);a=this.get("returnToStart");this._returnToStartNode&&l.set(this._returnToStartNode,"checked",a);a=this.get("traffic");this._useTrafficNode&&l.set(this._useTrafficNode,"checked",a);switch(this.get("directionsLengthUnits")){case C.KILOMETERS:l.set(this._useKilometersNode,
"checked",!0);l.set(this._useMilesNode,"checked",!1);break;case C.MILES:l.set(this._useKilometersNode,"checked",!1),l.set(this._useMilesNode,"checked",!0)}this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&c.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&c.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&
c.set(this._findOptimalOrderItemNode,"display",this.get("showOptimalRouteOption")&&4<=this.stops.length?"block":"none");this.stops.length>=this.get("minStops")?h.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(h.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===c.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu(),this._configureRouteOptions())},_stopsRemovable:function(){this.get("geocoders").length>this.get("minStops")?
h.add(this._widgetContainer,this._css.stopsRemovableClass):h.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.stops.length<this.get("maxStops")?(this._showAddDestination(),this.set("maxStopsReached",!1)):(this._hideAddDestination(),this.set("maxStopsReached",!0))},_updateThemeWatch:function(a,b,c){h.remove(this.domNode,b);h.add(this.domNode,c)},_toggleOptionsMenu:function(){this._optionsMenuNode&&("block"===c.get(this._optionsMenuNode,"display")?(c.set(this._optionsMenuNode,
"display","none"),this._optionsButtonNode.innerHTML=w.widgets.directions.showOptions):(c.set(this._optionsMenuNode,"display","block"),this._optionsButtonNode.innerHTML=w.widgets.directions.hideOptions))},_hideAddDestination:function(){h.remove(this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){h.add(this._widgetContainer,this._css.addStopsClass)},_getAbsoluteUrl:function(){var a=f.toUrl(".");if(/^https?\:/i.test(a))return a;if(/^\/\//i.test(a))return window.location.protocol+
a;if(/^\//i.test(a))return window.location.protocol+"//"+window.location.host+a},_getManeuverImage:function(a){if(a){var b=this._getAbsoluteUrl()+"/images/Directions/maneuvers/";return"esriDMTStop"===a||"esriDMTDepart"===a?"":b+a+".png"}return""},_loadPrintDirections:function(b){var c=this.get("printTemplate");if(!c){var d=this._getAbsoluteUrl()+"/css/Directions.css",f=this._getAbsoluteUrl()+"/css/DirectionsPrint.css",g=this._getAbsoluteUrl()+"/images/Directions/print-logo.png",h;h=a.isBodyLtr()?
"ltr":"rtl";c="";c+="\x3c!DOCTYPE HTML\x3e";c+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+h+'"\x3e';c+="\x3chead\x3e";c+='\x3cmeta charset\x3d"utf-8"\x3e';c+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';c+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";c+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+d+'" /\x3e';c+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+
f+'" /\x3e';c+="\x3c/head\x3e";c+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+w.common.close+'" onclick\x3d"window.close();"\x3e'+w.common.close+"\x3c/div\x3e";c+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+w.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+w.widgets.directions.print+"\x3c/div\x3e";
c+="\x3c/div\x3e";c+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';c+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+g+'" /\x3e';c+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+this.get("directions").routeName+"\x3c/div\x3e";c+='\x3cdiv class\x3d"'+this._css.esriPrintLengthClass+'"\x3e'+this._formatDistance(this.get("directions").totalLength,w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].name)+
". "+this._formatTime(this.get("directions").totalTime)+"\x3c/div\x3e";b&&(c+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',c+='\x3chr class\x3d"esriNoPrint"/\x3e');var c=c+'\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e',c=c+('\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+w.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e'),c=c+('\x3cdiv class\x3d"'+
this._css.clearClass+'"\x3e\x3c/div\x3e'),c=c+"\x3c/div\x3e",c=c+('\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e'),c=c+"\x3ctable\x3e",c=c+"\x3ctbody\x3e",k=0;u.forEach(this.get("directions").features,e.hitch(this,function(a,b){var d=this.get("directions").strings[b],e;if(d){var f=a.attributes.text;for(e=0;e<d.length;e++)f=this._boldText(f,d[e].string);a.attributes.formattedText=f}else a.attributes.formattedText=a.attributes.text;d="";this.get("directions").features.length===b+1&&
(d=this._css.routeLastClass);a.attributes&&(a.attributes.step=b+1);c+='\x3ctr class\x3d"'+d+'"\x3e';c+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';var d=this._getManeuverImage(a.attributes.maneuverType),g;0===b?(g=this._getLetter(k),k++):"esriDMTStop"===a.attributes.maneuverType?g=this._getLetter(k):"esriDMTDepart"===a.attributes.maneuverType&&(g=this._getLetter(k),k++);d?c+='\x3cimg src\x3d"'+d+'" /\x3e':g&&(c+='\x3cdiv class\x3d"'+this._css.esriPrintStopLabelClass+'"\x3e',c+=g,c+=
"\x3c/div\x3e");c+="\x3c/td\x3e";c+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';c+="\x3cdiv\x3e\x3cstrong\x3e"+z.format(a.attributes.step)+".\x3c/strong\x3e "+a.attributes.formattedText+"\x3c/div\x3e";c+="\x3c/td\x3e";c+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._formatDistance(a.attributes.length,w.widgets.directions.units[this._getUnits(this.get("directionsLengthUnits"))].abbr)+"\x3c/div\x3e";c+="\x3c/td\x3e";
c+="\x3c/tr\x3e"}));c+="\x3c/tbody\x3e";c+="\x3c/table\x3e";c+="\x3c/div\x3e";c+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';c+="\x3cp\x3e"+w.widgets.directions.printDisclaimer+"\x3c/p\x3e";c+="\x3c/div\x3e";c+="\x3c/div\x3e";c+="\x3c/body\x3e";c+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(c);this._printWindow.document.close()},_printDirections:function(){var a=screen.width/2,b=screen.height/1.5,a="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+
a+", height\x3d"+b+", top\x3d"+(screen.height/2-b/2)+", left\x3d"+(screen.width/2-a/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",a,!0)):(this._printWindow=window.open("","directions_widget_print",a,!0),this._loadPrintDirections(!!this._printService),this._printService&&f(["dojo/_base/window"],e.hitch(this,function(a){this.zoomToFullRoute().then(e.hitch(this,function(b){this._printService.execute(this._printParams,e.hitch(this,
function(b){a.withDoc(this._printWindow.document,function(){var a=n.byId("divMap");a&&(h.remove(a,"esriPrintWait"),h.add(a,"esriPageBreak"),A.create("img",{src:b.url,"class":"esriPrintMapImg"},a))})}),e.hitch(this,function(b){a.withDoc(this._printWindow.document,function(){var a=n.byId("divMap");a&&h.remove(a,"esriPrintWait")});console.log("Error while calling print service:\n "+b)}))}))})))}});d("extend-esri")&&e.setObject("dijit.Directions",q,G);return q});